import{u as e,r as a,o as t,X as l,c as o,w as s,A as i,l as c,Y as r,K as n,a as u,b as d,f as v,d as m,v as p,x as g,L as h,F as f,h as x,S as w,Z as y,W as b}from"./index-Z6t8nurF.js";import{u as k}from"./useNotification-DFWdNotK.js";import{U as _}from"./UnifiedComicCard-B7ooXsXW.js";import{_ as C}from"./Pagination-BfvinUMI.js";const j={class:"container mx-auto px-4 py-6"},L={class:"mb-6"},V={class:"flex justify-between items-center"},I={class:"text-gray-400"},M={class:"text-pink-500 font-medium"},U={key:0,class:"flex justify-center py-20"},z={key:1,class:"text-center py-12"},B={key:2},q={class:"grid grid-cols-2 sm:grid-cols-3 md:grid-cols-4 lg:grid-cols-5 xl:grid-cols-6 gap-4"},A={class:"relative"},F=["onClick"],K={class:"mt-8"},N={__name:"CollectionView",setup(N){const P=c(),S=e(),T=k(),W=a([]),X=a(!1),Y=a(1),Z=a(1),$=a(0),D=a(!1),E=a(null),G=e=>({id:e.comic_id||e.id,name:e.name||e.title,title:e.name||e.title,created_at:e.created_at}),H=async(e=1)=>{X.value=!0;try{const a=await r(e,24);W.value=(a.data||[]).map(e=>({...e,id:e.comic_id||e.id,title:e.name||e.title})),Y.value=a.current_page||1,Z.value=a.last_page||1,$.value=a.total||0,1===e&&(S.collectedComics=W.value)}catch(a){}finally{X.value=!1}},J=e=>{E.value=e,D.value=!0},O=async()=>{if(!E.value)return;const e=E.value,a=e.comic_id||e.id;try{if(!1===(await b({id:a,name:e.name||e.title,author:e.author||"",cover:e.cover||null})).is_collected){const e=W.value.findIndex(e=>(e.comic_id||e.id)===a);e>-1&&(W.value.splice(e,1),$.value--);const t=S.collectedComics.findIndex(e=>(e.comic_id||e.id)===a);t>-1&&S.collectedComics.splice(t,1),T.success("已移除收藏"),0===W.value.length&&Y.value>1&&R(Y.value-1)}D.value=!1,E.value=null}catch(t){T.error(t.response?.data?.message||"移除失败，请稍后重试"),D.value=!1,E.value=null}},Q=()=>{D.value=!1,E.value=null},R=e=>{H(e),window.scrollTo(0,0)},ee=()=>{S.isLoggedIn?H():P.push({path:"/login",query:{redirect:"/collection"}})};return t(()=>{ee()}),l(()=>{ee()}),(e,a)=>{const t=n("router-link");return u(),o(i,{title:"我的收藏"},{default:s(()=>[d("div",j,[d("div",L,[d("div",V,[d("div",null,[a[4]||(a[4]=d("h1",{class:"text-2xl font-bold text-white mb-2"},"我的收藏",-1)),d("p",I,[a[2]||(a[2]=p(" 共 ",-1)),d("span",M,g($.value),1),a[3]||(a[3]=p(" 部作品 ",-1))])])])]),X.value?(u(),m("div",U,[v(h)])):W.value.length?(u(),m("div",B,[d("div",q,[(u(!0),m(f,null,x(W.value,e=>(u(),m("div",{key:e.comic_id||e.id,class:"relative group",onClick:a[0]||(a[0]=w(()=>{},["stop"]))},[d("div",A,[v(_,{comic:G(e),"show-collection-date":!0,"show-category":!1,"show-episode":!1,"show-stats":!1,"show-author":!1,"show-description":!1,"show-tags":!1},null,8,["comic"]),d("button",{type:"button",onClick:w(a=>(e=>{J(e)})(e),["stop","prevent"]),class:"absolute top-2 right-2 p-2 bg-red-600 sm:bg-gray-900/90 hover:bg-red-600 text-white rounded-full opacity-100 sm:opacity-0 sm:group-hover:opacity-100 transition-all duration-200 shadow-lg z-50 cursor-pointer",title:"移除收藏"},[...a[8]||(a[8]=[d("svg",{class:"w-4 h-4",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24"},[d("path",{"stroke-linecap":"round","stroke-linejoin":"round","stroke-width":"2",d:"M6 18L18 6M6 6l12 12"})],-1)])],8,F)])]))),128))]),d("div",K,[v(C,{"current-page":Y.value,"total-pages":Z.value,onChange:R},null,8,["current-page","total-pages"])])])):(u(),m("div",z,[a[6]||(a[6]=d("svg",{class:"w-24 h-24 text-gray-600 mx-auto mb-4",fill:"currentColor",viewBox:"0 0 20 20"},[d("path",{"fill-rule":"evenodd",d:"M3.172 5.172a4 4 0 015.656 0L10 6.343l1.172-1.171a4 4 0 115.656 5.656L10 17.657l-6.828-6.829a4 4 0 010-5.656z","clip-rule":"evenodd"})],-1)),a[7]||(a[7]=d("p",{class:"text-gray-400 mb-4"},"还没有收藏任何漫画",-1)),v(t,{to:"/latest",class:"inline-block px-6 py-2 bg-gradient-to-r from-pink-500 to-rose-500 hover:from-pink-600 hover:to-rose-600 text-white rounded-lg transition-all cursor-pointer shadow-lg hover:shadow-xl"},{default:s(()=>[...a[5]||(a[5]=[p(" 去看看最新漫画 ",-1)])]),_:1})]))]),v(y,{modelValue:D.value,"onUpdate:modelValue":a[1]||(a[1]=e=>D.value=e),title:"移除收藏",message:`确定要移除《${E.value?.name||""}》吗？`,"confirm-text":"移除","cancel-text":"取消","confirm-button-class":"bg-red-600 hover:bg-red-700 text-white",onConfirm:O,onCancel:Q},null,8,["modelValue","message"])]),_:1})}}};export{N as default};
