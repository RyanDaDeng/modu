import{r as u,o as L,u as b,a as T,b as E,c as d,d as v,e as f,F as k,f as I,g as M,L as P,h as B,i as n,j as N}from"./index-R3dXyy7_.js";import{_ as O}from"./ComicCard-Vk7YaCoR.js";import"./format-BZgmAhtB.js";const C={class:"bg-gray-900 min-h-screen"},F={class:"container mx-auto px-4 py-6"},V={key:0,class:"text-center py-12"},A={class:"grid grid-cols-3 sm:grid-cols-4 md:grid-cols-5 lg:grid-cols-6 xl:grid-cols-7 gap-3"},Y={key:1,class:"py-8"},$={key:2,class:"text-center py-8 text-gray-400"},j={name:"LatestView"},U=Object.assign(j,{setup(D){const S=b(),a=u([]),r=u(!1),l=u(1),o=u(!0),i=u(null);let c=null;const p="latestPageState",_="latestPageScroll",m=()=>{const t={comics:a.value,currentPage:l.value,hasMore:o.value,timestamp:Date.now()};sessionStorage.setItem(p,JSON.stringify(t))},y=()=>{const t=sessionStorage.getItem(p);if(t)try{const e=JSON.parse(t);if(Date.now()-e.timestamp<1800*1e3)return a.value=e.comics||[],l.value=e.currentPage||1,o.value=e.hasMore!==void 0?e.hasMore:!0,setTimeout(()=>{const s=sessionStorage.getItem(_);s&&window.scrollTo(0,parseInt(s))},100),!0}catch(e){console.error("Failed to restore latest state:",e)}return!1},g=()=>{sessionStorage.setItem(_,window.scrollY.toString())},h=async()=>{if(!(r.value||!o.value)){r.value=!0;try{const t=await B(l.value);if(!t||t.length===0)o.value=!1;else{const e=t.map(s=>({...s,page:l.value}));a.value.push(...e),l.value++}m()}catch(t){console.error("Failed to load latest comics:",t),o.value=!1}finally{r.value=!1}}},w=()=>{c=new IntersectionObserver(t=>{t[0].isIntersecting&&!r.value&&o.value&&h()},{rootMargin:"100px"}),i.value&&c.observe(i.value)};return L(()=>{y()||h(),w(),window.addEventListener("beforeunload",g),S.beforeEach((e,s,x)=>{s.name==="latest"&&a.value.length>0&&(g(),m()),x()})}),T(()=>{a.value.length>0&&(g(),m())}),E(()=>{c&&i.value&&(c.unobserve(i.value),c.disconnect()),window.removeEventListener("beforeunload",g)}),(t,e)=>(n(),d("div",C,[v("div",F,[e[1]||(e[1]=v("h1",{class:"text-2xl font-bold text-white mb-6"},"最新更新",-1)),!a.value.length&&!r.value?(n(),d("div",V,[...e[0]||(e[0]=[v("p",{class:"text-gray-400"},"暂无内容",-1)])])):f("",!0),v("div",A,[(n(!0),d(k,null,I(a.value,s=>(n(),N(O,{key:`${s.id}-${s.page}`,comic:s},null,8,["comic"]))),128))]),r.value?(n(),d("div",Y,[M(P)])):f("",!0),!o.value&&a.value.length?(n(),d("div",$," 没有更多内容了 ")):f("",!0),v("div",{ref_key:"loadMoreTrigger",ref:i,class:"h-20"},null,512)])]))}});export{U as default};
