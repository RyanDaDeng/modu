import{u as L,r as s,o as B,P as F,c as R,w as x,A,j as M,Q as P,z as S,a as i,b as a,f as c,d,C as I,L as V,H as $,F as j,h as z,R as N,S as T}from"./index-DAir1iQL.js";import{_ as D}from"./ComicCard-y9lwEhRl.js";import{_ as H}from"./Pagination-BxgMs4Qq.js";import{C as q}from"./ConfirmationDialog-DyMyKNkc.js";const E={class:"container mx-auto px-4 py-6"},Q={class:"mb-6"},G={class:"text-gray-400 mt-1"},J={key:0,class:"flex justify-center py-20"},K={key:1,class:"text-center py-12"},O={key:2},U={class:"grid grid-cols-3 sm:grid-cols-4 md:grid-cols-5 lg:grid-cols-6 xl:grid-cols-6 gap-3"},W=["onClick"],X={class:"mt-8"},Y=24,se={__name:"CollectionView",setup(Z){const y=M(),u=L(),n=s([]),p=s(!1),g=s(1),f=s(1),m=s(0),r=s(!1),t=s(null),_=async(l=1)=>{p.value=!0;try{const e=await P(l,Y);n.value=(e.data||[]).map(o=>({...o,id:o.comic_id||o.id,title:o.name||o.title})),g.value=e.current_page||1,f.value=e.last_page||1,m.value=e.total||0,l===1&&(u.collectedComics=n.value)}catch(e){console.error("Failed to load collections:",e)}finally{p.value=!1}},C=l=>{t.value=l,r.value=!0},w=async()=>{if(t.value)try{await T(t.value.comic_id||t.value.id);const l=n.value.findIndex(o=>(o.comic_id||o.id)===(t.value.comic_id||t.value.id));l>-1&&(n.value.splice(l,1),m.value--);const e=u.collectedComics.findIndex(o=>(o.comic_id||o.id)===(t.value.comic_id||t.value.id));e>-1&&u.collectedComics.splice(e,1),r.value=!1,t.value=null}catch(l){console.error("Failed to remove collection:",l),r.value=!1,t.value=null}},k=()=>{r.value=!1,t.value=null},b=l=>{_(l),window.scrollTo(0,0)},h=()=>{if(!u.isLoggedIn){y.push({path:"/login",query:{redirect:"/collection"}});return}_()};return B(()=>{h()}),F(()=>{h()}),(l,e)=>{const o=S("router-link");return i(),R(A,{title:"我的收藏"},{default:x(()=>[a("div",E,[a("div",Q,[a("p",G,"共 "+I(m.value)+" 部作品",1)]),p.value?(i(),d("div",J,[c(V)])):n.value.length?(i(),d("div",O,[a("div",U,[(i(!0),d(j,null,z(n.value,v=>(i(),d("div",{key:v.id||v.comic_id,class:"relative group"},[c(D,{comic:v,"show-collection-date":!0},null,8,["comic"]),a("button",{onClick:N(ee=>C(v),["prevent"]),class:"absolute top-2 right-2 p-1.5 bg-red-500/90 text-white rounded-full opacity-0 group-hover:opacity-100 transition-opacity shadow-lg hover:bg-red-600 z-10",title:"移除收藏"},[...e[3]||(e[3]=[a("svg",{class:"w-3 h-3",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24"},[a("path",{"stroke-linecap":"round","stroke-linejoin":"round","stroke-width":"2",d:"M6 18L18 6M6 6l12 12"})],-1)])],8,W)]))),128))]),a("div",X,[c(H,{"current-page":g.value,"total-pages":f.value,onChange:b},null,8,["current-page","total-pages"])])])):(i(),d("div",K,[e[1]||(e[1]=a("svg",{class:"w-24 h-24 text-gray-600 mx-auto mb-4",fill:"currentColor",viewBox:"0 0 20 20"},[a("path",{"fill-rule":"evenodd",d:"M3.172 5.172a4 4 0 015.656 0L10 6.343l1.172-1.171a4 4 0 115.656 5.656L10 17.657l-6.828-6.829a4 4 0 010-5.656z","clip-rule":"evenodd"})],-1)),e[2]||(e[2]=a("p",{class:"text-gray-400 mb-4"},"还没有收藏任何漫画",-1)),c(o,{to:"/latest",class:"inline-block px-6 py-2 bg-pink-500 text-white rounded-lg hover:bg-pink-600 transition-colors"},{default:x(()=>[...e[0]||(e[0]=[$(" 去看看最新漫画 ",-1)])]),_:1})]))]),c(q,{show:r.value,title:"移除收藏",message:`确定要移除《${t.value?.name||""}》吗？`,"confirm-text":"移除","cancel-text":"取消","confirm-button-class":"bg-red-600 hover:bg-red-700 text-white",onConfirm:w,onCancel:k},null,8,["show","message"])]),_:1})}}};export{se as default};
