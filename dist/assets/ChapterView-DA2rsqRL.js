import{n as ut,_ as ct,k as dt,p as S,m as vt,r as u,w as Ee,o as mt,b as gt,c as n,e as v,d as t,g as K,L as le,q as Q,u as pt,t as c,s as _,v as W,F as oe,f as ae,x as xt,j as ht,y as ft,T as yt,z as bt,A as wt,B as kt,C as R,D as Ae,i as a,E as ne,G as _t,H as xe}from"./index-R3dXyy7_.js";import{f as re}from"./format-BZgmAhtB.js";function Ct(m,z){if(m>=220980&&m<268850)return 10;const I=ut(m+z);let d=I.charCodeAt(I.length-1);return m>=268850&&m<=421925?d=d%10:d=d%8,d>=0&&d<=9?d*2+2:10}function St(m,z,I){if(z<220980||m.src.includes(".gif"))return m;const d=document.createElement("canvas"),y=d.getContext("2d");d.width=m.naturalWidth,d.height=m.naturalHeight;const o=Ct(z,I),x=Math.floor(d.height/o),H=d.height%o;y.drawImage(m,0,d.height-x-H,d.width,x+H,0,0,d.width,x+H);for(let h=0;h<o-1;h++)y.drawImage(m,0,x*(o-h-2),d.width,x,0,(h+1)*x+H,d.width,x);return d}function It(m,z,I){return`https://${m}/media/photos/${z}/${I}`}function Ve(){const m=new Date().getHours();return m<=3||m>=21?1:m>=18?3:5}const jt={class:"min-h-screen bg-gray-900"},Mt={key:0,class:"flex justify-center items-center min-h-screen"},zt={class:"flex flex-col items-center"},Ht={key:1},Lt={class:"sticky top-0 z-[60] bg-gray-800 shadow-lg"},Tt={class:"container mx-auto px-4"},$t={class:"flex items-center justify-between h-14"},Bt={class:"text-white font-semibold text-sm sm:text-lg truncate px-2 flex-1 text-center"},Pt=["fill"],Rt={class:"relative"},Et={class:"relative container mx-auto px-4 py-8"},At={class:"flex flex-col md:flex-row gap-6"},Vt={class:"w-32 sm:w-48 h-44 sm:h-64 flex-shrink-0 mx-auto md:mx-0"},Dt=["src","alt"],Ft={key:1,class:"w-full h-full bg-gray-700 rounded-lg animate-pulse"},Nt={class:"flex-1 text-white text-center md:text-left"},Yt={class:"text-xl sm:text-2xl md:text-3xl font-bold mb-3"},qt={class:"text-sm sm:text-base text-gray-300 mb-2"},Ot={class:"text-sm sm:text-base text-gray-300 mb-4"},Ut={class:"flex flex-wrap justify-center md:justify-start gap-3 sm:gap-6 mb-4"},Jt={class:"flex items-center gap-1 sm:gap-2"},Gt={class:"text-sm sm:text-base"},Kt={class:"text-gray-400 text-xs sm:text-sm"},Qt={class:"flex items-center gap-1 sm:gap-2"},Wt={class:"text-sm sm:text-base"},Xt={class:"flex items-center gap-1 sm:gap-2"},Zt={class:"text-sm sm:text-base"},es={key:0,class:"flex flex-wrap gap-2 mb-6"},ts=["onClick"],ss={key:1,class:"text-gray-300 mb-6 line-clamp-3"},ls={class:"container mx-auto px-4 py-6"},os={class:"flex border-b border-gray-700 mb-6"},as={class:"text-xs sm:text-sm"},ns={class:"bg-gray-800 rounded-xl p-4 sm:p-6"},rs={key:0,class:"space-y-4"},is={key:0,class:"grid grid-cols-3 md:grid-cols-5 lg:grid-cols-6 gap-3"},us=["onClick"],cs={key:1,class:"flex justify-center"},ds={key:1,class:"space-y-4"},vs={key:0,class:"space-y-4"},ms={class:"flex-shrink-0"},gs=["src","alt"],ps={class:"flex-1 min-w-0"},xs={class:"flex items-center gap-2 mb-2"},hs={class:"font-semibold text-white text-sm sm:text-base truncate"},fs={class:"text-xs text-gray-500"},ys={class:"text-gray-300 text-sm sm:text-base break-words"},bs={key:1,class:"text-center py-8 text-gray-500"},ws={key:2,class:"flex justify-center py-8"},ks={class:"container mx-auto"},_s={class:"flex items-center justify-between px-3 sm:px-4 py-2"},Cs={class:"hidden sm:flex items-center gap-3 text-sm flex-1 justify-center"},Ss={class:"text-white font-semibold text-base"},Is={class:"text-gray-400"},js={class:"flex sm:hidden items-center text-xs flex-1 justify-center px-2 gap-2"},Ms={class:"text-white font-semibold truncate"},zs={class:"text-gray-400"},Hs={class:"flex items-center gap-1 sm:gap-2"},Ls={class:"h-0.5 bg-gray-800"},Ts=["title"],$s={key:0,class:"w-4 h-4 sm:w-5 sm:h-5",fill:"currentColor",viewBox:"0 0 20 20"},Bs={key:1,class:"w-4 h-4 sm:w-5 sm:h-5",fill:"currentColor",viewBox:"0 0 20 20"},Ps={key:1,class:"flex justify-center items-center h-screen"},Rs={class:"flex flex-col items-center"},Es={key:2,class:"flex justify-center items-center h-screen"},As={class:"bg-red-900/50 border border-red-700 rounded-lg p-6 text-center max-w-md"},Vs={class:"text-red-400"},Ds={key:3,class:"pt-10 pb-8 bg-black"},Fs={class:"max-w-3xl sm:max-w-4xl lg:max-w-5xl mx-auto"},Ns=["data-index"],Ys={key:0,class:"flex items-center justify-center min-h-[300px] sm:min-h-[500px]"},qs={key:0,class:"flex flex-col items-center text-gray-400"},Os={class:"mt-2 text-sm"},Us=["onClick"],Js=["src","alt"],Gs={key:0,class:"mt-8 flex justify-center"},Ks={key:0,class:"fixed inset-0 z-[60] flex items-center justify-center bg-black/50 backdrop-blur-sm p-2 sm:p-4"},Qs={class:"bg-gray-900 rounded-lg sm:rounded-xl max-w-sm w-full p-3 sm:p-6 border border-gray-700"},Ws={key:0,class:"mb-3 sm:mb-6"},Xs={class:"block text-xs sm:text-sm font-medium text-gray-300 mb-1.5 sm:mb-2"},Zs={key:1,class:"mb-3 sm:mb-6 space-y-3 sm:space-y-4"},el={class:"block text-xs sm:text-sm font-medium text-gray-300 mb-1.5 sm:mb-2"},tl={class:"block text-xs sm:text-sm font-medium text-gray-300 mb-1.5 sm:mb-2"},sl={class:"mb-3 sm:mb-6"},ll={class:"grid grid-cols-2 gap-1.5 sm:gap-2"},ol={class:"text-[10px] sm:text-xs text-gray-500 mt-1 sm:mt-2"},al={class:"mb-3 sm:mb-6"},nl={key:0},rl={key:1},il={class:"mb-3 sm:mb-6"},ul=["disabled"],cl={key:0},dl={key:1,class:"flex items-center justify-center gap-1 sm:gap-2"},vl={class:"text-xs sm:text-sm"},ml={__name:"ChapterView",setup(m){const z=vt(),I=pt(),d=dt(),y=S(()=>z.params.id),o=u({}),x=u([]),H=u(!1),h=u(!1),he=u(""),ie=u(1),E=u(!0),L=u("chapters"),A=u(!1),b=u(null),ue=u(""),g=u([]),ce=u(!1),q=u(""),V=u(0),T=u(0),fe=u(0),De=u(null),D=u(!0),O=u(0),k=u(!1),$=u(!1),F=u(parseInt(localStorage.getItem("autoScrollSpeed"))||50),j=u(localStorage.getItem("autoScrollMode")||"smooth"),N=u(parseFloat(localStorage.getItem("stepInterval"))||2),Y=u(parseInt(localStorage.getItem("stepSize"))||150),f=u(null),de=u(!1),B=u(!1),X=u({}),U=u([]),ye=u([]),w=u(null);let ve=[],Z=0,p=null;const be=S(()=>d.isCollected(y.value)),we=S(()=>{const s=[...o.value.tags||[]],e=o.value.actors||[];return[...s,...e].filter(Boolean)}),Fe=S(()=>{const s=o.value.likes||0,e=o.value.total_views||1;return Math.floor(s/e*100)}),ke=S(()=>g.value.length?Math.floor((T.value+1)/g.value.length*100):0),_e=S(()=>{if(!b.value)return"";if(o.value.series?.length){const s=o.value.series.findIndex(e=>e.id==b.value);if(s>=0)return`第${s+1}章`}return"第1章"}),Ce=S(()=>!o.value.series?.length||!b.value?!1:o.value.series.findIndex(e=>e.id==b.value)>0),Se=S(()=>{if(!Ce.value)return null;const s=o.value.series.findIndex(e=>e.id==b.value);return s>0?o.value.series[s-1].id:null}),me=S(()=>{if(!o.value.series?.length||!b.value)return!1;const s=o.value.series.findIndex(e=>e.id==b.value);return s>=0&&s<o.value.series.length-1}),Ie=S(()=>{if(!me.value)return null;const s=o.value.series.findIndex(e=>e.id==b.value);return s>=0&&s<o.value.series.length-1?o.value.series[s+1].id:null}),je=s=>`https://${d.primaryImgServer||d.primaryServer}/media/albums/${s}_3x4.jpg`,Ne=s=>!s||s==="nopic-Male.gif"?"/default.jpeg":`https://${d.primaryServer}/media/users/${s}`,Ye=s=>{s.target.src="/default.jpeg"},qe=s=>{s.target.src="/default.jpeg"},Oe=()=>{d.toggleCollect({id:y.value,name:o.value.name,author:o.value.author?.join(" & ")})},Ue=s=>{const e=document.createElement("DIV");return e.innerHTML=s,e.textContent||e.innerText||""},Me=async()=>{H.value=!0,he.value="";try{const s=await wt(y.value);o.value=s,console.log("Album data:",s),L.value==="comments"&&!x.value.length&&Le()}catch(s){console.error("Failed to load comic info:",s),he.value="加载失败，请稍后重试"}finally{H.value=!1}},Je=()=>{const s=localStorage.getItem("chapterReadingHistory");s&&(X.value=JSON.parse(s))},Ge=s=>{let e={...X.value};const l=y.value;if(o.value.series?.length){const r=o.value.series.findIndex(M=>M.id==s);r>=0&&(e[l]=r)}else e[l]=0;if(Object.entries(e).length>10){const r=Object.keys(e);delete e[r[0]]}X.value=e,localStorage.setItem("chapterReadingHistory",JSON.stringify(e))},Ke=s=>{const e=y.value,l=X.value[e];if(l===void 0)return!1;if(o.value.series?.length){const i=o.value.series.findIndex(r=>r.id==s);return i>=0&&i<=l}return!1},J=async s=>{if(fe.value=window.scrollY,De.value=s,D.value=!0,O.value=0,Ge(s),document.body.style.overflow="hidden",b.value=s,A.value=!0,ce.value=!0,q.value="",g.value=[],V.value=0,T.value=0,o.value.series?.length){o.value.series.find(l=>l.id==s);const e=o.value.series.findIndex(l=>l.id==s);ue.value=`${o.value.name} - 第${e+1}章`}else ue.value=o.value.name;try{const e=await kt(s);console.log("Chapter data for",s,":",e),e.images&&e.images.length?(g.value=e.images.map((l,i)=>({name:l,src:It(d.primaryImgServer,s,l),loaded:!1,loading:!1,error:!1,needProcess:parseInt(s)>=220980&&!l.includes(".gif"),index:i})),d.addReadHistory({id:s,name:ue.value,author:o.value.author?.join(" & ")}),await R(),Te(),ze()):q.value="没有找到章节内容"}catch(e){console.error("Failed to load chapter:",e),q.value="加载失败，请稍后重试"}finally{ce.value=!1}},Qe=s=>{const e=s.target.scrollTop;e<O.value||e<50?D.value=!0:e>O.value&&e>50&&(D.value=!1),O.value=e,ze()},ze=()=>{if(!w.value||!U.value.length)return;const s=w.value,e=s.scrollTop,l=s.clientHeight,i=e+l/2;for(let r=0;r<U.value.length;r++){const M=U.value[r];if(M){const pe=M.getBoundingClientRect(),se=s.getBoundingClientRect(),P=pe.top-se.top+e,G=P+M.offsetHeight;if(i>=P&&i<=G){T.value=r;break}}}},ge=()=>{C(),A.value=!1,b.value=null,g.value=[],V.value=0,T.value=0,D.value=!0,O.value=0,p&&(p.disconnect(),p=null),document.body.style.overflow="",R(()=>{window.scrollTo(0,fe.value)})},He=()=>{Ie.value&&(g.value=[],V.value=0,T.value=0,p&&(p.disconnect(),p=null),w.value&&w.value.scrollTo({top:0,behavior:"smooth"}),J(Ie.value))},We=()=>{He()},Xe=()=>{Se.value&&(g.value=[],V.value=0,T.value=0,p&&(p.disconnect(),p=null),w.value&&w.value.scrollTo({top:0,behavior:"smooth"}),J(Se.value))},Ze=()=>{b.value&&J(b.value)},Le=async()=>{if(!h.value){h.value=!0,ie.value=1,x.value=[];try{const s=await Ae(y.value,1);console.log("Loaded comments:",s.length),x.value=s,E.value=s.length>=10,console.log("Has more comments:",E.value)}catch(s){console.error("Failed to load comments:",s)}finally{h.value=!1}}},et=async()=>{if(!(h.value||!E.value)){h.value=!0;try{const s=ie.value+1;console.log("Loading more comments, page:",s);const e=await Ae(y.value,s);console.log("Loaded more comments:",e.length),e.length===0?E.value=!1:(ie.value=s,x.value.push(...e),E.value=e.length>=10)}catch(s){console.error("Failed to load more comments:",s)}finally{h.value=!1}}},ee=async s=>{const e=g.value[s];return!e||e.loaded||e.loading?Promise.resolve():new Promise(async l=>{e.loading=!0;const i=Ve();for(;Z>=i;)await new Promise(r=>setTimeout(r,100));Z++;try{const r=new Image;r.crossOrigin="anonymous",await new Promise((M,pe)=>{r.onload=async()=>{if(e.needProcess){const se=e.name.substring(0,5);console.log(`Processing image ${s} with page ${se}`),await R();const P=ye.value[s];if(P){const G=St(r,parseInt(b.value),se);P.width=G.width,P.height=G.height,P.getContext("2d").drawImage(G,0,0)}}else e.displaySrc=r.src;e.loaded=!0,e.error=!1,V.value++,M()},r.onerror=()=>{e.error=!0,pe(new Error("Failed to load image"))},r.src=e.src})}catch(r){console.error(`Failed to load image ${s}:`,r),e.error=!0}finally{e.loading=!1,Z--;const r=ve.shift();r!==void 0&&ee(r),l()}})},tt=s=>{g.value[s].error=!1,g.value[s].loaded=!1,ee(s)},Te=()=>{p&&p.disconnect(),p=new IntersectionObserver(s=>{s.forEach(e=>{if(e.isIntersecting){const l=parseInt(e.target.dataset.index),i=g.value[l];if(!i.loaded&&!i.loading){const r=Ve();Z<r?ee(l):ve.includes(l)||ve.push(l)}}})},{rootMargin:"200px"}),R(()=>{U.value.forEach((s,e)=>{s&&p.observe(s)})})},$e=()=>{if(!A.value&&chapterHeader.value){const s=window.pageYOffset||document.documentElement.scrollTop;isHeaderSticky.value=s>200}},Be=s=>{s.key==="Escape"&&A.value&&ge()};Ee(y,()=>{Me()}),Ee(L,s=>{s==="comments"&&!x.value.length&&!h.value&&Le()});const st=s=>{I.push({path:"/search",query:{q:s}})},lt=()=>{k.value?C():te()},ot=()=>{$.value?($.value=!1,nt()):($.value=!0,at())},at=()=>{f.value&&(clearInterval(f.value),f.value=null)},nt=()=>{if(k.value)if(f.value&&clearInterval(f.value),j.value==="smooth")f.value=setInterval(()=>{if(!w.value)return;const s=w.value,e=s.scrollTop,l=s.scrollHeight-s.clientHeight;if(e>=l-10){C();return}const i=F.value/20,r=e+i;s.scrollTo({top:r,behavior:"auto"})},50);else{const s=N.value*1e3;f.value=setInterval(()=>{R(()=>{const e=w.value;if(!e)return;const l=e.scrollTop,i=e.scrollHeight-e.clientHeight;if(l>=i-10){C();return}e.scrollBy({top:Y.value,behavior:"smooth"})})},s)}},rt=()=>{localStorage.setItem("autoScrollSpeed",F.value.toString()),k.value&&(C(),te())},Pe=s=>{j.value=s,localStorage.setItem("autoScrollMode",s),k.value&&(C(),te())},Re=()=>{localStorage.setItem("stepInterval",N.value.toString()),localStorage.setItem("stepSize",Y.value.toString()),k.value&&j.value==="stepped"&&(C(),te())},te=()=>{if(k.value=!0,$.value=!1,f.value&&clearInterval(f.value),j.value==="smooth")f.value=setInterval(()=>{if(!w.value)return;const s=w.value,e=s.scrollTop,l=s.scrollHeight-s.clientHeight;if(e>=l-10){C();return}const i=F.value/20,r=e+i;s.scrollTo({top:r,behavior:"auto"})},50);else{const s=N.value*1e3;f.value=setInterval(()=>{R(()=>{const e=w.value;if(!e)return;const l=e.scrollTop,i=e.scrollHeight-e.clientHeight;if(l>=i-10){C();return}e.scrollBy({top:Y.value,behavior:"smooth"})})},s)}},C=()=>{k.value=!1,$.value=!1,f.value&&(clearInterval(f.value),f.value=null)},it=async()=>{if(!(!g.value.length||B.value)){B.value=!0;try{p&&p.disconnect();const s=[];if(g.value.forEach((l,i)=>{!l.loaded&&!l.loading&&!l.error&&s.push(i)}),s.length===0){B.value=!1;return}console.log(`Loading ${s.length} images...`);const e=5;for(let l=0;l<s.length;l+=e){const i=s.slice(l,l+e);await Promise.all(i.map(r=>new Promise(M=>{ee(r).finally(()=>M())}))),l+e<s.length&&await new Promise(r=>setTimeout(r,100))}console.log("All images loaded successfully"),await R(),Te()}catch(s){console.error("Failed to load all images:",s)}finally{B.value=!1}}};return mt(()=>{Je(),Me(),window.addEventListener("scroll",$e),window.addEventListener("keydown",Be)}),gt(()=>{C(),p&&p.disconnect(),window.removeEventListener("scroll",$e),window.removeEventListener("keydown",Be)}),(s,e)=>(a(),n("div",jt,[H.value?(a(),n("div",Mt,[t("div",zt,[K(le),e[11]||(e[11]=t("p",{class:"text-white mt-4"},"加载中...",-1))])])):A.value?v("",!0):(a(),n("div",Ht,[t("div",Lt,[t("div",Tt,[t("div",$t,[t("button",{onClick:e[0]||(e[0]=l=>Q(I).back()),class:"flex items-center space-x-1 sm:space-x-2 text-white hover:text-pink-400 transition-colors flex-shrink-0"},[...e[12]||(e[12]=[t("svg",{class:"w-5 h-5 sm:w-6 sm:h-6",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24"},[t("path",{"stroke-linecap":"round","stroke-linejoin":"round","stroke-width":"2",d:"M15 19l-7-7 7-7"})],-1),t("span",{class:"text-sm sm:text-base"},"返回",-1)])]),t("h1",Bt,c(o.value.name||"加载中..."),1),t("button",{onClick:Oe,class:_(["p-2 rounded-lg hover:bg-gray-700 transition-colors flex-shrink-0",be.value?"text-pink-500":"text-gray-400"])},[(a(),n("svg",{class:"w-5 h-5 sm:w-6 sm:h-6",fill:be.value?"currentColor":"none",stroke:"currentColor",viewBox:"0 0 24 24"},[...e[13]||(e[13]=[t("path",{"stroke-linecap":"round","stroke-linejoin":"round","stroke-width":"2",d:"M4.318 6.318a4.5 4.5 0 000 6.364L12 20.364l7.682-7.682a4.5 4.5 0 00-6.364-6.364L12 7.636l-1.318-1.318a4.5 4.5 0 00-6.364 0z"},null,-1)])],8,Pt))],2)])])]),t("div",Rt,[o.value.id?(a(),n("div",{key:0,class:"absolute inset-0 h-96 bg-cover bg-center blur-xl opacity-30",style:W({backgroundImage:`url(${je(o.value.id)})`})},null,4)):v("",!0),t("div",Et,[t("div",At,[t("div",Vt,[o.value.id?(a(),n("img",{key:0,src:je(o.value.id),alt:o.value.name,class:"w-full h-full object-cover rounded-lg shadow-2xl",onError:Ye},null,40,Dt)):(a(),n("div",Ft))]),t("div",Nt,[t("h2",Yt,c(o.value.name),1),t("p",qt,"作者: "+c(o.value.author?.join(" & ")||"未知"),1),t("p",Ot,"ID: "+c(y.value),1),t("div",Ut,[t("div",Jt,[e[14]||(e[14]=t("svg",{class:"w-4 h-4 sm:w-5 sm:h-5 text-pink-400",fill:"currentColor",viewBox:"0 0 20 20"},[t("path",{"fill-rule":"evenodd",d:"M3.172 5.172a4 4 0 015.656 0L10 6.343l1.172-1.171a4 4 0 115.656 5.656L10 17.657l-6.828-6.829a4 4 0 010-5.656z","clip-rule":"evenodd"})],-1)),t("span",Gt,c(Q(re)(o.value.likes||0)),1),t("span",Kt,"("+c(Fe.value)+"%)",1)]),t("div",Qt,[e[15]||(e[15]=t("svg",{class:"w-4 h-4 sm:w-5 sm:h-5 text-blue-400",fill:"currentColor",viewBox:"0 0 20 20"},[t("path",{d:"M10 12a2 2 0 100-4 2 2 0 000 4z"}),t("path",{"fill-rule":"evenodd",d:"M.458 10C1.732 5.943 5.522 3 10 3s8.268 2.943 9.542 7c-1.274 4.057-5.064 7-9.542 7S1.732 14.057.458 10zM14 10a4 4 0 11-8 0 4 4 0 018 0z","clip-rule":"evenodd"})],-1)),t("span",Wt,c(Q(re)(o.value.total_views||0)),1)]),t("div",Xt,[e[16]||(e[16]=t("svg",{class:"w-4 h-4 sm:w-5 sm:h-5 text-green-400",fill:"currentColor",viewBox:"0 0 20 20"},[t("path",{"fill-rule":"evenodd",d:"M18 10c0 3.866-3.582 7-8 7a8.841 8.841 0 01-4.083-.98L2 17l1.338-3.123C2.493 12.767 2 11.434 2 10c0-3.866 3.582-7 8-7s8 3.134 8 7zM7 9H5v2h2V9zm8 0h-2v2h2V9zM9 9h2v2H9V9z","clip-rule":"evenodd"})],-1)),t("span",Zt,c(Q(re)(o.value.comment_total||0)),1)])]),we.value.length?(a(),n("div",es,[(a(!0),n(oe,null,ae(we.value,l=>(a(),n("span",{key:l,onClick:i=>st(l),class:"px-3 py-1 bg-gray-700/50 backdrop-blur rounded-full text-sm hover:bg-gray-600 transition-colors cursor-pointer"},c(l),9,ts))),128))])):v("",!0),o.value.description?(a(),n("p",ss,c(o.value.description),1)):v("",!0)])])])]),t("div",ls,[t("div",os,[t("button",{onClick:e[1]||(e[1]=l=>L.value="chapters"),class:_(["px-4 sm:px-6 py-3 font-semibold transition-colors text-sm sm:text-base",L.value==="chapters"?"text-pink-500 border-b-2 border-pink-500":"text-gray-400 hover:text-white"])}," 章节选择 ",2),t("button",{onClick:e[2]||(e[2]=l=>L.value="comments"),class:_(["px-4 sm:px-6 py-3 font-semibold transition-colors flex items-center gap-2 text-sm sm:text-base",L.value==="comments"?"text-pink-500 border-b-2 border-pink-500":"text-gray-400 hover:text-white"])},[e[17]||(e[17]=xt(" 评论 ",-1)),t("span",as,"("+c(Q(re)(o.value.comment_total||0))+")",1)],2)]),t("div",ns,[L.value==="chapters"?(a(),n("div",rs,[o.value.series?.length?(a(),n("div",is,[(a(!0),n(oe,null,ae(o.value.series,(l,i)=>(a(),n("button",{key:l.id,onClick:r=>J(l.id),class:"px-4 py-3 bg-gray-700 hover:bg-pink-500 text-white rounded-lg transition-all hover:shadow-lg text-center"},[t("div",{class:_(["font-semibold",{"text-blue-400":Ke(l.id)}])}," 第"+c(i+1)+"章 ",3)],8,us))),128))])):(a(),n("div",cs,[t("button",{onClick:e[3]||(e[3]=l=>J(y.value)),class:"px-8 py-4 bg-pink-500 hover:bg-pink-600 text-white rounded-lg transition-all hover:shadow-lg flex items-center gap-3"},[...e[18]||(e[18]=[t("svg",{class:"w-6 h-6",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24"},[t("path",{"stroke-linecap":"round","stroke-linejoin":"round","stroke-width":"2",d:"M12 6.253v13m0-13C10.832 5.477 9.246 5 7.5 5S4.168 5.477 3 6.253v13C4.168 18.477 5.754 18 7.5 18s3.332.477 4.5 1.253m0-13C13.168 5.477 14.754 5 16.5 5c1.747 0 3.332.477 4.5 1.253v13C19.832 18.477 18.247 18 16.5 18c-1.746 0-3.332.477-4.5 1.253"})],-1),t("span",{class:"text-lg font-semibold"},"开始阅读",-1)])])]))])):v("",!0),L.value==="comments"?(a(),n("div",ds,[x.value.length?(a(),n("div",vs,[(a(!0),n(oe,null,ae(x.value,l=>(a(),n("div",{key:l.id,class:"bg-gray-900 rounded-lg p-4 flex gap-4"},[t("div",ms,[t("img",{src:Ne(l.photo),alt:l.username,class:"w-10 h-10 sm:w-12 sm:h-12 rounded-full object-cover bg-gray-700",onError:qe},null,40,gs)]),t("div",ps,[t("div",xs,[t("span",hs,c(l.username),1),t("span",fs,c(l.addtime),1)]),t("p",ys,c(Ue(l.content)),1)])]))),128))])):h.value?v("",!0):(a(),n("div",bs," 暂无评论 ")),h.value?(a(),n("div",ws,[K(le)])):v("",!0),E.value&&!h.value?(a(),n("button",{key:3,onClick:et,class:"w-full py-3 bg-gray-700 text-white rounded-lg hover:bg-gray-600 transition-colors"}," 加载更多评论 ")):v("",!0)])):v("",!0)])])])),A.value?(a(),n("div",{key:2,ref_key:"readingContainer",ref:w,class:"fixed inset-0 z-50 bg-black overflow-auto",onScroll:Qe},[t("div",{class:"fixed top-0 left-0 right-0 z-50 bg-gray-900/95 backdrop-blur-sm border-b border-gray-800 transition-transform duration-300",style:W({transform:D.value?"translateY(0)":"translateY(-100%)"})},[t("div",ks,[t("div",_s,[t("button",{onClick:ge,class:"px-3 py-1.5 bg-gray-700 hover:bg-gray-600 rounded-lg text-white text-sm font-medium transition-all flex items-center gap-1.5",title:"关闭 (ESC)"},[...e[19]||(e[19]=[t("svg",{class:"w-4 h-4",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24"},[t("path",{"stroke-linecap":"round","stroke-linejoin":"round","stroke-width":"2",d:"M6 18L18 6M6 6l12 12"})],-1),t("span",{class:"hidden sm:inline"},"关闭",-1)])]),t("div",Cs,[t("span",Ss,c(_e.value),1),t("span",Is,c(T.value+1)+"/"+c(g.value.length),1)]),t("div",js,[t("span",Ms,c(_e.value),1),t("span",zs,c(T.value+1)+"/"+c(g.value.length),1)]),t("div",Hs,[t("button",{onClick:e[4]||(e[4]=l=>de.value=!0),class:_(["px-2 sm:px-3 py-1.5 rounded-lg text-sm font-medium transition-all flex items-center gap-1 sm:gap-1.5",k.value?"bg-green-600 hover:bg-green-700 text-white":"bg-gray-600 hover:bg-gray-700 text-gray-300"]),title:"自动滚动设置"},[(a(),n("svg",{class:_(["w-4 h-4",k.value&&"animate-spin-slow"]),fill:"none",stroke:"currentColor",viewBox:"0 0 24 24"},[...e[20]||(e[20]=[t("path",{"stroke-linecap":"round","stroke-linejoin":"round","stroke-width":"2",d:"M10.325 4.317c.426-1.756 2.924-1.756 3.35 0a1.724 1.724 0 002.573 1.066c1.543-.94 3.31.826 2.37 2.37a1.724 1.724 0 001.065 2.572c1.756.426 1.756 2.924 0 3.35a1.724 1.724 0 00-1.066 2.573c.94 1.543-.826 3.31-2.37 2.37a1.724 1.724 0 00-2.572 1.065c-.426 1.756-2.924 1.756-3.35 0a1.724 1.724 0 00-2.573-1.066c-1.543.94-3.31-.826-2.37-2.37a1.724 1.724 0 00-1.065-2.572c-1.756-.426-1.756-2.924 0-3.35a1.724 1.724 0 001.066-2.573c-.94-1.543.826-3.31 2.37-2.37.996.608 2.296.07 2.572-1.065z"},null,-1),t("path",{"stroke-linecap":"round","stroke-linejoin":"round","stroke-width":"2",d:"M15 12a3 3 0 11-6 0 3 3 0 016 0z"},null,-1)])],2)),e[21]||(e[21]=t("span",{class:"hidden sm:inline"},"设置",-1))],2),Ce.value?(a(),n("button",{key:0,onClick:Xe,class:"px-2 sm:px-3 py-1.5 bg-gray-600 hover:bg-gray-700 rounded-lg text-white text-sm font-medium transition-all flex items-center gap-1 sm:gap-1.5",title:"上一话"},[...e[22]||(e[22]=[t("svg",{class:"w-4 h-4",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24"},[t("path",{"stroke-linecap":"round","stroke-linejoin":"round","stroke-width":"2",d:"M15 19l-7-7 7-7"})],-1),t("span",{class:"hidden sm:inline"},"上一话",-1)])])):v("",!0),me.value?(a(),n("button",{key:1,onClick:We,class:"px-2 sm:px-3 py-1.5 bg-pink-500 hover:bg-pink-600 rounded-lg text-white text-sm font-medium transition-all flex items-center gap-1 sm:gap-1.5",title:"下一话"},[...e[23]||(e[23]=[t("span",{class:"hidden sm:inline"},"下一话",-1),t("svg",{class:"w-4 h-4",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24"},[t("path",{"stroke-linecap":"round","stroke-linejoin":"round","stroke-width":"2",d:"M9 5l7 7-7 7"})],-1)])])):v("",!0)])])]),t("div",Ls,[t("div",{class:"h-full bg-gradient-to-r from-pink-500 to-pink-400 transition-all duration-300 ease-out",style:W({width:`${ke.value}%`})},null,4)])],4),t("div",{class:"fixed top-0 left-0 right-0 z-50 h-1 bg-gray-800",style:W({transform:D.value?"translateY(-100%)":"translateY(0)"})},[t("div",{class:"h-full bg-gradient-to-r from-pink-500 to-pink-400 transition-all duration-300 ease-out",style:W({width:`${ke.value}%`})},null,4)],4),k.value?(a(),n("button",{key:0,onClick:ot,class:"fixed bottom-4 left-4 z-[55] p-2.5 sm:p-3 bg-gray-800/20 hover:bg-gray-800/40 text-white/30 hover:text-white/50 rounded-full backdrop-blur-sm transition-all duration-200 shadow-lg",title:$.value?"继续滚动":"暂停滚动"},[$.value?(a(),n("svg",$s,[...e[24]||(e[24]=[t("path",{d:"M6.3 2.841A1.5 1.5 0 004 4.11V15.89a1.5 1.5 0 002.3 1.269l9.344-5.89a1.5 1.5 0 000-2.538L6.3 2.84z"},null,-1)])])):(a(),n("svg",Bs,[...e[25]||(e[25]=[t("path",{"fill-rule":"evenodd",d:"M18 10a8 8 0 11-16 0 8 8 0 0116 0zM7 8a1 1 0 012 0v4a1 1 0 11-2 0V8zm5-1a1 1 0 00-1 1v4a1 1 0 102 0V8a1 1 0 00-1-1z","clip-rule":"evenodd"},null,-1)])]))],8,Ts)):v("",!0),ce.value&&!g.value.length?(a(),n("div",Ps,[t("div",Rs,[K(le),e[26]||(e[26]=t("p",{class:"text-white mt-4"},"正在加载图片...",-1))])])):v("",!0),q.value?(a(),n("div",Es,[t("div",As,[e[27]||(e[27]=t("svg",{class:"w-12 h-12 text-red-400 mx-auto mb-4",fill:"currentColor",viewBox:"0 0 20 20"},[t("path",{"fill-rule":"evenodd",d:"M10 18a8 8 0 100-16 8 8 0 000 16zM8.707 7.293a1 1 0 00-1.414 1.414L8.586 10l-1.293 1.293a1 1 0 101.414 1.414L10 11.414l1.293 1.293a1 1 0 001.414-1.414L11.414 10l1.293-1.293a1 1 0 00-1.414-1.414L10 8.586 8.707 7.293z","clip-rule":"evenodd"})],-1)),t("p",Vs,c(q.value),1),t("div",{class:"flex gap-3 justify-center mt-4"},[t("button",{onClick:Ze,class:"px-4 py-2 bg-red-600 text-white rounded-lg hover:bg-red-700 transition-colors"}," 重试 "),t("button",{onClick:ge,class:"px-4 py-2 bg-gray-600 text-white rounded-lg hover:bg-gray-700 transition-colors"}," 退出 ")])])])):v("",!0),g.value.length?(a(),n("div",Ds,[t("div",Fs,[(a(!0),n(oe,null,ae(g.value,(l,i)=>(a(),n("div",{key:i,ref_for:!0,ref:r=>U.value[i]=r,class:_(["comic-image-container relative flex items-center justify-center",{"min-h-[300px] sm:min-h-[500px]":!l.loaded}]),"data-index":i},[l.loaded?v("",!0):(a(),n("div",Ys,[l.error?(a(),n("div",{key:1,onClick:r=>tt(i),class:"cursor-pointer text-red-400 hover:text-red-300 text-center"},[...e[28]||(e[28]=[t("svg",{class:"w-12 h-12 mx-auto mb-2",fill:"currentColor",viewBox:"0 0 20 20"},[t("path",{"fill-rule":"evenodd",d:"M10 18a8 8 0 100-16 8 8 0 000 16zM8.707 7.293a1 1 0 00-1.414 1.414L8.586 10l-1.293 1.293a1 1 0 101.414 1.414L10 11.414l1.293 1.293a1 1 0 001.414-1.414L11.414 10l1.293-1.293a1 1 0 00-1.414-1.414L10 8.586 8.707 7.293z","clip-rule":"evenodd"})],-1),t("p",null,"加载失败，点击重试",-1)])],8,Us)):(a(),n("div",qs,[K(le),t("p",Os,c(l.loading?"加载中...":`${i+1}`),1)]))])),l.needProcess?ne((a(),n("canvas",{key:1,ref_for:!0,ref:r=>ye.value[i]=r,class:"w-full h-auto block"},null,512)),[[_t,l.loaded]]):v("",!0),!l.needProcess&&l.loaded?(a(),n("img",{key:2,src:l.displaySrc||l.src,alt:`Page ${i+1}`,class:"w-full h-auto block"},null,8,Js)):v("",!0)],10,Ns))),128)),me.value?(a(),n("div",Gs,[t("button",{onClick:He,class:"px-8 py-4 bg-gradient-to-r from-pink-500 to-pink-600 text-white rounded-lg hover:from-pink-600 hover:to-pink-700 transition-all shadow-lg flex items-center gap-3 text-lg font-semibold"},[...e[29]||(e[29]=[t("span",null,"下一话",-1),t("svg",{class:"w-6 h-6",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24"},[t("path",{"stroke-linecap":"round","stroke-linejoin":"round","stroke-width":"2",d:"M13 7l5 5m0 0l-5 5m5-5H6"})],-1)])])])):v("",!0)])])):v("",!0),(a(),ht(bt,{to:"body"},[K(yt,{name:"fade"},{default:ft(()=>[de.value?(a(),n("div",Ks,[t("div",Qs,[e[36]||(e[36]=t("h3",{class:"text-base sm:text-lg font-bold text-white mb-3 sm:mb-4"},"自动滚动设置",-1)),j.value==="smooth"?(a(),n("div",Ws,[t("label",Xs," 滚动速度: "+c(F.value)+" 像素/秒 ",1),ne(t("input",{type:"range","onUpdate:modelValue":e[5]||(e[5]=l=>F.value=l),onChange:rt,min:"10",max:"500",step:"10",class:"w-full h-2 bg-gray-700 rounded-lg appearance-none cursor-pointer slider"},null,544),[[xe,F.value]]),e[30]||(e[30]=t("div",{class:"flex justify-between text-[10px] sm:text-xs text-gray-500 mt-1"},[t("span",null,"慢"),t("span",null,"中"),t("span",null,"快"),t("span",null,"极快")],-1))])):v("",!0),j.value==="stepped"?(a(),n("div",Zs,[t("div",null,[t("label",el," 跳动间隔: "+c(N.value)+" 秒 ",1),ne(t("input",{type:"range","onUpdate:modelValue":e[6]||(e[6]=l=>N.value=l),onChange:Re,min:"0.5",max:"5",step:"0.5",class:"w-full h-2 bg-gray-700 rounded-lg appearance-none cursor-pointer slider"},null,544),[[xe,N.value]]),e[31]||(e[31]=t("div",{class:"flex justify-between text-[10px] sm:text-xs text-gray-500 mt-1"},[t("span",null,"快速"),t("span",null,"中等"),t("span",null,"缓慢")],-1))]),t("div",null,[t("label",tl," 跳动距离: "+c(Y.value)+" 像素 ",1),ne(t("input",{type:"range","onUpdate:modelValue":e[7]||(e[7]=l=>Y.value=l),onChange:Re,min:"50",max:"800",step:"25",class:"w-full h-2 bg-gray-700 rounded-lg appearance-none cursor-pointer slider"},null,544),[[xe,Y.value]]),e[32]||(e[32]=t("div",{class:"flex justify-between text-[10px] sm:text-xs text-gray-500 mt-1"},[t("span",null,"小"),t("span",null,"中"),t("span",null,"大"),t("span",null,"特大")],-1))])])):v("",!0),t("div",sl,[e[33]||(e[33]=t("label",{class:"block text-xs sm:text-sm font-medium text-gray-300 mb-1.5 sm:mb-2"}," 滚动模式 ",-1)),t("div",ll,[t("button",{onClick:e[8]||(e[8]=l=>Pe("smooth")),class:_(["px-2 sm:px-3 py-1.5 sm:py-2 rounded-md sm:rounded-lg text-xs sm:text-sm font-medium transition-all",j.value==="smooth"?"bg-green-600 text-white":"bg-gray-700 text-gray-300 hover:bg-gray-600"])}," 平滑滚动 ",2),t("button",{onClick:e[9]||(e[9]=l=>Pe("stepped")),class:_(["px-2 sm:px-3 py-1.5 sm:py-2 rounded-md sm:rounded-lg text-xs sm:text-sm font-medium transition-all",j.value==="stepped"?"bg-green-600 text-white":"bg-gray-700 text-gray-300 hover:bg-gray-600"])}," 段落滚动 ",2)]),t("p",ol,c(j.value==="smooth"?"连续平滑滚动":"模拟鼠标滚轮，一次跳一小段"),1)]),t("div",al,[t("button",{onClick:lt,class:_(["w-full py-2 sm:py-3 px-3 sm:px-4 rounded-md sm:rounded-lg text-xs sm:text-sm font-medium transition-all",k.value?"bg-green-600 hover:bg-green-700 text-white":"bg-gray-700 hover:bg-gray-600 text-gray-300"])},[k.value?(a(),n("span",rl,"关闭自动滚动")):(a(),n("span",nl,"开启自动滚动"))],2)]),t("div",il,[t("button",{onClick:it,disabled:B.value,class:_(["w-full py-2 sm:py-3 px-3 sm:px-4 rounded-md sm:rounded-lg text-xs sm:text-sm font-medium transition-all",B.value?"bg-gray-700 text-gray-400 cursor-not-allowed":"bg-gray-700 hover:bg-gray-600 text-gray-400"])},[B.value?(a(),n("span",dl,[e[34]||(e[34]=t("svg",{class:"animate-spin h-3 sm:h-4 w-3 sm:w-4",fill:"none",viewBox:"0 0 24 24"},[t("circle",{class:"opacity-25",cx:"12",cy:"12",r:"10",stroke:"currentColor","stroke-width":"4"}),t("path",{class:"opacity-75",fill:"currentColor",d:"M4 12a8 8 0 018-8V0C5.373 0 0 5.373 0 12h4zm2 5.291A7.962 7.962 0 014 12H0c0 3.042 1.135 5.824 3 7.938l3-2.647z"})],-1)),t("span",vl,"加载中... "+c(V.value)+"/"+c(g.value.length),1)])):(a(),n("span",cl,"加载全部图片"))],10,ul),e[35]||(e[35]=t("p",{class:"text-[10px] sm:text-xs text-gray-500 mt-1 sm:mt-2"}," 立即加载所有图片，不再等待滚动触发 ",-1))]),e[37]||(e[37]=t("div",{class:"text-[10px] sm:text-xs text-gray-500 space-y-0.5 sm:space-y-1 mb-3 sm:mb-4"},[t("p",null,"• 自动滚动会在图片加载完成后继续")],-1)),t("button",{onClick:e[10]||(e[10]=l=>de.value=!1),class:"w-full py-1.5 sm:py-2 px-3 sm:px-4 bg-gray-800 hover:bg-gray-700 text-gray-300 rounded-md sm:rounded-lg text-xs sm:text-sm font-medium transition-colors"}," 关闭 ")])])):v("",!0)]),_:1})]))],544)):v("",!0)]))}},hl=ct(ml,[["__scopeId","data-v-627d3204"]]);export{hl as default};
