import{i as e,C as t,r as a,o as l,Y as s,c as o,w as r,l as i,M as n,a as c,b as u,f as d,d as v,v as p,x as g,L as m,F as h,h as f,U as y,$ as x}from"./index-Dk5K0Uig.js";import{g as b,t as w}from"./videoCollection-CuSUpTes.js";import{V as k,g as _}from"./VideoLayout-CbyKK0LD.js";import{_ as C}from"./Pagination-Drr-IQOn.js";const j={class:"container mx-auto px-4 py-6"},M={class:"mb-6"},V={class:"flex justify-between items-center"},$={class:"text-gray-400"},L={class:"text-pink-500 font-medium"},z={key:0,class:"flex justify-center py-20"},B={key:1,class:"text-center py-12"},A={key:2},D={class:"grid grid-cols-2 sm:grid-cols-3 md:grid-cols-4 lg:grid-cols-5 xl:grid-cols-6 gap-4"},U={class:"relative"},W={class:"relative bg-gray-900/60 backdrop-blur-sm border border-white/10 rounded-lg overflow-hidden group-hover:border-pink-500/30 transition-all"},q={class:"relative overflow-hidden bg-gray-800/50 aspect-video"},E=["src","alt"],F={class:"p-1.5 sm:p-2"},I={class:"text-xs sm:text-sm font-semibold text-white line-clamp-2 mb-1.5 h-8 sm:h-10"},P={class:"flex items-center gap-1.5 text-[10px] sm:text-xs text-gray-400"},T={class:"truncate"},Y=["onClick"],G={class:"mt-8"},H={__name:"VideoCollectionView",setup(H){const J=i(),K=e(),N=t(),O=a([]),Q=a(!1),R=a(1),S=a(1),X=a(0),Z=a(""),ee=a(!1),te=a(null),ae=e=>{e.target.src="/img_6.png"},le=e=>{if(!e)return"";const t=new Date(e),a=new Date-t,l=Math.floor(a/864e5);return 0===l?"今天":1===l?"昨天":l<7?`${l}天前`:l<30?`${Math.floor(l/7)}周前`:l<365?`${Math.floor(l/30)}月前`:`${Math.floor(l/365)}年前`},se=async(e=1)=>{Q.value=!0;try{const t=await b(e,24);O.value=t.data||[],R.value=t.current_page||1,S.value=t.last_page||1,X.value=t.total||0}catch(t){N.error("加载收藏列表失败")}finally{Q.value=!1}},oe=async()=>{if(!te.value)return;const e=te.value,t=e.video_id||e.id;try{if(!1===(await w({id:t,vod_id:t,name:e.name,cover:e.cover||null})).is_collected){const e=O.value.findIndex(e=>(e.video_id||e.id)===t);e>-1&&(O.value.splice(e,1),X.value--),N.success("已移除收藏"),0===O.value.length&&R.value>1&&ie(R.value-1)}ee.value=!1,te.value=null}catch(a){N.error(a.response?.data?.message||"移除失败，请稍后重试"),ee.value=!1,te.value=null}},re=()=>{ee.value=!1,te.value=null},ie=e=>{se(e),window.scrollTo(0,0)},ne=()=>{K.isAuthenticated?se():J.push({path:"/login",query:{redirect:"/video-collection"}})};return l(async()=>{await(async()=>{try{const e=await _(),t=e.data||e;t.cdn_domain&&(Z.value=t.cdn_domain)}catch(e){}})(),ne()}),s(()=>{ne()}),(e,t)=>{const a=n("router-link");return c(),o(k,{title:"我的收藏"},{default:r(()=>[u("div",j,[u("div",M,[u("div",V,[u("div",null,[t[4]||(t[4]=u("h1",{class:"text-2xl font-bold text-white mb-2"},"我的视频收藏",-1)),u("p",$,[t[2]||(t[2]=p(" 共 ",-1)),u("span",L,g(X.value),1),t[3]||(t[3]=p(" 个视频 ",-1))])])])]),Q.value?(c(),v("div",z,[d(m)])):O.value.length?(c(),v("div",A,[u("div",D,[(c(!0),v(h,null,f(O.value,e=>(c(),v("div",{key:e.video_id||e.id,class:"relative group",onClick:t[0]||(t[0]=y(()=>{},["stop"]))},[u("div",U,[d(a,{to:`/video/${e.video_id}`,class:"block relative"},{default:r(()=>{return[t[9]||(t[9]=u("div",{class:"absolute inset-0 bg-gradient-to-r from-pink-500 via-purple-500 to-blue-500 rounded-lg opacity-0 group-hover:opacity-50 blur-sm transition-opacity"},null,-1)),u("div",W,[u("div",q,[u("img",{src:(a=e.cover,a&&Z.value?a.startsWith("http://")||a.startsWith("https://")?a:Z.value+a:a||"/img_6.png"),alt:e.name,class:"w-full h-full object-cover group-hover:opacity-90 transition-opacity",onError:ae,loading:"lazy"},null,40,E),t[8]||(t[8]=u("div",{class:"absolute inset-0 flex items-center justify-center opacity-0 group-hover:opacity-100 transition-opacity duration-300"},[u("div",{class:"w-12 h-12 sm:w-14 sm:h-14 bg-black/60 rounded-full flex items-center justify-center"},[u("svg",{class:"w-5 h-5 sm:w-6 sm:h-6 text-white ml-1",fill:"currentColor",viewBox:"0 0 20 20"},[u("path",{d:"M6.3 2.841A1.5 1.5 0 004 4.11V15.89a1.5 1.5 0 002.3 1.269l9.344-5.89a1.5 1.5 0 000-2.538L6.3 2.84z"})])])],-1))]),u("div",F,[u("h3",I,g(e.name),1),u("div",P,[u("span",T,g(le(e.created_at)),1)])])])];var a}),_:2},1032,["to"]),u("button",{type:"button",onClick:y(t=>(e=>{te.value=e,ee.value=!0})(e),["stop","prevent"]),class:"absolute top-2 right-2 p-2 bg-red-600 sm:bg-gray-900/90 hover:bg-red-600 text-white rounded-full opacity-100 sm:opacity-0 sm:group-hover:opacity-100 transition-all duration-200 shadow-lg z-50 cursor-pointer",title:"移除收藏"},[...t[10]||(t[10]=[u("svg",{class:"w-4 h-4",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24"},[u("path",{"stroke-linecap":"round","stroke-linejoin":"round","stroke-width":"2",d:"M6 18L18 6M6 6l12 12"})],-1)])],8,Y)])]))),128))]),u("div",G,[d(C,{"current-page":R.value,"total-pages":S.value,onChange:ie},null,8,["current-page","total-pages"])])])):(c(),v("div",B,[t[6]||(t[6]=u("svg",{class:"w-24 h-24 text-gray-600 mx-auto mb-4",fill:"currentColor",viewBox:"0 0 20 20"},[u("path",{d:"M5 5a2 2 0 012-2h10a2 2 0 012 2v16l-7-3.5L5 21V5z"})],-1)),t[7]||(t[7]=u("p",{class:"text-gray-400 mb-4"},"还没有收藏任何视频",-1)),d(a,{to:"/video",class:"inline-block px-6 py-2 bg-gradient-to-r from-pink-500 to-rose-500 hover:from-pink-600 hover:to-rose-600 text-white rounded-lg transition-all cursor-pointer shadow-lg hover:shadow-xl"},{default:r(()=>[...t[5]||(t[5]=[p(" 去看看在线视频 ",-1)])]),_:1})]))]),d(x,{modelValue:ee.value,"onUpdate:modelValue":t[1]||(t[1]=e=>ee.value=e),title:"移除收藏",message:`确定要移除《${te.value?.name||""}》吗？`,"confirm-text":"移除","cancel-text":"取消","confirm-button-class":"bg-red-600 hover:bg-red-700 text-white",onConfirm:oe,onCancel:re},null,8,["modelValue","message"])]),_:1})}}};export{H as default};
