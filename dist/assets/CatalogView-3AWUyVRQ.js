import{z as ve,r as n,B as de,j as ce,o as ge,X as pe,a0 as me,l as be,c as Y,w as H,A as fe,q as ye,n as xe,k as ke,a1 as he,a as s,b as a,d as o,e as d,f as V,L as J,v as m,F as x,h as k,N as h,t as Z,s as Q,O as ee}from"./index-B8U4V0d9.js";import{_ as _e}from"./ComicCard-BlNPHx95.js";import{_ as te}from"./Pagination-6AH2mgT0.js";import{_ as Ce}from"./BottomDrawer-DWuMps4y.js";const we={class:"container mx-auto px-4 py-6"},Se={key:0,class:"relative"},Pe={class:"relative bg-gray-900/80 backdrop-blur-xl border border-white/10 rounded-lg p-4"},$e={class:"flex flex-col items-center"},Ie={key:1,class:"sm:hidden mb-4"},Ve={class:"bg-gradient-to-r from-pink-500/10 to-purple-500/10 rounded-xl p-[1px]"},Ne={class:"bg-gray-900/90 backdrop-blur-xl rounded-xl p-3"},Ae={class:"relative flex items-center justify-between bg-gray-800/90 backdrop-blur rounded-xl px-4 py-3 border border-gray-700 group-hover:border-pink-500/50 group-active:scale-[0.98] transition-all"},Be={class:"flex items-center gap-3"},De={class:"text-left"},Me={class:"text-sm font-medium text-white"},Oe={class:"flex gap-2 overflow-x-auto pb-1"},Fe=["onClick"],je={key:2,class:"hidden sm:block relative"},qe={class:"relative bg-gray-900/60 backdrop-blur-xl border border-white/10 rounded-lg p-4 space-y-4"},Le={class:"flex flex-wrap gap-2"},Re=["onClick"],Ue={key:0,class:"ml-1 text-xs opacity-70"},Te={class:"flex flex-wrap gap-2"},Je=["onClick"],Ee={key:0},ze={class:"flex flex-wrap gap-2"},Ge=["onClick"],Ke={key:3,class:"mt-4 mb-4"},We={key:4,class:"relative mt-2 sm:mt-4 mb-4 sm:mb-6"},Xe={class:"relative bg-gray-900/60 backdrop-blur-xl border border-white/10 rounded-lg p-3 sm:p-4"},Ye={class:"text-xs sm:text-sm text-gray-400 mb-1.5 sm:mb-2"},He={class:"flex flex-wrap gap-1.5 sm:gap-2"},Ze=["onClick"],Qe={key:5,class:"flex justify-center py-8 sm:py-12"},et={key:6,class:"grid grid-cols-2 sm:grid-cols-4 md:grid-cols-5 lg:grid-cols-6 xl:grid-cols-6 2xl:grid-cols-7 gap-3 sm:gap-3 md:gap-4 mt-4"},tt={key:7,class:"text-center py-8 sm:py-12"},lt={key:8,class:"flex justify-center py-6 sm:py-8"},at={key:9,class:"flex justify-center py-6 sm:py-8"},st={key:10,class:"mt-8"},ot={class:"px-4 pb-4"},rt={class:"grid grid-cols-2 gap-2"},nt=["onClick"],ut={key:0,class:"block text-xs opacity-70 mt-1"},it={class:"px-4 pb-4"},vt={class:"grid grid-cols-2 gap-2"},dt=["onClick"],ct={key:0,class:"px-4 pb-6"},gt={class:"grid grid-cols-2 gap-2"},pt=["onClick"],mt={name:"CatalogView"},bt=Object.assign(mt,{setup(ft){const R=ke(),D=ye(),M="catalogPageState",v=n([]),O=n([]),r=n(null),i=n(null),c=n("mv"),$=n(!1),F=[{label:"最新",value:""},{label:"最多爱心",value:"tf"},{label:"总排名",value:"mv"},{label:"月排名",value:"mv_m"},{label:"周排名",value:"mp_w"}],le=de(()=>[{label:"最新",value:""},{label:"总榜",value:"mv"},{label:"月榜",value:"mv_m"},{label:"周榜",value:"mp_w"}]),g=n([]),_=n(!1),N=n(!0),A=n(!0),I=n(!1),p=n(0),y=n(!0),C=n(!1),S=n(0),w=n(0),b=n(1),f=n(1),U=()=>{const l=D.query;if(l.page){const e=parseInt(l.page);!isNaN(e)&&e>0&&(p.value=e,f.value=e)}else p.value===0&&(p.value=1,f.value=1);if(l.o){const e=l.o;F.find(u=>u.value===e)&&(c.value=e)}if(l.c&&v.value.length>0)if(l.c.includes("_")){const[e,t]=l.c.split("_"),u=v.value.find(B=>B.slug===e);if(u&&(r.value=u,u.sub_categories)){const B=u.sub_categories.find(ie=>ie.slug===t);B&&(i.value=B)}}else{const e=v.value.find(t=>!!(t.slug&&t.slug===l.c||t.id&&String(t.id)===l.c||!isNaN(l.c)&&t.id===parseInt(l.c)));e&&(r.value=e,i.value=null)}},E=(l=!1)=>{const e={};if(e.page=f.value,c.value&&c.value!=="mv"&&(e.o=c.value),r.value){let t=r.value.slug||r.value.id;if(i.value){const u=i.value.slug||i.value.CID;t=`${t}_${u}`}t&&(e.c=t)}q.value=!0,l?R.push({query:e}):R.replace({query:e})},z=()=>{const l={categories:v.value,themeBlocks:O.value,selectedCategory:r.value,selectedSubCategory:i.value,selectedSort:c.value,comics:g.value,currentPage:p.value,displayPage:f.value,hasMore:y.value,totalItems:S.value,totalPages:b.value,itemsPerPage:w.value,hasSearched:C.value,timestamp:Date.now()};sessionStorage.setItem(M,JSON.stringify(l))},ae=()=>{try{const l=sessionStorage.getItem(M);if(!l)return!1;const e=JSON.parse(l);return Date.now()-e.timestamp>300*1e3?(sessionStorage.removeItem(M),!1):(v.value=e.categories||[],O.value=e.themeBlocks||[],r.value=e.selectedCategory,i.value=e.selectedSubCategory,c.value=e.selectedSort||"mv",g.value=e.comics||[],p.value=e.currentPage||1,f.value=e.displayPage||1,y.value=e.hasMore??!0,S.value=e.totalItems||0,b.value=e.totalPages||1,w.value=e.itemsPerPage||0,C.value=e.hasSearched??!1,_.value=!1,I.value=!1,A.value=!1,N.value=!1,!0)}catch(l){return console.error("Failed to restore state:",l),sessionStorage.removeItem(M),!1}},se=async()=>{A.value=!0;try{const l=await xe();l&&(v.value=l.categories||[],O.value=l.blocks||[],U(),!r.value&&v.value.length>0&&(r.value=v.value[0]),r.value&&P(!1))}catch(l){console.error("Failed to load categories:",l)}finally{A.value=!1,N.value=!1}},j=async(l=!1)=>{if(!(l&&_.value||!l&&I.value||!y.value&&!l)){l?_.value=!0:I.value=!0;try{let e=r.value?.slug||"";i.value&&e&&(e=`${e}_${i.value.slug}`);const t=await he(p.value,c.value,e);t?.content?(l?g.value=t.content:g.value.push(...t.content),t.total!==void 0&&(S.value=t.total),w.value===0&&t.content.length>0&&(w.value=t.content.length),S.value>0&&w.value>0?b.value=Math.ceil(S.value/w.value):b.value=p.value+(t.content.length>=80?1:0),f.value=p.value,l||p.value++,y.value=t.content.length>=80):(y.value=!1,l&&(b.value=0))}catch(e){console.error("Failed to load comics:",e),y.value=!1}finally{l?_.value=!1:I.value=!1}}},P=(l=!0)=>{g.value=[],l&&(p.value=1,f.value=1),y.value=!0,C.value=!0,S.value=0,w.value=0,b.value=1,E(),j(!0)},oe=l=>{R.push({path:"/search",query:{wd:l}})},re=l=>{r.value=l,i.value=null,P(!0)},G=l=>{c.value=l,P(!0)},K=l=>{i.value=l,P(!0)},ne=l=>{r.value=l,i.value=null,$.value=!1,P(!0)},ue=l=>{c.value=l,$.value=!1,P(!0)},W=l=>{i.value=l,$.value=!1,P(!0)},X=l=>{g.value=[],p.value=l,f.value=l,y.value=!0,E(),j(!0),window.scrollTo({top:0,behavior:"smooth"})},q=n(!1),T=n(!1);ce(()=>D.query,(l,e)=>{if(console.log("Route query watch triggered",{isMounted:T.value,routeName:D.name,isUpdatingUrl:q.value,newQuery:l,oldQuery:e}),!T.value){console.log("Skipping - not mounted");return}if(D.name!=="catalog"){console.log("Skipping - not on catalog page");return}if(q.value){console.log("Skipping - we are updating URL"),q.value=!1;return}if(!L.value&&JSON.stringify(l)===JSON.stringify(e)){console.log("Skipping - same query, just activated from keep-alive");return}console.log("Processing route change in watch"),v.value.length>0&&(U(),!r.value&&v.value.length>0&&(r.value=v.value[0]),r.value&&(g.value=[],y.value=!0,C.value=!0,S.value=0,w.value=0,b.value=1,console.log("Watch is calling loadComics"),j(!0)))},{deep:!0});const L=n(!0);return ge(()=>{console.log("CatalogView mounted (first time)"),ae()?N.value=!1:(U(),p.value===0&&(p.value=1,f.value=1),se()),setTimeout(()=>{T.value=!0},100)}),pe(()=>{console.log("CatalogView activated, isFirstActivation:",L.value),L.value||(N.value=!1,A.value=!1,console.log("Reusing existing state, no API call")),L.value=!1}),me(()=>{console.log("CatalogView deactivated, saving state"),z()}),be(()=>{console.log("CatalogView unmounting"),z()}),(l,e)=>(s(),Y(fe,{title:"分类浏览","page-loading":N.value},{default:H(()=>[a("div",we,[A.value?(s(),o("div",Se,[e[6]||(e[6]=a("div",{class:"absolute inset-0 bg-gradient-to-r from-pink-500/20 via-purple-500/20 to-blue-500/20 rounded-lg blur-xl"},null,-1)),a("div",Pe,[a("div",$e,[V(J),e[5]||(e[5]=a("span",{class:"mt-3 text-gray-400 text-sm"},"加载分类中...",-1))])])])):d("",!0),v.value.length>0?(s(),o("div",Ie,[a("div",Ve,[a("div",Ne,[a("button",{onClick:e[0]||(e[0]=t=>$.value=!0),class:"w-full mb-3 relative group"},[e[10]||(e[10]=a("div",{class:"absolute inset-0 bg-gradient-to-r from-pink-500/20 to-purple-500/20 rounded-xl blur group-active:blur-xl transition-all"},null,-1)),a("div",Ae,[a("div",Be,[e[8]||(e[8]=a("div",{class:"relative"},[a("svg",{class:"w-5 h-5 text-pink-400",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24"},[a("path",{"stroke-linecap":"round","stroke-linejoin":"round","stroke-width":"2",d:"M12 6V4m0 2a2 2 0 100 4m0-4a2 2 0 110 4m-6 8a2 2 0 100-4m0 4a2 2 0 110-4m0 4v2m0-6V4m6 6v10m6-2a2 2 0 100-4m0 4a2 2 0 110-4m0 4v2m0-6V4"})]),a("div",{class:"absolute inset-0 bg-pink-400 blur-lg opacity-50 animate-pulse"})],-1)),a("div",De,[e[7]||(e[7]=a("div",{class:"text-xs text-gray-400 mb-0.5"},"当前筛选",-1)),a("div",Me,m(r.value?.name||"全部")+" · "+m(F.find(t=>t.value===c.value)?.label||"最新"),1)])]),e[9]||(e[9]=a("div",{class:"flex items-center gap-2"},[a("span",{class:"text-xs text-pink-400 font-medium"},"点击修改"),a("div",{class:"bg-pink-500/20 rounded-lg p-1.5 group-hover:bg-pink-500/30 transition-colors"},[a("svg",{class:"w-4 h-4 text-pink-400",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24"},[a("path",{"stroke-linecap":"round","stroke-linejoin":"round","stroke-width":"2",d:"M19 9l-7 7-7-7"})])])],-1))])]),a("div",Oe,[(s(!0),o(x,null,k(le.value,t=>(s(),o("button",{key:t.value,onClick:u=>G(t.value),class:h(["flex-shrink-0 px-3 py-1.5 rounded-full text-xs font-medium transition-all",c.value===t.value?"bg-pink-500/20 text-pink-400 border border-pink-500/50":"bg-gray-800 text-gray-400 border border-gray-700"])},m(t.label),11,Fe))),128))])])])])):d("",!0),v.value.length>0?(s(),o("div",je,[e[14]||(e[14]=a("div",{class:"absolute inset-0 bg-gradient-to-r from-pink-500/10 via-purple-500/10 to-blue-500/10 rounded-lg blur-xl"},null,-1)),a("div",qe,[a("div",null,[e[11]||(e[11]=a("label",{class:"text-sm text-gray-400 mb-2 block"},"分类",-1)),a("div",Le,[(s(!0),o(x,null,k(v.value,t=>(s(),o("button",{key:t.id,onClick:u=>re(t),class:h(["px-4 py-2 rounded-lg text-sm font-medium transition-colors cursor-pointer",r.value?.id===t.id?"bg-pink-500/20 text-pink-400 border border-pink-500/50":"bg-gray-800/50 text-gray-300 hover:bg-gray-700/50 hover:text-white border border-gray-700"])},[Z(m(t.name)+" ",1),t.total_albums>0?(s(),o("span",Ue," ("+m(Q(ee)(t.total_albums))+") ",1)):d("",!0)],10,Re))),128))])]),a("div",null,[e[12]||(e[12]=a("label",{class:"text-sm text-gray-400 mb-2 block"},"排序",-1)),a("div",Te,[(s(),o(x,null,k(F,t=>a("button",{key:t.value,onClick:u=>G(t.value),class:h(["px-4 py-2 rounded-lg text-sm font-medium transition-colors cursor-pointer",c.value===t.value?"bg-pink-500/20 text-pink-400 border border-pink-500/50":"bg-gray-800/50 text-gray-300 hover:bg-gray-700/50 hover:text-white border border-gray-700"])},m(t.label),11,Je)),64))])]),r.value?.sub_categories?.length&&r.value.id!==0?(s(),o("div",Ee,[e[13]||(e[13]=a("label",{class:"text-sm text-gray-400 mb-2 block"},"子分类",-1)),a("div",ze,[a("button",{onClick:e[1]||(e[1]=t=>K(null)),class:h(["px-4 py-2 rounded-lg text-sm font-medium transition-colors cursor-pointer",i.value?"bg-gray-800/50 text-gray-300 hover:bg-gray-700/50 hover:text-white border border-gray-700":"bg-pink-500/20 text-pink-400 border border-pink-500/50"])}," 全部 ",2),(s(!0),o(x,null,k(r.value.sub_categories,t=>(s(),o("button",{key:t.CID,onClick:u=>K(t),class:h(["px-4 py-2 rounded-lg text-sm font-medium transition-colors cursor-pointer",i.value?.CID===t.CID?"bg-pink-500/20 text-pink-400 border border-pink-500/50":"bg-gray-800/50 text-gray-300 hover:bg-gray-700/50 hover:text-white border border-gray-700"])},m(t.name),11,Ge))),128))])])):d("",!0)])])):d("",!0),C.value&&b.value>1&&g.value.length>0?(s(),o("div",Ke,[V(te,{"current-page":f.value,"total-pages":b.value,onChange:X},null,8,["current-page","total-pages"])])):d("",!0),C.value?d("",!0):(s(),o("div",We,[e[15]||(e[15]=a("div",{class:"absolute inset-0 bg-gradient-to-r from-pink-500/10 via-purple-500/10 to-blue-500/10 rounded-lg blur-xl"},null,-1)),a("div",Xe,[(s(!0),o(x,null,k(O.value,t=>(s(),o("div",{key:t.title,class:"mb-3 sm:mb-4 last:mb-0"},[a("h3",Ye,m(t.title),1),a("div",He,[(s(!0),o(x,null,k(t.content,u=>(s(),o("button",{key:u,onClick:B=>oe(u),class:"px-2 sm:px-3 py-1 sm:py-1.5 bg-gray-800/50 hover:bg-pink-500/20 text-gray-300 hover:text-pink-400 border border-gray-700 hover:border-pink-500/50 rounded-full text-xs sm:text-sm transition-colors cursor-pointer"},m(u),9,Ze))),128))])]))),128))])])),_.value?(s(),o("div",Qe,[V(J)])):d("",!0),!_.value&&g.value.length>0?(s(),o("div",et,[(s(!0),o(x,null,k(g.value,t=>(s(),Y(_e,{key:t.id,comic:t},null,8,["comic"]))),128))])):d("",!0),!_.value&&C.value&&g.value.length===0?(s(),o("div",tt,[...e[16]||(e[16]=[a("p",{class:"text-gray-400 text-sm"},"暂无相关漫画",-1)])])):d("",!0),y.value&&!_.value&&!I.value&&g.value.length?(s(),o("div",lt,[a("button",{onClick:e[2]||(e[2]=t=>j()),class:"px-6 py-3 bg-pink-600 hover:bg-pink-700 text-white rounded-lg font-medium transition-colors cursor-pointer"}," 加载更多 ")])):d("",!0),I.value?(s(),o("div",at,[V(J)])):d("",!0),C.value&&b.value>1&&g.value.length>0?(s(),o("div",st,[V(te,{"current-page":f.value,"total-pages":b.value,onChange:X},null,8,["current-page","total-pages"])])):d("",!0),V(Ce,{modelValue:$.value,"onUpdate:modelValue":e[4]||(e[4]=t=>$.value=t),title:"选择筛选条件","max-height":"90vh"},{default:H(()=>[a("div",ot,[e[17]||(e[17]=a("div",{class:"text-sm text-gray-400 mb-3"},"分类",-1)),a("div",rt,[(s(!0),o(x,null,k(v.value,t=>(s(),o("button",{key:t.id,onClick:u=>ne(t),class:h(["py-3 rounded-lg text-sm font-medium transition-colors",r.value?.id===t.id?"bg-pink-500/20 text-pink-400 border border-pink-500/50":"bg-gray-800 text-gray-300 border border-gray-700"])},[Z(m(t.name)+" ",1),t.total_albums>0?(s(),o("span",ut," ("+m(Q(ee)(t.total_albums))+") ",1)):d("",!0)],10,nt))),128))])]),a("div",it,[e[18]||(e[18]=a("div",{class:"text-sm text-gray-400 mb-3"},"排序方式",-1)),a("div",vt,[(s(),o(x,null,k(F,t=>a("button",{key:t.value,onClick:u=>ue(t.value),class:h(["py-3 rounded-lg text-sm font-medium transition-colors",c.value===t.value?"bg-pink-500/20 text-pink-400 border border-pink-500/50":"bg-gray-800 text-gray-300 border border-gray-700"])},m(t.label),11,dt)),64))])]),r.value?.sub_categories?.length&&r.value.id!==0?(s(),o("div",ct,[e[19]||(e[19]=a("div",{class:"text-sm text-gray-400 mb-3"},"子分类",-1)),a("div",gt,[a("button",{onClick:e[3]||(e[3]=t=>W(null)),class:h(["py-3 rounded-lg text-sm font-medium transition-colors",i.value?"bg-gray-800 text-gray-300 border border-gray-700":"bg-pink-500/20 text-pink-400 border border-pink-500/50"])}," 全部 ",2),(s(!0),o(x,null,k(r.value.sub_categories,t=>(s(),o("button",{key:t.CID,onClick:u=>W(t),class:h(["py-3 rounded-lg text-sm font-medium transition-colors",i.value?.CID===t.CID?"bg-pink-500/20 text-pink-400 border border-pink-500/50":"bg-gray-800 text-gray-300 border border-gray-700"])},m(t.name),11,pt))),128))])])):d("",!0)]),_:1},8,["modelValue"])])]),_:1},8,["page-loading"]))}}),_t=ve(bt,[["__scopeId","data-v-b762bc6a"]]);export{_t as default};
