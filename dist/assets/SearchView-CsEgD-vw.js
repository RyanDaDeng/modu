import{k as A,r as d,w as B,o as C,u as L,a as R,b as T,c,d as r,t as z,e as S,g as x,L as w,F as N,f as O,l as V,m as j,i as l,j as $}from"./index-R3dXyy7_.js";import{_ as q}from"./ComicCard-Vk7YaCoR.js";import"./format-BZgmAhtB.js";const D={class:"bg-gray-900 min-h-screen"},F={class:"container mx-auto px-4 py-6"},H={class:"mb-6"},Y={class:"text-2xl font-bold text-white"},J={key:0,class:"text-center py-12"},K={key:1},Q={key:0,class:"flex justify-center py-12"},U={key:1,class:"text-center py-12"},W={key:2,class:"grid grid-cols-3 sm:grid-cols-4 md:grid-cols-5 lg:grid-cols-6 xl:grid-cols-7 gap-3"},G={key:3,class:"flex justify-center py-8"},X={key:4,class:"text-center py-8 text-gray-400"},Z={name:"SearchView"},oe=Object.assign(Z,{setup(ee){const y=j(),b=L(),k=A(),a=d(""),o=d([]),i=d(!1),u=d(1),n=d(!0),f=d(null);let v=null;const h="searchPageState",m="searchPageScroll",p=()=>{const t={searchQuery:a.value,comics:o.value,currentPage:u.value,hasMore:n.value,timestamp:Date.now()};sessionStorage.setItem(h,JSON.stringify(t))},I=()=>{const t=sessionStorage.getItem(h);if(t)try{const e=JSON.parse(t);if(e.searchQuery===a.value&&Date.now()-e.timestamp<1800*1e3)return o.value=e.comics||[],u.value=e.currentPage||1,n.value=e.hasMore!==void 0?e.hasMore:!0,setTimeout(()=>{const s=sessionStorage.getItem(m);s&&window.scrollTo(0,parseInt(s))},100),!0}catch(e){console.error("Failed to restore search state:",e)}return!1},_=async(t=!1)=>{if(!(!a.value||i.value&&!t)&&(t&&(o.value=[],u.value=1,n.value=!0,k.addSearchHistory(a.value),sessionStorage.removeItem(h),sessionStorage.removeItem(m)),!!n.value)){i.value=!0;try{const e=await V(a.value,u.value);console.log("Search API response:",e);const s=Array.isArray(e)?e:e?.content||[];if(!s||s.length===0)n.value=!1;else{const E=s.map(P=>({...P,page:u.value}));o.value.push(...E),u.value++,s.length<80&&(n.value=!1)}p()}catch(e){console.error("Search failed:",e),n.value=!1}finally{i.value=!1}}},M=()=>{v&&v.disconnect(),v=new IntersectionObserver(t=>{t[0].isIntersecting&&!i.value&&n.value&&a.value&&_()},{rootMargin:"100px"}),f.value&&v.observe(f.value)},g=()=>{sessionStorage.setItem(m,window.scrollY.toString())};return B(()=>y.query.wd||y.query.q,t=>{t!==a.value&&(a.value=t||"",a.value&&(I()||_(!0)))},{immediate:!0}),C(()=>{M(),window.addEventListener("beforeunload",g),b.beforeEach((t,e,s)=>{e.name==="search"&&o.value.length>0&&(g(),p()),s()})}),R(()=>{o.value.length>0&&(g(),p())}),T(()=>{v&&v.disconnect(),window.removeEventListener("beforeunload",g)}),(t,e)=>(l(),c("div",D,[r("div",F,[r("div",H,[r("h1",Y,z(a.value?`搜索结果: ${a.value}`:"搜索"),1)]),a.value?(l(),c("div",K,[i.value&&!o.value.length?(l(),c("div",Q,[x(w)])):!o.value.length&&!i.value?(l(),c("div",U,[...e[1]||(e[1]=[r("svg",{class:"w-24 h-24 text-gray-600 mx-auto mb-4",fill:"currentColor",viewBox:"0 0 20 20"},[r("path",{"fill-rule":"evenodd",d:"M18 10a8 8 0 11-16 0 8 8 0 0116 0zm-7 4a1 1 0 11-2 0 1 1 0 012 0zm-1-9a1 1 0 00-1 1v4a1 1 0 102 0V6a1 1 0 00-1-1z","clip-rule":"evenodd"})],-1),r("p",{class:"text-gray-400"},"没有找到相关结果",-1)])])):(l(),c("div",W,[(l(!0),c(N,null,O(o.value,s=>(l(),$(q,{key:`${s.id}-${s.page}`,comic:s},null,8,["comic"]))),128))])),i.value&&o.value.length?(l(),c("div",G,[x(w)])):S("",!0),!n.value&&o.value.length?(l(),c("div",X," 没有更多结果了 ")):S("",!0),r("div",{ref_key:"loadMoreTrigger",ref:f,class:"h-20"},null,512)])):(l(),c("div",J,[...e[0]||(e[0]=[r("svg",{class:"w-24 h-24 text-gray-600 mx-auto mb-4",fill:"currentColor",viewBox:"0 0 20 20"},[r("path",{"fill-rule":"evenodd",d:"M8 4a4 4 0 100 8 4 4 0 000-8zM2 8a6 6 0 1110.89 3.476l4.817 4.817a1 1 0 01-1.414 1.414l-4.816-4.816A6 6 0 012 8z","clip-rule":"evenodd"})],-1),r("p",{class:"text-gray-400"},"请输入搜索关键词",-1)])]))])]))}});export{oe as default};
