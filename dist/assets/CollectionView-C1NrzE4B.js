import{u as A,r,o as M,U as N,c as V,w as y,A as P,k as S,V as D,C as T,a as c,b as t,f as u,d as v,G as U,L as $,I as j,F as z,h as E,N as k,W as q}from"./index-CstFYGIV.js";import{u as G}from"./useNotification-Cpt0kBMz.js";import{U as H}from"./UnifiedComicCard--Tmk3avU.js";import{_ as W}from"./Pagination-z2kYMrOR.js";import{C as J}from"./ConfirmationDialog-nP-EmNox.js";const K={class:"container mx-auto px-4 py-6"},O={class:"mb-6"},Q={class:"text-gray-400 mt-1"},X={key:0,class:"flex justify-center py-20"},Y={key:1,class:"text-center py-12"},Z={key:2},ee={class:"grid grid-cols-2 sm:grid-cols-3 md:grid-cols-4 lg:grid-cols-5 xl:grid-cols-6 gap-4"},oe={class:"relative"},te=["onClick"],se={class:"mt-8"},le=24,ue={__name:"CollectionView",setup(ae){const b=S(),p=A(),h=G(),a=r([]),g=r(!1),m=r(1),_=r(1),f=r(0),d=r(!1),l=r(null),L=e=>({id:e.comic_id||e.id,name:e.name||e.title,title:e.name||e.title,created_at:e.created_at}),w=async(e=1)=>{g.value=!0;try{const o=await D(e,le);a.value=(o.data||[]).map(s=>({...s,id:s.comic_id||s.id,title:s.name||s.title})),m.value=o.current_page||1,_.value=o.last_page||1,f.value=o.total||0,e===1&&(p.collectedComics=a.value)}catch(o){console.error("Failed to load collections:",o)}finally{g.value=!1}},R=e=>{console.log("Remove button clicked for comic:",e),F(e)},F=e=>{console.log("Remove handler called for comic:",e),l.value=e,d.value=!0},I=async()=>{if(!l.value)return;const e=l.value.comic_id||l.value.id;console.log("Removing comic with ID:",e);try{const o=await q(e);console.log("Remove response:",o);const s=a.value.findIndex(i=>(i.comic_id||i.id)===e);s>-1&&(a.value.splice(s,1),f.value--);const n=p.collectedComics.findIndex(i=>(i.comic_id||i.id)===e);n>-1&&p.collectedComics.splice(n,1),h.success("已移除收藏"),d.value=!1,l.value=null,a.value.length===0&&m.value>1&&C(m.value-1)}catch(o){console.error("Failed to remove collection:",o),console.error("Error details:",o.response?.data),h.error(o.response?.data?.message||"移除失败，请稍后重试"),d.value=!1,l.value=null}},B=()=>{d.value=!1,l.value=null},C=e=>{w(e),window.scrollTo(0,0)},x=()=>{if(!p.isLoggedIn){b.push({path:"/login",query:{redirect:"/collection"}});return}w()};return M(()=>{x()}),N(()=>{x()}),(e,o)=>{const s=T("router-link");return c(),V(P,{title:"我的收藏"},{default:y(()=>[t("div",K,[t("div",O,[t("p",Q,"共 "+U(f.value)+" 部作品",1)]),g.value?(c(),v("div",X,[u($)])):a.value.length?(c(),v("div",Z,[t("div",ee,[(c(!0),v(z,null,E(a.value,n=>(c(),v("div",{key:n.comic_id||n.id,class:"relative group",onClick:o[0]||(o[0]=k(()=>{},["stop"]))},[t("div",oe,[u(H,{comic:L(n),"show-collection-date":!0,"show-category":!1,"show-episode":!1,"show-stats":!1,"show-author":!1,"show-description":!1,"show-tags":!1},null,8,["comic"]),t("button",{type:"button",onClick:k(i=>R(n),["stop","prevent"]),class:"absolute top-2 right-2 p-2 bg-red-600 sm:bg-gray-900/90 hover:bg-red-600 text-white rounded-full opacity-100 sm:opacity-0 sm:group-hover:opacity-100 transition-all duration-200 shadow-lg z-50 cursor-pointer",title:"移除收藏"},[...o[4]||(o[4]=[t("svg",{class:"w-4 h-4",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24"},[t("path",{"stroke-linecap":"round","stroke-linejoin":"round","stroke-width":"2",d:"M6 18L18 6M6 6l12 12"})],-1)])],8,te)])]))),128))]),t("div",se,[u(W,{"current-page":m.value,"total-pages":_.value,onChange:C},null,8,["current-page","total-pages"])])])):(c(),v("div",Y,[o[2]||(o[2]=t("svg",{class:"w-24 h-24 text-gray-600 mx-auto mb-4",fill:"currentColor",viewBox:"0 0 20 20"},[t("path",{"fill-rule":"evenodd",d:"M3.172 5.172a4 4 0 015.656 0L10 6.343l1.172-1.171a4 4 0 115.656 5.656L10 17.657l-6.828-6.829a4 4 0 010-5.656z","clip-rule":"evenodd"})],-1)),o[3]||(o[3]=t("p",{class:"text-gray-400 mb-4"},"还没有收藏任何漫画",-1)),u(s,{to:"/latest",class:"inline-block px-6 py-2 bg-gradient-to-r from-pink-500 to-rose-500 hover:from-pink-600 hover:to-rose-600 text-white rounded-lg transition-all cursor-pointer shadow-lg hover:shadow-xl"},{default:y(()=>[...o[1]||(o[1]=[j(" 去看看最新漫画 ",-1)])]),_:1})]))]),u(J,{show:d.value,title:"移除收藏",message:`确定要移除《${l.value?.name||""}》吗？`,"confirm-text":"移除","cancel-text":"取消","confirm-button-class":"bg-red-600 hover:bg-red-700 text-white",onConfirm:I,onCancel:B},null,8,["show","message"])]),_:1})}}};export{ue as default};
