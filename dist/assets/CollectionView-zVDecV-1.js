import{u as e,C as a,r as l,o as t,Y as o,c as s,w as i,A as c,l as r,Z as n,M as d,a as u,b as v,f as m,d as p,v as g,x as h,L as f,F as x,h as w,U as y,$ as b,X as k}from"./index-Dk5K0Uig.js";import{U as _}from"./UnifiedComicCard-CFWAHUc5.js";import{_ as C}from"./Pagination-Drr-IQOn.js";const j={class:"container mx-auto px-4 py-6"},L={class:"mb-6"},M={class:"flex justify-between items-center"},U={class:"text-gray-400"},V={class:"text-pink-500 font-medium"},I={key:0,class:"flex justify-center py-20"},z={key:1,class:"text-center py-12"},B={key:2},$={class:"grid grid-cols-2 sm:grid-cols-3 md:grid-cols-4 lg:grid-cols-5 xl:grid-cols-6 gap-4"},q={class:"relative"},A=["onClick"],F={class:"mt-8"},P={__name:"CollectionView",setup(P){const T=r(),X=e(),Y=a(),Z=l([]),D=l(!1),E=l(1),G=l(1),H=l(0),J=l(!1),K=l(null),N=e=>({id:e.comic_id||e.id,name:e.name||e.title,title:e.name||e.title,created_at:e.created_at}),O=async(e=1)=>{D.value=!0;try{const a=await n(e,24);Z.value=(a.data||[]).map(e=>({...e,id:e.comic_id||e.id,title:e.name||e.title})),E.value=a.current_page||1,G.value=a.last_page||1,H.value=a.total||0,1===e&&(X.collectedComics=Z.value)}catch(a){}finally{D.value=!1}},Q=e=>{K.value=e,J.value=!0},R=async()=>{if(!K.value)return;const e=K.value,a=e.comic_id||e.id;try{if(!1===(await k({id:a,name:e.name||e.title,author:e.author||"",cover:e.cover||null})).is_collected){const e=Z.value.findIndex(e=>(e.comic_id||e.id)===a);e>-1&&(Z.value.splice(e,1),H.value--);const l=X.collectedComics.findIndex(e=>(e.comic_id||e.id)===a);l>-1&&X.collectedComics.splice(l,1),Y.success("已移除收藏"),0===Z.value.length&&E.value>1&&W(E.value-1)}J.value=!1,K.value=null}catch(l){Y.error(l.response?.data?.message||"移除失败，请稍后重试"),J.value=!1,K.value=null}},S=()=>{J.value=!1,K.value=null},W=e=>{O(e),window.scrollTo(0,0)},ee=()=>{X.isLoggedIn?O():T.push({path:"/login",query:{redirect:"/collection"}})};return t(()=>{ee()}),o(()=>{ee()}),(e,a)=>{const l=d("router-link");return u(),s(c,{title:"我的收藏"},{default:i(()=>[v("div",j,[v("div",L,[v("div",M,[v("div",null,[a[4]||(a[4]=v("h1",{class:"text-2xl font-bold text-white mb-2"},"我的收藏",-1)),v("p",U,[a[2]||(a[2]=g(" 共 ",-1)),v("span",V,h(H.value),1),a[3]||(a[3]=g(" 部作品 ",-1))])])])]),D.value?(u(),p("div",I,[m(f)])):Z.value.length?(u(),p("div",B,[v("div",$,[(u(!0),p(x,null,w(Z.value,e=>(u(),p("div",{key:e.comic_id||e.id,class:"relative group",onClick:a[0]||(a[0]=y(()=>{},["stop"]))},[v("div",q,[m(_,{comic:N(e),"show-collection-date":!0,"show-category":!1,"show-episode":!1,"show-stats":!1,"show-author":!1,"show-description":!1,"show-tags":!1},null,8,["comic"]),v("button",{type:"button",onClick:y(a=>(e=>{Q(e)})(e),["stop","prevent"]),class:"absolute top-2 right-2 p-2 bg-red-600 sm:bg-gray-900/90 hover:bg-red-600 text-white rounded-full opacity-100 sm:opacity-0 sm:group-hover:opacity-100 transition-all duration-200 shadow-lg z-50 cursor-pointer",title:"移除收藏"},[...a[8]||(a[8]=[v("svg",{class:"w-4 h-4",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24"},[v("path",{"stroke-linecap":"round","stroke-linejoin":"round","stroke-width":"2",d:"M6 18L18 6M6 6l12 12"})],-1)])],8,A)])]))),128))]),v("div",F,[m(C,{"current-page":E.value,"total-pages":G.value,onChange:W},null,8,["current-page","total-pages"])])])):(u(),p("div",z,[a[6]||(a[6]=v("svg",{class:"w-24 h-24 text-gray-600 mx-auto mb-4",fill:"currentColor",viewBox:"0 0 20 20"},[v("path",{"fill-rule":"evenodd",d:"M3.172 5.172a4 4 0 015.656 0L10 6.343l1.172-1.171a4 4 0 115.656 5.656L10 17.657l-6.828-6.829a4 4 0 010-5.656z","clip-rule":"evenodd"})],-1)),a[7]||(a[7]=v("p",{class:"text-gray-400 mb-4"},"还没有收藏任何漫画",-1)),m(l,{to:"/latest",class:"inline-block px-6 py-2 bg-gradient-to-r from-pink-500 to-rose-500 hover:from-pink-600 hover:to-rose-600 text-white rounded-lg transition-all cursor-pointer shadow-lg hover:shadow-xl"},{default:i(()=>[...a[5]||(a[5]=[g(" 去看看最新漫画 ",-1)])]),_:1})]))]),m(b,{modelValue:J.value,"onUpdate:modelValue":a[1]||(a[1]=e=>J.value=e),title:"移除收藏",message:`确定要移除《${K.value?.name||""}》吗？`,"confirm-text":"移除","cancel-text":"取消","confirm-button-class":"bg-red-600 hover:bg-red-700 text-white",onConfirm:R,onCancel:S},null,8,["modelValue","message"])]),_:1})}}};export{P as default};
