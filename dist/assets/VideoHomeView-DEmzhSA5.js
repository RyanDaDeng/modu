import{r as e,j as t,d as l,a,b as r,e as o,O as s,F as n,h as u,x as i,k as c,o as p,s as d,Y as v,a1 as g,m as x,c as h,w as b,l as y,f as m,Q as f,a5 as w,V as k,v as C}from"./index-bTbxLbx9.js";import{V as L,g as P,a as F}from"./VideoLayout-CSJ_5dAw.js";import{_ as T}from"./VideoGrid-DZJwvBB7.js";import{_ as S}from"./Pagination-BNzwtAqn.js";const _={class:"bg-gray-900/60 backdrop-blur-sm border border-white/10 rounded-lg p-4 space-y-4"},j={class:"flex flex-wrap gap-2"},V=["onClick"],M={class:"text-xs opacity-70"},q={class:"flex flex-wrap gap-2"},z=["onClick"],B={class:"flex flex-wrap gap-2"},$=["onClick"],D={__name:"VideoFilter",props:{categories:{type:Array,default:()=>[]},selectedType:{type:String,default:null},selectedSortFilter:{type:String,default:"latest"},selectedSource:{type:String,default:null}},emits:["update:type","update:sortFilter","update:source","reset"],setup(c){const p=c,d=e(!1),v=t(()=>d.value||p.categories.length<=10?p.categories:p.categories.slice(0,10)),g=[{value:"latest",label:"最新"},{value:"hot",label:"最热"},{value:"favorites",label:"最多收藏"}],x=[{value:"lebo",label:"乐播"},{value:"lajiao",label:"辣椒"},{value:"senlin",label:"森林"}];return(e,t)=>(a(),l("div",_,[r("div",null,[t[3]||(t[3]=r("h3",{class:"text-sm font-semibold text-white mb-3"},"分类",-1)),r("div",j,[r("button",{onClick:t[0]||(t[0]=t=>e.$emit("update:type",null)),class:s(["px-3 py-1.5 text-sm rounded-lg transition-all cursor-pointer",c.selectedType?"bg-white/5 text-gray-300 hover:bg-white/10 border border-white/10":"bg-gradient-to-r from-pink-500 to-purple-500 text-white"])}," 全部 ",2),(a(!0),l(n,null,u(v.value,(t,o)=>(a(),l("button",{key:t.value,onClick:l=>e.$emit("update:type",t.value),class:s(["px-3 py-1.5 text-sm rounded-lg transition-all flex items-center gap-1 cursor-pointer",c.selectedType===t.value?"bg-gradient-to-r from-pink-500 to-purple-500 text-white":"bg-white/5 text-gray-300 hover:bg-white/10 border border-white/10"])},[r("span",null,i(t.label),1),r("span",M,"("+i(t.count)+")",1)],10,V))),128)),c.categories.length>10?(a(),l("button",{key:0,onClick:t[1]||(t[1]=e=>d.value=!d.value),class:"px-3 py-1.5 text-sm rounded-lg transition-all cursor-pointer bg-blue-500/20 text-blue-400 hover:bg-blue-500/30 border border-blue-500/30"},i(d.value?"收起 ↑":"更多 ↓"),1)):o("",!0)])]),r("div",null,[t[4]||(t[4]=r("h3",{class:"text-sm font-semibold text-white mb-3"},"排序",-1)),r("div",q,[(a(),l(n,null,u(g,t=>r("button",{key:t.value,onClick:l=>e.$emit("update:sortFilter",t.value),class:s(["px-3 py-1.5 text-sm rounded-lg transition-all cursor-pointer",c.selectedSortFilter===t.value?"bg-gradient-to-r from-pink-500 to-purple-500 text-white":"bg-white/5 text-gray-300 hover:bg-white/10 border border-white/10"])},i(t.label),11,z)),64))])]),r("div",null,[t[5]||(t[5]=r("h3",{class:"text-sm font-semibold text-white mb-3"},"来源",-1)),r("div",B,[r("button",{onClick:t[2]||(t[2]=t=>e.$emit("update:source",null)),class:s(["px-3 py-1.5 text-sm rounded-lg transition-all cursor-pointer",c.selectedSource?"bg-white/5 text-gray-300 hover:bg-white/10 border border-white/10":"bg-gradient-to-r from-pink-500 to-purple-500 text-white"])}," 全部 ",2),(a(),l(n,null,u(x,(t,l)=>r("button",{key:t.value,onClick:l=>e.$emit("update:source",t.value),class:s(["px-3 py-1.5 text-sm rounded-lg transition-all cursor-pointer",c.selectedSource===t.value?"bg-gradient-to-r from-pink-500 to-purple-500 text-white":"bg-white/5 text-gray-300 hover:bg-white/10 border border-white/10"])},i(l+1)+"号资源 ",11,$)),64))])])]))}},I={class:"container mx-auto px-4 py-4 space-y-3"},O={class:"lg:hidden"},U={class:"relative"},A={class:"lg:hidden mb-3"},Y={key:0,class:"flex items-center gap-2 flex-wrap"},H={key:0,class:"inline-flex items-center gap-1 px-3 py-1 bg-pink-100 dark:bg-pink-900/30 text-pink-700 dark:text-pink-300 rounded-full text-sm cursor-pointer"},J={key:1,class:"inline-flex items-center gap-1 px-3 py-1 bg-blue-100 dark:bg-blue-900/30 text-blue-700 dark:text-blue-300 rounded-full text-sm cursor-pointer"},N={key:2,class:"inline-flex items-center gap-1 px-3 py-1 bg-purple-100 dark:bg-purple-900/30 text-purple-700 dark:text-purple-300 rounded-full text-sm cursor-pointer"},R={key:3,class:"inline-flex items-center gap-1 px-3 py-1 bg-green-100 dark:bg-green-900/30 text-green-700 dark:text-green-300 rounded-full text-sm cursor-pointer"},W={key:2,class:"flex justify-center mt-8"},X={name:"VideoHomeView"},G=Object.assign(X,{setup(n){const u=d(),_=y(),j="videoHomePageState",V=e([]),M=e([]),q=e(""),z=e(!1),B=e(!0),$=e(!1),X=e(""),G=e(null),K=e({type:null,sortFilter:"latest",source:null,searchText:null}),Q=e({currentPage:1,perPage:32,total:0,lastPage:1}),E=t(()=>null!==K.value.type||"latest"!==K.value.sortFilter||null!==K.value.source||null!==K.value.searchText),Z=t(()=>{if(!K.value.type)return"全部";const e=M.value.find(e=>e.value===K.value.type);return e?e.label:K.value.type}),ee=t(()=>({latest:"最新",hot:"最热",favorites:"最多收藏"}[K.value.sortFilter]||K.value.sortFilter)),te=t(()=>({lebo:"1号资源",lajiao:"2号资源",senlin:"3号资源"}[K.value.source]||K.value.source)),le=t(()=>K.value.type?`暂无「${Z.value}」分类的视频`:"暂无视频，试试换个筛选条件吧"),ae=()=>{const e={videos:V.value,categories:M.value,cdnDomain:q.value,filters:K.value,pagination:Q.value,showFilters:$.value,scrollPosition:{x:window.scrollX,y:window.scrollY},timestamp:Date.now()};sessionStorage.setItem(j,JSON.stringify(e))},re=async(e=1)=>{z.value=!0;try{const t={type:K.value.type,sort_filter:K.value.sortFilter,source:K.value.source,text:K.value.searchText,page:e,per_page:Q.value.perPage},l=await F(t),a=l.data||l;V.value=a.data||[],Q.value={currentPage:a.current_page||1,perPage:a.per_page||30,total:a.total||0,lastPage:a.last_page||1}}catch(t){V.value=[]}finally{z.value=!1}},oe=async()=>{try{const e=await P(),t=e.data||e;M.value=Array.isArray(t)?t:t.categories||t.data||[],t.cdn_domain&&(q.value=t.cdn_domain)}catch(e){M.value=[]}},se=(e,t)=>{K.value[e]=t,"searchText"===e&&null===t&&_.push({name:"video-home"}),re(1),window.innerWidth<1024&&($.value=!1)},ne=()=>{K.value={type:null,sortFilter:"latest",source:null,searchText:null},_.push({name:"video-home"}),re(1),window.innerWidth<1024&&($.value=!1)},ue=e=>{if(re(e),G.value){const e=G.value.offsetTop-20;window.scrollTo(0,e)}else window.scrollTo(0,0)},ie=()=>{const e=X.value.trim();e&&(_.push({name:"video-home",query:{q:e}}),X.value="")};c(()=>u.query.q,e=>{ce.value&&e!==K.value.searchText&&(K.value.searchText=e||null,re(1))});const ce=e(!1),pe=e(!0),de=e({x:0,y:0});return p(async()=>{if((()=>{try{const e=sessionStorage.getItem(j);if(!e)return!1;const t=JSON.parse(e);return Date.now()-t.timestamp>3e5?(sessionStorage.removeItem(j),!1):(V.value=t.videos||[],M.value=t.categories||[],q.value=t.cdnDomain||"",K.value=t.filters||{type:null,sortFilter:"latest",source:null,searchText:null},Q.value=t.pagination||{currentPage:1,perPage:32,total:0,lastPage:1},$.value=t.showFilters??!1,z.value=!1,B.value=!1,t.scrollPosition&&(de.value=t.scrollPosition),!0)}catch(e){return sessionStorage.removeItem(j),!1}})())B.value=!1;else try{const e=u.query.q;e&&(K.value.searchText=e),await Promise.all([oe(),re(1)])}catch(e){}finally{B.value=!1}ce.value=!0}),v(()=>{ce.value=!0,pe.value||(z.value=!1,B.value=!1,(de.value.y>0||de.value.x>0)&&setTimeout(()=>{window.scrollTo({top:de.value.y,left:de.value.x,behavior:"instant"})},0)),pe.value=!1}),g(()=>{ce.value=!1,de.value={x:window.scrollX,y:window.scrollY},ae()}),x(()=>{ae()}),(e,t)=>(a(),h(L,{title:"在线视频","page-loading":B.value,"show-top-nav":!0,"no-header":!0},{default:b(()=>[r("div",I,[r("div",O,[r("div",U,[f(r("input",{"onUpdate:modelValue":t[0]||(t[0]=e=>X.value=e),onKeyup:w(ie,["enter"]),type:"text",placeholder:"搜索视频...",class:"w-full px-3 py-2 pr-20 bg-gray-900/60 backdrop-blur-sm border border-white/10 rounded-lg text-sm text-white placeholder-gray-400 focus:outline-none focus:border-pink-500/50 transition-all"},null,544),[[k,X.value]]),X.value?(a(),l("button",{key:0,onClick:t[1]||(t[1]=e=>X.value=""),class:"absolute right-16 top-1/2 -translate-y-1/2 text-gray-400 hover:text-gray-200 cursor-pointer"},[...t[10]||(t[10]=[r("svg",{class:"w-4 h-4",fill:"currentColor",viewBox:"0 0 20 20"},[r("path",{"fill-rule":"evenodd",d:"M10 18a8 8 0 100-16 8 8 0 000 16zM8.707 7.293a1 1 0 00-1.414 1.414L8.586 10l-1.293 1.293a1 1 0 101.414 1.414L10 11.414l1.293 1.293a1 1 0 001.414-1.414L11.414 10l1.293-1.293a1 1 0 00-1.414-1.414L10 8.586 8.707 7.293z","clip-rule":"evenodd"})],-1)])])):o("",!0),r("button",{onClick:ie,class:"absolute right-1.5 top-1/2 -translate-y-1/2 px-3 py-1 text-sm bg-gradient-to-r from-pink-500 to-purple-500 hover:from-pink-600 hover:to-purple-600 text-white rounded-md transition-all cursor-pointer"}," 搜索 ")])]),r("div",null,[r("div",A,[r("button",{onClick:t[2]||(t[2]=e=>$.value=!$.value),class:"w-full flex items-center justify-between px-3 py-2 bg-gray-900/60 backdrop-blur-sm border border-white/10 rounded-lg hover:border-pink-500/30 transition-all"},[t[12]||(t[12]=r("span",{class:"text-sm font-medium text-white"}," 筛选条件 ",-1)),(a(),l("svg",{class:s(["w-4 h-4 text-gray-400 transition-transform",{"rotate-180":$.value}]),fill:"none",stroke:"currentColor",viewBox:"0 0 24 24"},[...t[11]||(t[11]=[r("path",{"stroke-linecap":"round","stroke-linejoin":"round","stroke-width":"2",d:"M19 9l-7 7-7-7"},null,-1)])],2))])]),r("div",{class:s(["transition-all duration-300",$.value?"block":"hidden lg:block"])},[m(D,{categories:M.value,"selected-type":K.value.type,"selected-sort-filter":K.value.sortFilter,"selected-source":K.value.source,"onUpdate:type":t[3]||(t[3]=e=>se("type",e)),"onUpdate:sortFilter":t[4]||(t[4]=e=>se("sortFilter",e)),"onUpdate:source":t[5]||(t[5]=e=>se("source",e)),onReset:ne},null,8,["categories","selected-type","selected-sort-filter","selected-source"])],2)]),E.value?(a(),l("div",Y,[t[17]||(t[17]=r("span",{class:"text-sm text-gray-500 dark:text-gray-400"},"当前筛选：",-1)),K.value.type?(a(),l("span",H,[C(i(Z.value)+" ",1),r("button",{onClick:t[6]||(t[6]=e=>se("type",null)),class:"hover:text-pink-900 dark:hover:text-pink-100"},[...t[13]||(t[13]=[r("svg",{class:"w-4 h-4",fill:"currentColor",viewBox:"0 0 20 20"},[r("path",{"fill-rule":"evenodd",d:"M4.293 4.293a1 1 0 011.414 0L10 8.586l4.293-4.293a1 1 0 111.414 1.414L11.414 10l4.293 4.293a1 1 0 01-1.414 1.414L10 11.414l-4.293 4.293a1 1 0 01-1.414-1.414L8.586 10 4.293 5.707a1 1 0 010-1.414z","clip-rule":"evenodd"})],-1)])])])):o("",!0),"latest"!==K.value.sortFilter?(a(),l("span",J,[C(i(ee.value)+" ",1),r("button",{onClick:t[7]||(t[7]=e=>se("sortFilter","latest")),class:"hover:text-blue-900 dark:hover:text-blue-100"},[...t[14]||(t[14]=[r("svg",{class:"w-4 h-4",fill:"currentColor",viewBox:"0 0 20 20"},[r("path",{"fill-rule":"evenodd",d:"M4.293 4.293a1 1 0 011.414 0L10 8.586l4.293-4.293a1 1 0 111.414 1.414L11.414 10l4.293 4.293a1 1 0 01-1.414 1.414L10 11.414l-4.293 4.293a1 1 0 01-1.414-1.414L8.586 10 4.293 5.707a1 1 0 010-1.414z","clip-rule":"evenodd"})],-1)])])])):o("",!0),K.value.source?(a(),l("span",N,[C(i(te.value)+" ",1),r("button",{onClick:t[8]||(t[8]=e=>se("source",null)),class:"hover:text-purple-900 dark:hover:text-purple-100"},[...t[15]||(t[15]=[r("svg",{class:"w-4 h-4",fill:"currentColor",viewBox:"0 0 20 20"},[r("path",{"fill-rule":"evenodd",d:"M4.293 4.293a1 1 0 011.414 0L10 8.586l4.293-4.293a1 1 0 111.414 1.414L11.414 10l4.293 4.293a1 1 0 01-1.414 1.414L10 11.414l-4.293 4.293a1 1 0 01-1.414-1.414L8.586 10 4.293 5.707a1 1 0 010-1.414z","clip-rule":"evenodd"})],-1)])])])):o("",!0),K.value.searchText?(a(),l("span",R,[C(" 搜索: "+i(K.value.searchText)+" ",1),r("button",{onClick:t[9]||(t[9]=e=>se("searchText",null)),class:"hover:text-green-900 dark:hover:text-green-100"},[...t[16]||(t[16]=[r("svg",{class:"w-4 h-4",fill:"currentColor",viewBox:"0 0 20 20"},[r("path",{"fill-rule":"evenodd",d:"M4.293 4.293a1 1 0 011.414 0L10 8.586l4.293-4.293a1 1 0 111.414 1.414L11.414 10l4.293 4.293a1 1 0 01-1.414 1.414L10 11.414l-4.293 4.293a1 1 0 01-1.414-1.414L8.586 10 4.293 5.707a1 1 0 010-1.414z","clip-rule":"evenodd"})],-1)])])])):o("",!0),r("button",{onClick:ne,class:"text-sm text-gray-500 hover:text-gray-700 dark:text-gray-400 dark:hover:text-gray-200 underline cursor-pointer"}," 清空筛选 ")])):o("",!0),V.value.length>0&&Q.value.total>0?(a(),l("div",{key:1,ref_key:"topPaginationRef",ref:G,class:"flex justify-center mb-6"},[m(S,{"current-page":Q.value.currentPage,"total-pages":Q.value.lastPage,onChange:ue},null,8,["current-page","total-pages"])],512)):o("",!0),m(T,{videos:V.value,loading:z.value,"empty-message":le.value,"cdn-domain":q.value},null,8,["videos","loading","empty-message","cdn-domain"]),V.value.length>0&&Q.value.total>0?(a(),l("div",W,[m(S,{"current-page":Q.value.currentPage,"total-pages":Q.value.lastPage,onChange:ue},null,8,["current-page","total-pages"])])):o("",!0)])]),_:1},8,["page-loading"]))}});export{G as default};
