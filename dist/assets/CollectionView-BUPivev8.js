import{u as M,r,o as S,X as T,c as N,w as b,A as P,k as j,Y as U,K as $,a as c,b as t,f as u,d as v,t as _,v as z,L as D,F as E,h as q,S as L,W as H}from"./index-CFF66pSp.js";import{u as K}from"./useNotification-DyDs8qma.js";import{U as W}from"./UnifiedComicCard-CocxfFDT.js";import{_ as X}from"./Pagination-Dm67CdCz.js";import{C as Y}from"./ConfirmationDialog-BQDMEnqq.js";const G={class:"container mx-auto px-4 py-6"},J={class:"mb-6"},O={class:"flex justify-between items-center"},Q={class:"text-gray-400"},Z={class:"text-pink-500 font-medium"},ee={key:0,class:"flex justify-center py-20"},oe={key:1,class:"text-center py-12"},te={key:2},le={class:"grid grid-cols-2 sm:grid-cols-3 md:grid-cols-4 lg:grid-cols-5 xl:grid-cols-6 gap-4"},se={class:"relative"},ae=["onClick"],ne={class:"mt-8"},re=24,ge={__name:"CollectionView",setup(ie){const R=j(),p=M(),x=K(),a=r([]),m=r(!1),g=r(1),w=r(1),f=r(0),i=r(!1),n=r(null),V=o=>({id:o.comic_id||o.id,name:o.name||o.title,title:o.name||o.title,created_at:o.created_at}),C=async(o=1)=>{m.value=!0;try{const e=await U(o,re);a.value=(e.data||[]).map(l=>({...l,id:l.comic_id||l.id,title:l.name||l.title})),g.value=e.current_page||1,w.value=e.last_page||1,f.value=e.total||0,o===1&&(p.collectedComics=a.value)}catch(e){console.error("Failed to load collections:",e)}finally{m.value=!1}},B=o=>{console.log("Remove button clicked for comic:",o),F(o)},F=o=>{console.log("Remove handler called for comic:",o),n.value=o,i.value=!0},A=async()=>{if(!n.value)return;const o=n.value,e=o.comic_id||o.id;console.log("Toggling collection for comic:",o);try{const l=await H({id:e,name:o.name||o.title,author:o.author||"",cover:o.cover||null});if(console.log("Toggle response:",l),l.is_collected===!1){const s=a.value.findIndex(d=>(d.comic_id||d.id)===e);s>-1&&(a.value.splice(s,1),f.value--);const h=p.collectedComics.findIndex(d=>(d.comic_id||d.id)===e);h>-1&&p.collectedComics.splice(h,1),x.success("已移除收藏"),a.value.length===0&&g.value>1&&y(g.value-1)}i.value=!1,n.value=null}catch(l){console.error("Failed to toggle collection:",l),console.error("Error details:",l.response?.data),x.error(l.response?.data?.message||"移除失败，请稍后重试"),i.value=!1,n.value=null}},I=()=>{i.value=!1,n.value=null},y=o=>{C(o),window.scrollTo(0,0)},k=()=>{if(!p.isLoggedIn){R.push({path:"/login",query:{redirect:"/collection"}});return}C()};return S(()=>{k()}),T(()=>{k()}),(o,e)=>{const l=$("router-link");return c(),N(P,{title:"我的收藏"},{default:b(()=>[t("div",G,[t("div",J,[t("div",O,[t("div",null,[e[4]||(e[4]=t("h1",{class:"text-2xl font-bold text-white mb-2"},"我的收藏",-1)),t("p",Q,[e[2]||(e[2]=_(" 共 ",-1)),t("span",Z,z(f.value),1),e[3]||(e[3]=_(" 部作品 ",-1))])])])]),m.value?(c(),v("div",ee,[u(D)])):a.value.length?(c(),v("div",te,[t("div",le,[(c(!0),v(E,null,q(a.value,s=>(c(),v("div",{key:s.comic_id||s.id,class:"relative group",onClick:e[0]||(e[0]=L(()=>{},["stop"]))},[t("div",se,[u(W,{comic:V(s),"show-collection-date":!0,"show-category":!1,"show-episode":!1,"show-stats":!1,"show-author":!1,"show-description":!1,"show-tags":!1},null,8,["comic"]),t("button",{type:"button",onClick:L(h=>B(s),["stop","prevent"]),class:"absolute top-2 right-2 p-2 bg-red-600 sm:bg-gray-900/90 hover:bg-red-600 text-white rounded-full opacity-100 sm:opacity-0 sm:group-hover:opacity-100 transition-all duration-200 shadow-lg z-50 cursor-pointer",title:"移除收藏"},[...e[8]||(e[8]=[t("svg",{class:"w-4 h-4",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24"},[t("path",{"stroke-linecap":"round","stroke-linejoin":"round","stroke-width":"2",d:"M6 18L18 6M6 6l12 12"})],-1)])],8,ae)])]))),128))]),t("div",ne,[u(X,{"current-page":g.value,"total-pages":w.value,onChange:y},null,8,["current-page","total-pages"])])])):(c(),v("div",oe,[e[6]||(e[6]=t("svg",{class:"w-24 h-24 text-gray-600 mx-auto mb-4",fill:"currentColor",viewBox:"0 0 20 20"},[t("path",{"fill-rule":"evenodd",d:"M3.172 5.172a4 4 0 015.656 0L10 6.343l1.172-1.171a4 4 0 115.656 5.656L10 17.657l-6.828-6.829a4 4 0 010-5.656z","clip-rule":"evenodd"})],-1)),e[7]||(e[7]=t("p",{class:"text-gray-400 mb-4"},"还没有收藏任何漫画",-1)),u(l,{to:"/latest",class:"inline-block px-6 py-2 bg-gradient-to-r from-pink-500 to-rose-500 hover:from-pink-600 hover:to-rose-600 text-white rounded-lg transition-all cursor-pointer shadow-lg hover:shadow-xl"},{default:b(()=>[...e[5]||(e[5]=[_(" 去看看最新漫画 ",-1)])]),_:1})]))]),u(Y,{modelValue:i.value,"onUpdate:modelValue":e[1]||(e[1]=s=>i.value=s),title:"移除收藏",message:`确定要移除《${n.value?.name||""}》吗？`,"confirm-text":"移除","cancel-text":"取消","confirm-button-class":"bg-red-600 hover:bg-red-700 text-white",onConfirm:A,onCancel:I},null,8,["modelValue","message"])]),_:1})}}};export{ge as default};
