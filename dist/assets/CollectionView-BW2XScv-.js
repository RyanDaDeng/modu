import{u as A,r,o as M,U as N,c as T,w as k,A as P,k as S,V as U,C as $,a as c,b as l,f as u,d as v,G as j,L as z,I as D,F as E,h as q,N as b,R as G}from"./index-DAKd_ngf.js";import{u as H}from"./useNotification-DLRAxpJf.js";import{U as J}from"./UnifiedComicCard-BfNHBtod.js";import{_ as K}from"./Pagination-C67jTV1L.js";import{C as O}from"./ConfirmationDialog-Dt4W5CrT.js";const Q={class:"container mx-auto px-4 py-6"},W={class:"mb-6"},X={class:"text-gray-400 mt-1"},Y={key:0,class:"flex justify-center py-20"},Z={key:1,class:"text-center py-12"},ee={key:2},oe={class:"grid grid-cols-2 sm:grid-cols-3 md:grid-cols-4 lg:grid-cols-5 xl:grid-cols-6 gap-4"},te={class:"relative"},le=["onClick"],se={class:"mt-8"},ae=24,ve={__name:"CollectionView",setup(ne){const L=S(),g=A(),_=H(),a=r([]),m=r(!1),p=r(1),C=r(1),f=r(0),i=r(!1),n=r(null),R=e=>({id:e.comic_id||e.id,name:e.name||e.title,title:e.name||e.title,created_at:e.created_at}),w=async(e=1)=>{m.value=!0;try{const o=await U(e,ae);a.value=(o.data||[]).map(t=>({...t,id:t.comic_id||t.id,title:t.name||t.title})),p.value=o.current_page||1,C.value=o.last_page||1,f.value=o.total||0,e===1&&(g.collectedComics=a.value)}catch(o){console.error("Failed to load collections:",o)}finally{m.value=!1}},V=e=>{console.log("Remove button clicked for comic:",e),B(e)},B=e=>{console.log("Remove handler called for comic:",e),n.value=e,i.value=!0},F=async()=>{if(!n.value)return;const e=n.value,o=e.comic_id||e.id;console.log("Toggling collection for comic:",e);try{const t=await G({id:o,name:e.name||e.title,author:e.author||"",cover:e.cover||null});if(console.log("Toggle response:",t),t.is_collected===!1){const s=a.value.findIndex(d=>(d.comic_id||d.id)===o);s>-1&&(a.value.splice(s,1),f.value--);const h=g.collectedComics.findIndex(d=>(d.comic_id||d.id)===o);h>-1&&g.collectedComics.splice(h,1),_.success("已移除收藏"),a.value.length===0&&p.value>1&&x(p.value-1)}i.value=!1,n.value=null}catch(t){console.error("Failed to toggle collection:",t),console.error("Error details:",t.response?.data),_.error(t.response?.data?.message||"移除失败，请稍后重试"),i.value=!1,n.value=null}},I=()=>{i.value=!1,n.value=null},x=e=>{w(e),window.scrollTo(0,0)},y=()=>{if(!g.isLoggedIn){L.push({path:"/login",query:{redirect:"/collection"}});return}w()};return M(()=>{y()}),N(()=>{y()}),(e,o)=>{const t=$("router-link");return c(),T(P,{title:"我的收藏"},{default:k(()=>[l("div",Q,[l("div",W,[l("p",X,"共 "+j(f.value)+" 部作品",1)]),m.value?(c(),v("div",Y,[u(z)])):a.value.length?(c(),v("div",ee,[l("div",oe,[(c(!0),v(E,null,q(a.value,s=>(c(),v("div",{key:s.comic_id||s.id,class:"relative group",onClick:o[0]||(o[0]=b(()=>{},["stop"]))},[l("div",te,[u(J,{comic:R(s),"show-collection-date":!0,"show-category":!1,"show-episode":!1,"show-stats":!1,"show-author":!1,"show-description":!1,"show-tags":!1},null,8,["comic"]),l("button",{type:"button",onClick:b(h=>V(s),["stop","prevent"]),class:"absolute top-2 right-2 p-2 bg-red-600 sm:bg-gray-900/90 hover:bg-red-600 text-white rounded-full opacity-100 sm:opacity-0 sm:group-hover:opacity-100 transition-all duration-200 shadow-lg z-50 cursor-pointer",title:"移除收藏"},[...o[5]||(o[5]=[l("svg",{class:"w-4 h-4",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24"},[l("path",{"stroke-linecap":"round","stroke-linejoin":"round","stroke-width":"2",d:"M6 18L18 6M6 6l12 12"})],-1)])],8,le)])]))),128))]),l("div",se,[u(K,{"current-page":p.value,"total-pages":C.value,onChange:x},null,8,["current-page","total-pages"])])])):(c(),v("div",Z,[o[3]||(o[3]=l("svg",{class:"w-24 h-24 text-gray-600 mx-auto mb-4",fill:"currentColor",viewBox:"0 0 20 20"},[l("path",{"fill-rule":"evenodd",d:"M3.172 5.172a4 4 0 015.656 0L10 6.343l1.172-1.171a4 4 0 115.656 5.656L10 17.657l-6.828-6.829a4 4 0 010-5.656z","clip-rule":"evenodd"})],-1)),o[4]||(o[4]=l("p",{class:"text-gray-400 mb-4"},"还没有收藏任何漫画",-1)),u(t,{to:"/latest",class:"inline-block px-6 py-2 bg-gradient-to-r from-pink-500 to-rose-500 hover:from-pink-600 hover:to-rose-600 text-white rounded-lg transition-all cursor-pointer shadow-lg hover:shadow-xl"},{default:k(()=>[...o[2]||(o[2]=[D(" 去看看最新漫画 ",-1)])]),_:1})]))]),u(O,{modelValue:i.value,"onUpdate:modelValue":o[1]||(o[1]=s=>i.value=s),title:"移除收藏",message:`确定要移除《${n.value?.name||""}》吗？`,"confirm-text":"移除","cancel-text":"取消","confirm-button-class":"bg-red-600 hover:bg-red-700 text-white",onConfirm:F,onCancel:I},null,8,["modelValue","message"])]),_:1})}}};export{ve as default};
