import{_ as K,r as n,i as W,o as X,c as A,w as Y,A as Z,U as Q,n as ee,j as te,V as ae,a as s,b as o,d as l,e as i,f as S,L as I,F as b,h,G as N,H as se,C as _,D as le,E as oe}from"./index-DU-z0rAC.js";import{_ as ne}from"./ComicCard-CeCwNywt.js";import{_ as E}from"./Pagination-DHhXo0Mv.js";const ue={class:"container mx-auto px-4 py-6"},re={key:0,class:"bg-gray-800 rounded-lg p-4"},ie={class:"flex flex-col items-center"},ce={key:1,class:"bg-gray-800 rounded-lg p-2 sm:p-4 space-y-2 sm:space-y-4"},ve={class:"flex overflow-x-auto gap-1 sm:gap-2 pb-1 sm:pb-0 -mx-2 px-2 sm:mx-0 sm:px-0 sm:flex-wrap no-scrollbar"},me=["onClick"],ge={key:0,class:"hidden sm:inline ml-1 text-xs opacity-70"},de={class:"flex overflow-x-auto gap-1 sm:gap-2 pb-1 sm:pb-0 -mx-2 px-2 sm:mx-0 sm:px-0 sm:flex-wrap no-scrollbar"},pe=["onClick"],xe={key:0},fe={class:"flex overflow-x-auto gap-1 sm:gap-2 pb-1 sm:pb-0 -mx-2 px-2 sm:mx-0 sm:px-0 sm:flex-wrap no-scrollbar"},ye=["onClick"],be={key:2,class:"mt-4 mb-4"},he={key:3,class:"bg-gray-800 rounded-lg p-3 sm:p-4 mt-2 sm:mt-4 mb-4 sm:mb-6"},_e={class:"text-xs sm:text-sm text-gray-400 mb-1.5 sm:mb-2"},ke={class:"flex flex-wrap gap-1.5 sm:gap-2"},Ce=["onClick"],we={key:4,class:"flex justify-center py-8 sm:py-12"},$e={key:5,class:"grid grid-cols-3 sm:grid-cols-4 md:grid-cols-5 lg:grid-cols-6 xl:grid-cols-6 2xl:grid-cols-7 gap-2 sm:gap-3 md:gap-4 mt-4"},Pe={key:6,class:"text-center py-8 sm:py-12"},Se={key:7,class:"flex justify-center py-6 sm:py-8"},Ve={key:8,class:"flex justify-center py-6 sm:py-8"},Ne={key:9,class:"mt-8"},qe={name:"CatalogView"},Fe=Object.assign(qe,{setup(Ie){const j=te(),B=ee(),v=n([]),D=n([]),u=n(null),m=n(null),x=n("mv"),L=[{label:"最新",value:""},{label:"最多爱心",value:"tf"},{label:"总排名",value:"mv"},{label:"月排名",value:"mv_m"},{label:"周排名",value:"mp_w"}],c=n([]),f=n(!1),q=n(!0),k=n(!1),d=n(1),y=n(!0),C=n(!1),V=n(0),w=n(0),p=n(1),g=n(1),M=()=>{const e=B.query;if(e.page){const t=parseInt(e.page);!isNaN(t)&&t>0&&(d.value=t,g.value=t)}else d.value=1,g.value=1;if(e.o){const t=e.o;L.find(r=>r.value===t)&&(x.value=t)}if(e.c&&v.value.length>0)if(e.c.includes("_")){const[t,a]=e.c.split("_"),r=v.value.find(P=>P.slug===t);if(r&&(u.value=r,r.sub_categories)){const P=r.sub_categories.find(J=>J.slug===a);P&&(m.value=P)}}else{const t=v.value.find(a=>a.slug===e.c);t&&(u.value=t)}},O=()=>{const e={};if(g.value>1&&(e.page=g.value),x.value&&x.value!=="mv"&&(e.o=x.value),u.value){let t=u.value.slug;m.value&&(t=`${t}_${m.value.slug}`),t&&(e.c=t)}j.replace({query:e})},U=async()=>{q.value=!0;try{const e=await Q();e&&(v.value=e.categories||[],D.value=e.blocks||[],M(),!u.value&&v.value.length>0&&(u.value=v.value[0]),u.value&&$())}catch(e){console.error("Failed to load categories:",e)}finally{q.value=!1}},F=async(e=!1)=>{if(!(e&&f.value||!e&&k.value||!y.value&&!e)){e?f.value=!0:k.value=!0;try{let t=u.value?.slug||"";m.value&&t&&(t=`${t}_${m.value.slug}`);const a=await ae(d.value,x.value,t);a?.content?(e?c.value=a.content:c.value.push(...a.content),a.total!==void 0&&(V.value=a.total),w.value===0&&a.content.length>0&&(w.value=a.content.length),V.value>0&&w.value>0?p.value=Math.ceil(V.value/w.value):p.value=d.value+(a.content.length>=80?1:0),g.value=d.value,d.value++,y.value=a.content.length>=80):(y.value=!1,e&&(p.value=0))}catch(t){console.error("Failed to load comics:",t),y.value=!1}finally{e?f.value=!1:k.value=!1}}},$=(e=!0)=>{c.value=[],e&&(d.value=1,g.value=1),y.value=!0,C.value=!0,V.value=0,w.value=0,p.value=1,O(),F(!0)},z=e=>{j.push({path:"/search",query:{q:e}})},G=e=>{u.value=e,m.value=null,$(!0)},H=e=>{x.value=e,$(!0)},R=e=>{m.value=e,$(!0)},T=e=>{c.value=[],d.value=e,g.value=e,y.value=!0,O(),F(!0),window.scrollTo({top:0,behavior:"smooth"})};return W(()=>B.query,(e,t)=>{if(v.value.length>0){M();const a=e.o!==t?.o||e.c!==t?.c;$(a)}},{deep:!0}),X(()=>{U()}),(e,t)=>(s(),A(Z,{title:"分类浏览"},{default:Y(()=>[o("div",ue,[q.value?(s(),l("div",re,[o("div",ie,[S(I),t[2]||(t[2]=o("span",{class:"mt-3 text-gray-400 text-sm"},"加载分类中...",-1))])])):i("",!0),v.value.length>0?(s(),l("div",ce,[o("div",null,[t[3]||(t[3]=o("label",{class:"text-xs sm:text-sm text-gray-400 mb-1 sm:mb-2 block"},"分类",-1)),o("div",ve,[(s(!0),l(b,null,h(v.value,a=>(s(),l("button",{key:a.id,onClick:r=>G(a),class:N(["flex-shrink-0 px-2 sm:px-4 py-1 sm:py-2 rounded-md sm:rounded-lg text-xs sm:text-sm font-medium transition-all whitespace-nowrap",u.value?.id===a.id?"bg-pink-500 text-white":"bg-gray-700 text-gray-300 hover:bg-gray-600"])},[se(_(a.name)+" ",1),a.total_albums>0?(s(),l("span",ge," ("+_(le(oe)(a.total_albums))+") ",1)):i("",!0)],10,me))),128))])]),o("div",null,[t[4]||(t[4]=o("label",{class:"text-xs sm:text-sm text-gray-400 mb-1 sm:mb-2 block"},"排序",-1)),o("div",de,[(s(),l(b,null,h(L,a=>o("button",{key:a.value,onClick:r=>H(a.value),class:N(["flex-shrink-0 px-2 sm:px-4 py-1 sm:py-2 rounded-md sm:rounded-lg text-xs sm:text-sm font-medium transition-all whitespace-nowrap",x.value===a.value?"bg-pink-500 text-white":"bg-gray-700 text-gray-300 hover:bg-gray-600"])},_(a.label),11,pe)),64))])]),u.value?.sub_categories?.length&&u.value.id!==0?(s(),l("div",xe,[t[5]||(t[5]=o("label",{class:"text-xs sm:text-sm text-gray-400 mb-1 sm:mb-2 block"},"子分类",-1)),o("div",fe,[o("button",{onClick:t[0]||(t[0]=a=>R(null)),class:N(["flex-shrink-0 px-2 sm:px-4 py-1 sm:py-2 rounded-md sm:rounded-lg text-xs sm:text-sm font-medium transition-all whitespace-nowrap",m.value?"bg-gray-700 text-gray-300 hover:bg-gray-600":"bg-pink-500 text-white"])}," 全部 ",2),(s(!0),l(b,null,h(u.value.sub_categories,a=>(s(),l("button",{key:a.CID,onClick:r=>R(a),class:N(["flex-shrink-0 px-2 sm:px-4 py-1 sm:py-2 rounded-md sm:rounded-lg text-xs sm:text-sm font-medium transition-all whitespace-nowrap",m.value?.CID===a.CID?"bg-pink-500 text-white":"bg-gray-700 text-gray-300 hover:bg-gray-600"])},_(a.name),11,ye))),128))])])):i("",!0)])):i("",!0),C.value&&p.value>1&&c.value.length>0?(s(),l("div",be,[S(E,{"current-page":g.value,"total-pages":p.value,onChange:T},null,8,["current-page","total-pages"])])):i("",!0),C.value?i("",!0):(s(),l("div",he,[(s(!0),l(b,null,h(D.value,a=>(s(),l("div",{key:a.title,class:"mb-3 sm:mb-4 last:mb-0"},[o("h3",_e,_(a.title),1),o("div",ke,[(s(!0),l(b,null,h(a.content,r=>(s(),l("button",{key:r,onClick:P=>z(r),class:"px-2 sm:px-3 py-1 sm:py-1.5 bg-gray-700 hover:bg-pink-500 text-gray-300 hover:text-white rounded-full text-xs sm:text-sm transition-all"},_(r),9,Ce))),128))])]))),128))])),f.value?(s(),l("div",we,[S(I)])):i("",!0),!f.value&&c.value.length>0?(s(),l("div",$e,[(s(!0),l(b,null,h(c.value,a=>(s(),A(ne,{key:a.id,comic:a},null,8,["comic"]))),128))])):i("",!0),!f.value&&C.value&&c.value.length===0?(s(),l("div",Pe,[...t[6]||(t[6]=[o("p",{class:"text-gray-400 text-sm"},"暂无相关漫画",-1)])])):i("",!0),y.value&&!f.value&&!k.value&&c.value.length?(s(),l("div",Se,[o("button",{onClick:t[1]||(t[1]=a=>F()),class:"px-6 py-3 bg-pink-600 hover:bg-pink-700 text-white rounded-lg font-medium transition-colors cursor-pointer"}," 加载更多 ")])):i("",!0),k.value?(s(),l("div",Ve,[S(I)])):i("",!0),C.value&&p.value>1&&c.value.length>0?(s(),l("div",Ne,[S(E,{"current-page":g.value,"total-pages":p.value,onChange:T},null,8,["current-page","total-pages"])])):i("",!0)])]),_:1}))}}),Le=K(Fe,[["__scopeId","data-v-e6fc7bb5"]]);export{Le as default};
