import{u as N,r as i,o as P,X as j,c as U,w as V,A as $,k as z,Y as D,K as E,a as d,b as t,f as g,d as p,t as x,v as q,L as H,F as K,h as W,S as B,Z as X,W as Y}from"./index-Brj9CnMw.js";import{u as Z}from"./useNotification-D6CCFNe2.js";import{U as G}from"./UnifiedComicCard-CMB0-cxG.js";import{_ as J}from"./Pagination-B7NFFZ80.js";const O={class:"container mx-auto px-4 py-6"},Q={class:"mb-6"},ee={class:"flex justify-between items-center"},oe={class:"text-gray-400"},te={class:"text-pink-500 font-medium"},le={key:0,class:"flex justify-center py-20"},se={key:1,class:"text-center py-12"},ae={key:2},ne={class:"grid grid-cols-2 sm:grid-cols-3 md:grid-cols-4 lg:grid-cols-5 xl:grid-cols-6 gap-4"},re={class:"relative"},ie=["onClick"],ce={class:"mt-8"},de=24,fe={__name:"CollectionView",setup(ue){const F=z(),m=N(),w=Z(),a=i([]),h=i(!1),f=i(1),y=i(1),_=i(0),c=i(!1),n=i(null),A=o=>({id:o.comic_id||o.id,name:o.name||o.title,title:o.name||o.title,created_at:o.created_at}),C=async(o=1)=>{h.value=!0;try{const e=await D(o,de);a.value=(e.data||[]).map(l=>({...l,id:l.comic_id||l.id,title:l.name||l.title})),f.value=e.current_page||1,y.value=e.last_page||1,_.value=e.total||0,o===1&&(m.collectedComics=a.value)}catch(e){console.error("Failed to load collections:",e)}finally{h.value=!1}},I=o=>{console.log("Remove button clicked for comic:",o),M(o)},M=o=>{console.log("Remove handler called for comic:",o),n.value=o,c.value=!0},S=async()=>{var l,u,s;if(!n.value)return;const o=n.value,e=o.comic_id||o.id;console.log("Toggling collection for comic:",o);try{const r=await Y({id:e,name:o.name||o.title,author:o.author||"",cover:o.cover||null});if(console.log("Toggle response:",r),r.is_collected===!1){const L=a.value.findIndex(v=>(v.comic_id||v.id)===e);L>-1&&(a.value.splice(L,1),_.value--);const R=m.collectedComics.findIndex(v=>(v.comic_id||v.id)===e);R>-1&&m.collectedComics.splice(R,1),w.success("已移除收藏"),a.value.length===0&&f.value>1&&k(f.value-1)}c.value=!1,n.value=null}catch(r){console.error("Failed to toggle collection:",r),console.error("Error details:",(l=r.response)==null?void 0:l.data),w.error(((s=(u=r.response)==null?void 0:u.data)==null?void 0:s.message)||"移除失败，请稍后重试"),c.value=!1,n.value=null}},T=()=>{c.value=!1,n.value=null},k=o=>{C(o),window.scrollTo(0,0)},b=()=>{if(!m.isLoggedIn){F.push({path:"/login",query:{redirect:"/collection"}});return}C()};return P(()=>{b()}),j(()=>{b()}),(o,e)=>{const l=E("router-link");return d(),U($,{title:"我的收藏"},{default:V(()=>{var u;return[t("div",O,[t("div",Q,[t("div",ee,[t("div",null,[e[4]||(e[4]=t("h1",{class:"text-2xl font-bold text-white mb-2"},"我的收藏",-1)),t("p",oe,[e[2]||(e[2]=x(" 共 ",-1)),t("span",te,q(_.value),1),e[3]||(e[3]=x(" 部作品 ",-1))])])])]),h.value?(d(),p("div",le,[g(H)])):a.value.length?(d(),p("div",ae,[t("div",ne,[(d(!0),p(K,null,W(a.value,s=>(d(),p("div",{key:s.comic_id||s.id,class:"relative group",onClick:e[0]||(e[0]=B(()=>{},["stop"]))},[t("div",re,[g(G,{comic:A(s),"show-collection-date":!0,"show-category":!1,"show-episode":!1,"show-stats":!1,"show-author":!1,"show-description":!1,"show-tags":!1},null,8,["comic"]),t("button",{type:"button",onClick:B(r=>I(s),["stop","prevent"]),class:"absolute top-2 right-2 p-2 bg-red-600 sm:bg-gray-900/90 hover:bg-red-600 text-white rounded-full opacity-100 sm:opacity-0 sm:group-hover:opacity-100 transition-all duration-200 shadow-lg z-50 cursor-pointer",title:"移除收藏"},[...e[8]||(e[8]=[t("svg",{class:"w-4 h-4",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24"},[t("path",{"stroke-linecap":"round","stroke-linejoin":"round","stroke-width":"2",d:"M6 18L18 6M6 6l12 12"})],-1)])],8,ie)])]))),128))]),t("div",ce,[g(J,{"current-page":f.value,"total-pages":y.value,onChange:k},null,8,["current-page","total-pages"])])])):(d(),p("div",se,[e[6]||(e[6]=t("svg",{class:"w-24 h-24 text-gray-600 mx-auto mb-4",fill:"currentColor",viewBox:"0 0 20 20"},[t("path",{"fill-rule":"evenodd",d:"M3.172 5.172a4 4 0 015.656 0L10 6.343l1.172-1.171a4 4 0 115.656 5.656L10 17.657l-6.828-6.829a4 4 0 010-5.656z","clip-rule":"evenodd"})],-1)),e[7]||(e[7]=t("p",{class:"text-gray-400 mb-4"},"还没有收藏任何漫画",-1)),g(l,{to:"/latest",class:"inline-block px-6 py-2 bg-gradient-to-r from-pink-500 to-rose-500 hover:from-pink-600 hover:to-rose-600 text-white rounded-lg transition-all cursor-pointer shadow-lg hover:shadow-xl"},{default:V(()=>[...e[5]||(e[5]=[x(" 去看看最新漫画 ",-1)])]),_:1})]))]),g(X,{modelValue:c.value,"onUpdate:modelValue":e[1]||(e[1]=s=>c.value=s),title:"移除收藏",message:"确定要移除《".concat(((u=n.value)==null?void 0:u.name)||"","》吗？"),"confirm-text":"移除","cancel-text":"取消","confirm-button-class":"bg-red-600 hover:bg-red-700 text-white",onConfirm:S,onCancel:T},null,8,["modelValue","message"])]}),_:1})}}};export{fe as default};
