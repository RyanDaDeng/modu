import{i as e,r as t,o as a,X as l,c as o,w as s,l as r,K as i,a as n,b as c,f as u,d,v,x as p,L as g,F as m,h,S as f,Z as x}from"./index-B0oRfr6y.js";import{g as y,t as b}from"./videoCollection-Dn6VBpl_.js";import{V as w,g as k}from"./VideoLayout-D2GvKkS_.js";import{u as _}from"./useNotification-CX1DGPQv.js";import{_ as j}from"./Pagination-CA5RVl85.js";const C={class:"container mx-auto px-4 py-6"},V={class:"mb-6"},M={class:"flex justify-between items-center"},$={class:"text-gray-400"},z={class:"text-pink-500 font-medium"},L={key:0,class:"flex justify-center py-20"},B={key:1,class:"text-center py-12"},A={key:2},D={class:"grid grid-cols-2 sm:grid-cols-3 md:grid-cols-4 lg:grid-cols-5 xl:grid-cols-6 gap-4"},W={class:"relative"},q={class:"relative bg-gray-900/60 backdrop-blur-sm border border-white/10 rounded-lg overflow-hidden group-hover:border-pink-500/30 transition-all"},E={class:"relative overflow-hidden bg-gray-800/50 aspect-video"},F=["src","alt"],I={class:"p-1.5 sm:p-2"},K={class:"text-xs sm:text-sm font-semibold text-white line-clamp-2 mb-1.5 h-8 sm:h-10"},N={class:"flex items-center gap-1.5 text-[10px] sm:text-xs text-gray-400"},P={class:"truncate"},S=["onClick"],T={class:"mt-8"},U={__name:"VideoCollectionView",setup(U){const X=r(),Z=e(),G=_(),H=t([]),J=t(!1),O=t(1),Q=t(1),R=t(0),Y=t(""),ee=t(!1),te=t(null),ae=e=>{e.target.src="/img_6.png"},le=e=>{if(!e)return"";const t=new Date(e),a=new Date-t,l=Math.floor(a/864e5);return 0===l?"今天":1===l?"昨天":l<7?`${l}天前`:l<30?`${Math.floor(l/7)}周前`:l<365?`${Math.floor(l/30)}月前`:`${Math.floor(l/365)}年前`},oe=async(e=1)=>{J.value=!0;try{const t=await y(e,24);H.value=t.data||[],O.value=t.current_page||1,Q.value=t.last_page||1,R.value=t.total||0}catch(t){G.error("加载收藏列表失败")}finally{J.value=!1}},se=async()=>{if(!te.value)return;const e=te.value,t=e.video_id||e.id;try{if(!1===(await b({id:t,vod_id:t,name:e.name,cover:e.cover||null})).is_collected){const e=H.value.findIndex(e=>(e.video_id||e.id)===t);e>-1&&(H.value.splice(e,1),R.value--),G.success("已移除收藏"),0===H.value.length&&O.value>1&&ie(O.value-1)}ee.value=!1,te.value=null}catch(a){G.error(a.response?.data?.message||"移除失败，请稍后重试"),ee.value=!1,te.value=null}},re=()=>{ee.value=!1,te.value=null},ie=e=>{oe(e),window.scrollTo(0,0)},ne=()=>{Z.isAuthenticated?oe():X.push({path:"/login",query:{redirect:"/video-collection"}})};return a(async()=>{await(async()=>{try{const e=await k(),t=e.data||e;t.cdn_domain&&(Y.value=t.cdn_domain)}catch(e){}})(),ne()}),l(()=>{ne()}),(e,t)=>{const a=i("router-link");return n(),o(w,{title:"我的收藏"},{default:s(()=>[c("div",C,[c("div",V,[c("div",M,[c("div",null,[t[4]||(t[4]=c("h1",{class:"text-2xl font-bold text-white mb-2"},"我的视频收藏",-1)),c("p",$,[t[2]||(t[2]=v(" 共 ",-1)),c("span",z,p(R.value),1),t[3]||(t[3]=v(" 个视频 ",-1))])])])]),J.value?(n(),d("div",L,[u(g)])):H.value.length?(n(),d("div",A,[c("div",D,[(n(!0),d(m,null,h(H.value,e=>(n(),d("div",{key:e.video_id||e.id,class:"relative group",onClick:t[0]||(t[0]=f(()=>{},["stop"]))},[c("div",W,[u(a,{to:`/video/${e.video_id}`,class:"block relative"},{default:s(()=>{return[t[9]||(t[9]=c("div",{class:"absolute inset-0 bg-gradient-to-r from-pink-500 via-purple-500 to-blue-500 rounded-lg opacity-0 group-hover:opacity-50 blur-sm transition-opacity"},null,-1)),c("div",q,[c("div",E,[c("img",{src:(a=e.cover,a&&Y.value?a.startsWith("http://")||a.startsWith("https://")?a:Y.value+a:a||"/img_6.png"),alt:e.name,class:"w-full h-full object-cover group-hover:opacity-90 transition-opacity",onError:ae,loading:"lazy"},null,40,F),t[8]||(t[8]=c("div",{class:"absolute inset-0 flex items-center justify-center opacity-0 group-hover:opacity-100 transition-opacity duration-300"},[c("div",{class:"w-12 h-12 sm:w-14 sm:h-14 bg-black/60 rounded-full flex items-center justify-center"},[c("svg",{class:"w-5 h-5 sm:w-6 sm:h-6 text-white ml-1",fill:"currentColor",viewBox:"0 0 20 20"},[c("path",{d:"M6.3 2.841A1.5 1.5 0 004 4.11V15.89a1.5 1.5 0 002.3 1.269l9.344-5.89a1.5 1.5 0 000-2.538L6.3 2.84z"})])])],-1))]),c("div",I,[c("h3",K,p(e.name),1),c("div",N,[c("span",P,p(le(e.created_at)),1)])])])];var a}),_:2},1032,["to"]),c("button",{type:"button",onClick:f(t=>(e=>{te.value=e,ee.value=!0})(e),["stop","prevent"]),class:"absolute top-2 right-2 p-2 bg-red-600 sm:bg-gray-900/90 hover:bg-red-600 text-white rounded-full opacity-100 sm:opacity-0 sm:group-hover:opacity-100 transition-all duration-200 shadow-lg z-50 cursor-pointer",title:"移除收藏"},[...t[10]||(t[10]=[c("svg",{class:"w-4 h-4",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24"},[c("path",{"stroke-linecap":"round","stroke-linejoin":"round","stroke-width":"2",d:"M6 18L18 6M6 6l12 12"})],-1)])],8,S)])]))),128))]),c("div",T,[u(j,{"current-page":O.value,"total-pages":Q.value,onChange:ie},null,8,["current-page","total-pages"])])])):(n(),d("div",B,[t[6]||(t[6]=c("svg",{class:"w-24 h-24 text-gray-600 mx-auto mb-4",fill:"currentColor",viewBox:"0 0 20 20"},[c("path",{d:"M5 5a2 2 0 012-2h10a2 2 0 012 2v16l-7-3.5L5 21V5z"})],-1)),t[7]||(t[7]=c("p",{class:"text-gray-400 mb-4"},"还没有收藏任何视频",-1)),u(a,{to:"/video",class:"inline-block px-6 py-2 bg-gradient-to-r from-pink-500 to-rose-500 hover:from-pink-600 hover:to-rose-600 text-white rounded-lg transition-all cursor-pointer shadow-lg hover:shadow-xl"},{default:s(()=>[...t[5]||(t[5]=[v(" 去看看在线视频 ",-1)])]),_:1})]))]),u(x,{modelValue:ee.value,"onUpdate:modelValue":t[1]||(t[1]=e=>ee.value=e),title:"移除收藏",message:`确定要移除《${te.value?.name||""}》吗？`,"confirm-text":"移除","cancel-text":"取消","confirm-button-class":"bg-red-600 hover:bg-red-700 text-white",onConfirm:se,onCancel:re},null,8,["modelValue","message"])]),_:1})}}};export{U as default};
