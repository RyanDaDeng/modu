import{B as e,r as l,j as a,k as t,o as s,X as r,a0 as u,m as o,c as i,w as n,A as v,s as d,p as c,l as g,a1 as p,a as b,b as m,d as x,e as y,f as k,L as h,x as f,F as C,h as w,N as _,v as I,t as S,O as j}from"./index-DgjzBZ7I.js";import{_ as P}from"./ComicCard-CxcaXopX.js";import{_ as D}from"./Pagination-BDRDb-3t.js";import{_ as N}from"./BottomDrawer-vP_SoIeE.js";const V={class:"container mx-auto px-4 py-6"},B={key:0,class:"relative"},O={class:"relative bg-gray-900/80 backdrop-blur-xl border border-white/10 rounded-lg p-4"},q={class:"flex flex-col items-center"},M={key:1,class:"sm:hidden mb-4"},J={class:"bg-gradient-to-r from-pink-500/10 to-purple-500/10 rounded-xl p-[1px]"},$={class:"bg-gray-900/90 backdrop-blur-xl rounded-xl p-3"},T={class:"relative flex items-center justify-between bg-gray-800/90 backdrop-blur rounded-xl px-4 py-3 border border-gray-700 group-hover:border-pink-500/50 group-active:scale-[0.98] transition-all"},A={class:"flex items-center gap-3"},F={class:"text-left"},L={class:"text-sm font-medium text-white"},U={class:"flex gap-2 overflow-x-auto pb-1"},X=["onClick"],z={key:2,class:"hidden sm:block relative"},E={class:"relative bg-gray-900/60 backdrop-blur-xl border border-white/10 rounded-lg p-4 space-y-4"},G={class:"flex flex-wrap gap-2"},H=["onClick"],K={key:0,class:"ml-1 text-xs opacity-70"},Q={class:"flex flex-wrap gap-2"},R=["onClick"],W={key:0},Y={class:"flex flex-wrap gap-2"},Z=["onClick"],ee={key:3,class:"mt-4 mb-4"},le={key:4,class:"relative mt-2 sm:mt-4 mb-4 sm:mb-6"},ae={class:"relative bg-gray-900/60 backdrop-blur-xl border border-white/10 rounded-lg p-3 sm:p-4"},te={class:"text-xs sm:text-sm text-gray-400 mb-1.5 sm:mb-2"},se={class:"flex flex-wrap gap-1.5 sm:gap-2"},re=["onClick"],ue={key:5,class:"flex justify-center py-8 sm:py-12"},oe={key:6,class:"grid grid-cols-2 sm:grid-cols-4 md:grid-cols-5 lg:grid-cols-6 xl:grid-cols-6 2xl:grid-cols-7 gap-3 sm:gap-3 md:gap-4 mt-4"},ie={key:7,class:"text-center py-8 sm:py-12"},ne={key:8,class:"flex justify-center py-6 sm:py-8"},ve={key:9,class:"flex justify-center py-6 sm:py-8"},de={key:10,class:"mt-8"},ce={class:"px-4 pb-4"},ge={class:"grid grid-cols-2 gap-2"},pe=["onClick"],be={key:0,class:"block text-xs opacity-70 mt-1"},me={class:"px-4 pb-4"},xe={class:"grid grid-cols-2 gap-2"},ye=["onClick"],ke={key:0,class:"px-4 pb-6"},he={class:"grid grid-cols-2 gap-2"},fe=["onClick"],Ce={name:"CatalogView"},we=e(Object.assign(Ce,{setup(e){const Ce=g(),we=d(),_e="catalogPageState",Ie=l([]),Se=l([]),je=l(null),Pe=l(null),De=l("mv"),Ne=l(!1),Ve=[{label:"最新",value:""},{label:"最多爱心",value:"tf"},{label:"总排名",value:"mv"},{label:"月排名",value:"mv_m"},{label:"周排名",value:"mp_w"}],Be=a(()=>[{label:"最新",value:""},{label:"总榜",value:"mv"},{label:"月榜",value:"mv_m"},{label:"周榜",value:"mp_w"}]),Oe=l([]),qe=l(!1),Me=l(!0),Je=l(!0),$e=l(!1),Te=l(0),Ae=l(!0),Fe=l(!1),Le=l(0),Ue=l(0),Xe=l(1),ze=l(1),Ee=()=>{const e=we.query;if(e.page){const l=parseInt(e.page);!isNaN(l)&&l>0&&(Te.value=l,ze.value=l)}else 0===Te.value&&(Te.value=1,ze.value=1);if(e.o){const l=e.o;Ve.find(e=>e.value===l)&&(De.value=l)}if(e.c&&Ie.value.length>0)if(e.c.includes("_")){const[l,a]=e.c.split("_"),t=Ie.value.find(e=>e.slug===l);if(t&&(je.value=t,t.sub_categories)){const e=t.sub_categories.find(e=>e.slug===a);e&&(Pe.value=e)}}else{const l=Ie.value.find(l=>!(!l.slug||l.slug!==e.c)||(!(!l.id||String(l.id)!==e.c)||!isNaN(e.c)&&l.id===parseInt(e.c)));l&&(je.value=l,Pe.value=null)}},Ge=(e=!1)=>{const l={};if(l.page=ze.value,De.value&&"mv"!==De.value&&(l.o=De.value),je.value){let e=je.value.slug||je.value.id;if(Pe.value){e=`${e}_${Pe.value.slug||Pe.value.CID}`}e&&(l.c=e)}el.value=!0,e?Ce.push({query:l}):Ce.replace({query:l})},He=()=>{const e={categories:Ie.value,themeBlocks:Se.value,selectedCategory:je.value,selectedSubCategory:Pe.value,selectedSort:De.value,comics:Oe.value,currentPage:Te.value,displayPage:ze.value,hasMore:Ae.value,totalItems:Le.value,totalPages:Xe.value,itemsPerPage:Ue.value,hasSearched:Fe.value,timestamp:Date.now()};sessionStorage.setItem(_e,JSON.stringify(e))},Ke=async(e=!1)=>{if(!(e&&qe.value||!e&&$e.value||!Ae.value&&!e)){e?qe.value=!0:($e.value=!0,Te.value++);try{let l=je.value?.slug||"";Pe.value&&l&&(l=`${l}_${Pe.value.slug}`);const a=await p(Te.value,De.value,l);a?.content?(e?Oe.value=a.content:Oe.value.push(...a.content),void 0!==a.total&&(Le.value=a.total),0===Ue.value&&a.content.length>0&&(Ue.value=a.content.length),Le.value>0&&Ue.value>0?Xe.value=Math.ceil(Le.value/Ue.value):Xe.value=Te.value+(a.content.length>=80?1:0),ze.value=Te.value,Ae.value=a.content.length>=80):(Ae.value=!1,e&&(Xe.value=0))}catch(l){Ae.value=!1}finally{e?qe.value=!1:$e.value=!1}}},Qe=(e=!0)=>{Oe.value=[],e&&(Te.value=1,ze.value=1),Ae.value=!0,Fe.value=!0,Le.value=0,Ue.value=0,Xe.value=1,Ge(),Ke(!0)},Re=e=>{De.value=e,Qe(!0)},We=e=>{Pe.value=e,Qe(!0)},Ye=e=>{Pe.value=e,Ne.value=!1,Qe(!0)},Ze=e=>{Oe.value=[],Te.value=e,ze.value=e,Ae.value=!0,Ge(),Ke(!0),window.scrollTo({top:0,behavior:"smooth"})},el=l(!1),ll=l(!1);t(()=>we.query,(e,l)=>{ll.value&&"catalog"===we.name&&(el.value?el.value=!1:(al.value||JSON.stringify(e)!==JSON.stringify(l))&&Ie.value.length>0&&(Ee(),!je.value&&Ie.value.length>0&&(je.value=Ie.value[0]),je.value&&(Oe.value=[],Ae.value=!0,Fe.value=!0,Le.value=0,Ue.value=0,Xe.value=1,Ke(!0))))},{deep:!0});const al=l(!0);return s(()=>{(()=>{try{const e=sessionStorage.getItem(_e);if(!e)return!1;const l=JSON.parse(e);return Date.now()-l.timestamp>3e5?(sessionStorage.removeItem(_e),!1):(Ie.value=l.categories||[],Se.value=l.themeBlocks||[],je.value=l.selectedCategory,Pe.value=l.selectedSubCategory,De.value=l.selectedSort||"mv",Oe.value=l.comics||[],Te.value=l.currentPage||1,ze.value=l.displayPage||1,Ae.value=l.hasMore??!0,Le.value=l.totalItems||0,Xe.value=l.totalPages||1,Ue.value=l.itemsPerPage||0,Fe.value=l.hasSearched??!1,qe.value=!1,$e.value=!1,Je.value=!1,Me.value=!1,!0)}catch(e){return sessionStorage.removeItem(_e),!1}})()?Me.value=!1:(Ee(),0===Te.value&&(Te.value=1,ze.value=1),(async()=>{Je.value=!0;try{const e=await c();e&&(Ie.value=e.categories||[],Se.value=e.blocks||[],Ee(),!je.value&&Ie.value.length>0&&(je.value=Ie.value[0]),je.value&&Qe(!1))}catch(e){}finally{Je.value=!1,Me.value=!1}})()),setTimeout(()=>{ll.value=!0},100)}),r(()=>{al.value||(Me.value=!1,Je.value=!1),al.value=!1}),u(()=>{He()}),o(()=>{He()}),(e,l)=>(b(),i(v,{title:"分类浏览","page-loading":Me.value},{default:n(()=>[m("div",V,[Je.value?(b(),x("div",B,[l[6]||(l[6]=m("div",{class:"absolute inset-0 bg-gradient-to-r from-pink-500/20 via-purple-500/20 to-blue-500/20 rounded-lg blur-xl"},null,-1)),m("div",O,[m("div",q,[k(h),l[5]||(l[5]=m("span",{class:"mt-3 text-gray-400 text-sm"},"加载分类中...",-1))])])])):y("",!0),Ie.value.length>0?(b(),x("div",M,[m("div",J,[m("div",$,[m("button",{onClick:l[0]||(l[0]=e=>Ne.value=!0),class:"w-full mb-3 relative group"},[l[10]||(l[10]=m("div",{class:"absolute inset-0 bg-gradient-to-r from-pink-500/20 to-purple-500/20 rounded-xl blur group-active:blur-xl transition-all"},null,-1)),m("div",T,[m("div",A,[l[8]||(l[8]=m("div",{class:"relative"},[m("svg",{class:"w-5 h-5 text-pink-400",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24"},[m("path",{"stroke-linecap":"round","stroke-linejoin":"round","stroke-width":"2",d:"M12 6V4m0 2a2 2 0 100 4m0-4a2 2 0 110 4m-6 8a2 2 0 100-4m0 4a2 2 0 110-4m0 4v2m0-6V4m6 6v10m6-2a2 2 0 100-4m0 4a2 2 0 110-4m0 4v2m0-6V4"})]),m("div",{class:"absolute inset-0 bg-pink-400 blur-lg opacity-50 animate-pulse"})],-1)),m("div",F,[l[7]||(l[7]=m("div",{class:"text-xs text-gray-400 mb-0.5"},"当前筛选",-1)),m("div",L,f(je.value?.name||"全部")+" · "+f(Ve.find(e=>e.value===De.value)?.label||"最新"),1)])]),l[9]||(l[9]=m("div",{class:"flex items-center gap-2"},[m("span",{class:"text-xs text-pink-400 font-medium"},"点击修改"),m("div",{class:"bg-pink-500/20 rounded-lg p-1.5 group-hover:bg-pink-500/30 transition-colors"},[m("svg",{class:"w-4 h-4 text-pink-400",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24"},[m("path",{"stroke-linecap":"round","stroke-linejoin":"round","stroke-width":"2",d:"M19 9l-7 7-7-7"})])])],-1))])]),m("div",U,[(b(!0),x(C,null,w(Be.value,e=>(b(),x("button",{key:e.value,onClick:l=>Re(e.value),class:_(["flex-shrink-0 px-3 py-1.5 rounded-full text-xs font-medium transition-all",De.value===e.value?"bg-pink-500/20 text-pink-400 border border-pink-500/50":"bg-gray-800 text-gray-400 border border-gray-700"])},f(e.label),11,X))),128))])])])])):y("",!0),Ie.value.length>0?(b(),x("div",z,[l[14]||(l[14]=m("div",{class:"absolute inset-0 bg-gradient-to-r from-pink-500/10 via-purple-500/10 to-blue-500/10 rounded-lg blur-xl"},null,-1)),m("div",E,[m("div",null,[l[11]||(l[11]=m("label",{class:"text-sm text-gray-400 mb-2 block"},"分类",-1)),m("div",G,[(b(!0),x(C,null,w(Ie.value,e=>(b(),x("button",{key:e.id,onClick:l=>(e=>{je.value=e,Pe.value=null,Qe(!0)})(e),class:_(["px-4 py-2 rounded-lg text-sm font-medium transition-colors cursor-pointer",je.value?.id===e.id?"bg-pink-500/20 text-pink-400 border border-pink-500/50":"bg-gray-800/50 text-gray-300 hover:bg-gray-700/50 hover:text-white border border-gray-700"])},[I(f(e.name)+" ",1),e.total_albums>0?(b(),x("span",K," ("+f(S(j)(e.total_albums))+") ",1)):y("",!0)],10,H))),128))])]),m("div",null,[l[12]||(l[12]=m("label",{class:"text-sm text-gray-400 mb-2 block"},"排序",-1)),m("div",Q,[(b(),x(C,null,w(Ve,e=>m("button",{key:e.value,onClick:l=>Re(e.value),class:_(["px-4 py-2 rounded-lg text-sm font-medium transition-colors cursor-pointer",De.value===e.value?"bg-pink-500/20 text-pink-400 border border-pink-500/50":"bg-gray-800/50 text-gray-300 hover:bg-gray-700/50 hover:text-white border border-gray-700"])},f(e.label),11,R)),64))])]),je.value?.sub_categories?.length&&0!==je.value.id?(b(),x("div",W,[l[13]||(l[13]=m("label",{class:"text-sm text-gray-400 mb-2 block"},"子分类",-1)),m("div",Y,[m("button",{onClick:l[1]||(l[1]=e=>We(null)),class:_(["px-4 py-2 rounded-lg text-sm font-medium transition-colors cursor-pointer",Pe.value?"bg-gray-800/50 text-gray-300 hover:bg-gray-700/50 hover:text-white border border-gray-700":"bg-pink-500/20 text-pink-400 border border-pink-500/50"])}," 全部 ",2),(b(!0),x(C,null,w(je.value.sub_categories,e=>(b(),x("button",{key:e.CID,onClick:l=>We(e),class:_(["px-4 py-2 rounded-lg text-sm font-medium transition-colors cursor-pointer",Pe.value?.CID===e.CID?"bg-pink-500/20 text-pink-400 border border-pink-500/50":"bg-gray-800/50 text-gray-300 hover:bg-gray-700/50 hover:text-white border border-gray-700"])},f(e.name),11,Z))),128))])])):y("",!0)])])):y("",!0),Fe.value&&Xe.value>1&&Oe.value.length>0?(b(),x("div",ee,[k(D,{"current-page":ze.value,"total-pages":Xe.value,onChange:Ze},null,8,["current-page","total-pages"])])):y("",!0),Fe.value?y("",!0):(b(),x("div",le,[l[15]||(l[15]=m("div",{class:"absolute inset-0 bg-gradient-to-r from-pink-500/10 via-purple-500/10 to-blue-500/10 rounded-lg blur-xl"},null,-1)),m("div",ae,[(b(!0),x(C,null,w(Se.value,e=>(b(),x("div",{key:e.title,class:"mb-3 sm:mb-4 last:mb-0"},[m("h3",te,f(e.title),1),m("div",se,[(b(!0),x(C,null,w(e.content,e=>(b(),x("button",{key:e,onClick:l=>(e=>{Ce.push({path:"/search",query:{wd:e}})})(e),class:"px-2 sm:px-3 py-1 sm:py-1.5 bg-gray-800/50 hover:bg-pink-500/20 text-gray-300 hover:text-pink-400 border border-gray-700 hover:border-pink-500/50 rounded-full text-xs sm:text-sm transition-colors cursor-pointer"},f(e),9,re))),128))])]))),128))])])),qe.value?(b(),x("div",ue,[k(h)])):y("",!0),!qe.value&&Oe.value.length>0?(b(),x("div",oe,[(b(!0),x(C,null,w(Oe.value,e=>(b(),i(P,{key:e.id,comic:e},null,8,["comic"]))),128))])):y("",!0),!qe.value&&Fe.value&&0===Oe.value.length?(b(),x("div",ie,[...l[16]||(l[16]=[m("p",{class:"text-gray-400 text-sm"},"暂无相关漫画",-1)])])):y("",!0),Ae.value&&!qe.value&&!$e.value&&Oe.value.length?(b(),x("div",ne,[m("button",{onClick:l[2]||(l[2]=e=>Ke()),class:"px-6 py-3 bg-pink-600 hover:bg-pink-700 text-white rounded-lg font-medium transition-colors cursor-pointer"}," 加载更多 ")])):y("",!0),$e.value?(b(),x("div",ve,[k(h)])):y("",!0),Fe.value&&Xe.value>1&&Oe.value.length>0?(b(),x("div",de,[k(D,{"current-page":ze.value,"total-pages":Xe.value,onChange:Ze},null,8,["current-page","total-pages"])])):y("",!0),k(N,{modelValue:Ne.value,"onUpdate:modelValue":l[4]||(l[4]=e=>Ne.value=e),title:"选择筛选条件","max-height":"90vh"},{default:n(()=>[m("div",ce,[l[17]||(l[17]=m("div",{class:"text-sm text-gray-400 mb-3"},"分类",-1)),m("div",ge,[(b(!0),x(C,null,w(Ie.value,e=>(b(),x("button",{key:e.id,onClick:l=>(e=>{je.value=e,Pe.value=null,Ne.value=!1,Qe(!0)})(e),class:_(["py-3 rounded-lg text-sm font-medium transition-colors",je.value?.id===e.id?"bg-pink-500/20 text-pink-400 border border-pink-500/50":"bg-gray-800 text-gray-300 border border-gray-700"])},[I(f(e.name)+" ",1),e.total_albums>0?(b(),x("span",be," ("+f(S(j)(e.total_albums))+") ",1)):y("",!0)],10,pe))),128))])]),m("div",me,[l[18]||(l[18]=m("div",{class:"text-sm text-gray-400 mb-3"},"排序方式",-1)),m("div",xe,[(b(),x(C,null,w(Ve,e=>m("button",{key:e.value,onClick:l=>(e=>{De.value=e,Ne.value=!1,Qe(!0)})(e.value),class:_(["py-3 rounded-lg text-sm font-medium transition-colors",De.value===e.value?"bg-pink-500/20 text-pink-400 border border-pink-500/50":"bg-gray-800 text-gray-300 border border-gray-700"])},f(e.label),11,ye)),64))])]),je.value?.sub_categories?.length&&0!==je.value.id?(b(),x("div",ke,[l[19]||(l[19]=m("div",{class:"text-sm text-gray-400 mb-3"},"子分类",-1)),m("div",he,[m("button",{onClick:l[3]||(l[3]=e=>Ye(null)),class:_(["py-3 rounded-lg text-sm font-medium transition-colors",Pe.value?"bg-gray-800 text-gray-300 border border-gray-700":"bg-pink-500/20 text-pink-400 border border-pink-500/50"])}," 全部 ",2),(b(!0),x(C,null,w(je.value.sub_categories,e=>(b(),x("button",{key:e.CID,onClick:l=>Ye(e),class:_(["py-3 rounded-lg text-sm font-medium transition-colors",Pe.value?.CID===e.CID?"bg-pink-500/20 text-pink-400 border border-pink-500/50":"bg-gray-800 text-gray-300 border border-gray-700"])},f(e.name),11,fe))),128))])])):y("",!0)]),_:1},8,["modelValue"])])]),_:1},8,["page-loading"]))}}),[["__scopeId","data-v-aa1a0c32"]]);export{we as default};
