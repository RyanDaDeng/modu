!function(){function e(t){return e="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e},e(t)}function t(e){return function(e){if(Array.isArray(e))return r(e)}(e)||function(e){if("undefined"!=typeof Symbol&&null!=e[Symbol.iterator]||null!=e["@@iterator"])return Array.from(e)}(e)||function(e,t){if(e){if("string"==typeof e)return r(e,t);var n={}.toString.call(e).slice(8,-1);return"Object"===n&&e.constructor&&(n=e.constructor.name),"Map"===n||"Set"===n?Array.from(e):"Arguments"===n||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(n)?r(e,t):void 0}}(e)||function(){throw new TypeError("Invalid attempt to spread non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}()}function r(e,t){(null==t||t>e.length)&&(t=e.length);for(var r=0,n=Array(t);r<t;r++)n[r]=e[r];return n}function n(e,t){var r=Object.keys(e);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(e);t&&(n=n.filter(function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable})),r.push.apply(r,n)}return r}function o(e){for(var t=1;t<arguments.length;t++){var r=null!=arguments[t]?arguments[t]:{};t%2?n(Object(r),!0).forEach(function(t){a(e,t,r[t])}):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(r)):n(Object(r)).forEach(function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(r,t))})}return e}function a(t,r,n){return(r=function(t){var r=function(t,r){if("object"!=e(t)||!t)return t;var n=t[Symbol.toPrimitive];if(void 0!==n){var o=n.call(t,r||"default");if("object"!=e(o))return o;throw new TypeError("@@toPrimitive must return a primitive value.")}return("string"===r?String:Number)(t)}(t,"string");return"symbol"==e(r)?r:r+""}(r))in t?Object.defineProperty(t,r,{value:n,enumerable:!0,configurable:!0,writable:!0}):t[r]=n,t}function l(){/*! regenerator-runtime -- Copyright (c) 2014-present, Facebook, Inc. -- license (MIT): https://github.com/babel/babel/blob/main/packages/babel-helpers/LICENSE */var e,t,r="function"==typeof Symbol?Symbol:{},n=r.iterator||"@@iterator",o=r.toStringTag||"@@toStringTag";function a(r,n,o,a){var l=n&&n.prototype instanceof c?n:c,s=Object.create(l.prototype);return u(s,"_invoke",function(r,n,o){var a,l,u,c=0,s=o||[],v=!1,f={p:0,n:0,v:e,a:p,f:p.bind(e,4),d:function(t,r){return a=t,l=0,u=e,f.n=r,i}};function p(r,n){for(l=r,u=n,t=0;!v&&c&&!o&&t<s.length;t++){var o,a=s[t],p=f.p,d=a[2];r>3?(o=d===n)&&(u=a[(l=a[4])?5:(l=3,3)],a[4]=a[5]=e):a[0]<=p&&((o=r<2&&p<a[1])?(l=0,f.v=n,f.n=a[1]):p<d&&(o=r<3||a[0]>n||n>d)&&(a[4]=r,a[5]=n,f.n=d,l=0))}if(o||r>1)return i;throw v=!0,n}return function(o,s,d){if(c>1)throw TypeError("Generator is already running");for(v&&1===s&&p(s,d),l=s,u=d;(t=l<2?e:u)||!v;){a||(l?l<3?(l>1&&(f.n=-1),p(l,u)):f.n=u:f.v=u);try{if(c=2,a){if(l||(o="next"),t=a[o]){if(!(t=t.call(a,u)))throw TypeError("iterator result is not an object");if(!t.done)return t;u=t.value,l<2&&(l=0)}else 1===l&&(t=a.return)&&t.call(a),l<2&&(u=TypeError("The iterator does not provide a '"+o+"' method"),l=1);a=e}else if((t=(v=f.n<0)?u:r.call(n,f))!==i)break}catch(t){a=e,l=1,u=t}finally{c=1}}return{value:t,done:v}}}(r,o,a),!0),s}var i={};function c(){}function s(){}function v(){}t=Object.getPrototypeOf;var f=[][n]?t(t([][n]())):(u(t={},n,function(){return this}),t),p=v.prototype=c.prototype=Object.create(f);function d(e){return Object.setPrototypeOf?Object.setPrototypeOf(e,v):(e.__proto__=v,u(e,o,"GeneratorFunction")),e.prototype=Object.create(p),e}return s.prototype=v,u(p,"constructor",v),u(v,"constructor",s),s.displayName="GeneratorFunction",u(v,o,"GeneratorFunction"),u(p),u(p,o,"Generator"),u(p,n,function(){return this}),u(p,"toString",function(){return"[object Generator]"}),(l=function(){return{w:a,m:d}})()}function u(e,t,r,n){var o=Object.defineProperty;try{o({},"",{})}catch(e){o=0}u=function(e,t,r,n){function a(t,r){u(e,t,function(e){return this._invoke(t,r,e)})}t?o?o(e,t,{value:r,enumerable:!n,configurable:!n,writable:!n}):e[t]=r:(a("next",0),a("throw",1),a("return",2))},u(e,t,r,n)}function i(e,t,r,n,o,a,l){try{var u=e[a](l),i=u.value}catch(e){return void r(e)}u.done?t(i):Promise.resolve(i).then(n,o)}function c(e){return function(){var t=this,r=arguments;return new Promise(function(n,o){var a=e.apply(t,r);function l(e){i(a,n,o,l,u,"next",e)}function u(e){i(a,n,o,l,u,"throw",e)}l(void 0)})}}System.register(["./index-legacy-AqQVAtWt.js","./ComicCard-legacy-4HoHt6Uq.js"],function(e,r){"use strict";var n,a,u,i,s,v,f,p,d,g,y,m,b,h,x,w,k,S,O,j,I,P,C,A,T,E,L,M;return{setters:[function(e){n=e.u,a=e.i,u=e.r,i=e.j,s=e.o,v=e.k,f=e.l,p=e.m,d=e.c,g=e.w,y=e.A,m=e.n,b=e.p,h=e.q,x=e.a,w=e.e,k=e.b,S=e.f,O=e.s,j=e._,I=e.d,P=e.F,C=e.h,A=e.t,T=e.v,E=e.L,L=e.x},function(e){M=e._}],execute:function(){var r={class:"container mx-auto px-4 py-6"},_={key:0,class:"text-center py-12"},V={class:"max-w-md mx-auto"},z={class:"space-y-3"},D={key:1},F={key:0,class:"space-y-6 max-w-5xl mx-auto"},G={class:"grid gap-6 md:grid-cols-2"},N={class:"text-lg font-bold text-white mb-4 flex items-center"},q={class:"flex flex-wrap gap-2"},U=["onClick"],B={class:"relative"},H={key:1,class:"flex justify-center py-12"},J={key:2,class:"text-center py-12"},Q={key:2},Y={key:0,class:"flex justify-center py-12"},$={key:1,class:"text-center py-12"},K={key:2,class:"grid grid-cols-3 sm:grid-cols-4 md:grid-cols-5 lg:grid-cols-6 xl:grid-cols-7 gap-3"},R={key:3,class:"flex justify-center py-8"},W={key:4,class:"text-center py-8 text-gray-400"},X={name:"SearchView"};e("default",Object.assign(X,{setup:function(e){var X=h(),Z=v(),ee=n(),te=a(),re=u(""),ne=u([]),oe=u(!1),ae=u(1),le=u(!0),ue=u(null),ie=u(!1),ce=u([]),se=u(!1),ve=null,fe=function(){ie.value=!0},pe=function(e){re.value=e,ne.value=[],ae.value=1,le.value=!0,sessionStorage.removeItem(ye),sessionStorage.removeItem(me),he(!0)},de=function(){re.value="",ne.value=[],le.value=!0,ae.value=1,sessionStorage.removeItem(ye),sessionStorage.removeItem(me),Z.push("/search"),ge()},ge=function(){var e=c(l().m(function e(){var t,r;return l().w(function(e){for(;;)switch(e.p=e.n){case 0:if(te.isLoggedIn&&!(ce.value.length>0)){e.n=1;break}return e.a(2);case 1:return se.value=!0,e.p=2,e.n=3,m();case 3:(t=e.v)&&t.blocks&&(ce.value=t.blocks),e.n=5;break;case 4:e.p=4,r=e.v,console.error("Failed to load categories:",r);case 5:return e.p=5,se.value=!1,e.f(5);case 6:return e.a(2)}},e,null,[[2,4,5,6]])}));return function(){return e.apply(this,arguments)}}(),ye="searchPageState",me="searchPageScroll",be=function(){var e={searchQuery:re.value,comics:ne.value,currentPage:ae.value,hasMore:le.value,timestamp:Date.now()};sessionStorage.setItem(ye,JSON.stringify(e))},he=function(){var e=c(l().m(function e(){var r,n,a,u,i,c,s=arguments;return l().w(function(e){for(;;)switch(e.p=e.n){case 0:if(r=s.length>0&&void 0!==s[0]&&s[0],te.isLoggedIn){e.n=1;break}return console.log("User not logged in, skipping search"),e.a(2);case 1:if(re.value&&(!oe.value||r)){e.n=2;break}return e.a(2);case 2:if(r&&(ne.value=[],ae.value=1,le.value=!0,ee.addSearchHistory(re.value),sessionStorage.removeItem(ye),sessionStorage.removeItem(me)),le.value){e.n=3;break}return e.a(2);case 3:return oe.value=!0,e.p=4,e.n=5,b(re.value,ae.value);case 5:n=e.v,console.log("Search API response:",n),a=Array.isArray(n)?n:(null==n?void 0:n.content)||[],console.log("Parsed search results:",a),console.log("Number of results:",a.length),a&&0!==a.length?(i=a.map(function(e){return o(o({},e),{},{page:ae.value})}),(u=ne.value).push.apply(u,t(i)),console.log("Comics array after update:",ne.value),console.log("Total comics loaded:",ne.value.length),ae.value++,a.length<80&&(le.value=!1)):le.value=!1,be(),e.n=7;break;case 6:e.p=6,c=e.v,console.error("Search failed:",c),le.value=!1;case 7:return e.p=7,oe.value=!1,e.f(7);case 8:return e.a(2)}},e,null,[[4,6,7,8]])}));return function(){return e.apply(this,arguments)}}(),xe=function(){sessionStorage.setItem(me,window.scrollY.toString())};return i(function(){return X.query.wd},function(e){(console.log("Search query changed:",e,"Current:",re.value),void 0!==e&&e!==re.value)&&(re.value=e||"",re.value&&te.isLoggedIn?function(){var e=sessionStorage.getItem(ye);if(e)try{var t=JSON.parse(e);if(t.searchQuery===re.value&&Date.now()-t.timestamp<18e5)return ne.value=t.comics||[],ae.value=t.currentPage||1,le.value=void 0===t.hasMore||t.hasMore,setTimeout(function(){var e=sessionStorage.getItem(me);e&&window.scrollTo(0,parseInt(e))},100),!0}catch(r){console.error("Failed to restore search state:",r)}return!1}()||he(!0):!re.value&&te.isLoggedIn&&ge())},{immediate:!0}),s(function(){ve&&ve.disconnect(),ve=new IntersectionObserver(function(e){e[0].isIntersecting&&!oe.value&&le.value&&re.value&&te.isLoggedIn&&he()},{rootMargin:"100px"}),ue.value&&ve.observe(ue.value),re.value||ge(),window.addEventListener("beforeunload",xe),Z.beforeEach(function(e,t,r){"search"===t.name&&ne.value.length>0&&(xe(),be()),r()})}),f(function(){ne.value.length>0&&(xe(),be())}),p(function(){ve&&ve.disconnect(),window.removeEventListener("beforeunload",xe)}),function(e,n){return x(),d(y,{title:re.value?"搜索结果: ".concat(re.value):"搜索"},{default:g(function(){return[O(te).isLoggedIn?(x(),d(j,{key:0,modelValue:re.value,"onUpdate:modelValue":n[0]||(n[0]=function(e){return re.value=e}),"show-bar":!0,"show-current-query":!0,onClick:fe,onClear:de},null,8,["modelValue"])):w("",!0),k("div",r,[O(te).isLoggedIn?re.value?(x(),I("div",Q,[oe.value&&!ne.value.length?(x(),I("div",Y,[S(E)])):ne.value.length||oe.value?(x(),I("div",K,[(x(!0),I(P,null,C(ne.value,function(e){return x(),d(M,{key:"".concat(e.id,"-").concat(e.page),comic:e},null,8,["comic"])}),128))])):(x(),I("div",$,t(n[11]||(n[11]=[k("svg",{class:"w-24 h-24 text-gray-600 mx-auto mb-4",fill:"currentColor",viewBox:"0 0 20 20"},[k("path",{"fill-rule":"evenodd",d:"M18 10a8 8 0 11-16 0 8 8 0 0116 0zm-7 4a1 1 0 11-2 0 1 1 0 012 0zm-1-9a1 1 0 00-1 1v4a1 1 0 102 0V6a1 1 0 00-1-1z","clip-rule":"evenodd"})],-1),k("p",{class:"text-gray-400"},"没有找到相关结果",-1)])))),oe.value&&ne.value.length?(x(),I("div",R,[S(E)])):w("",!0),!le.value&&ne.value.length?(x(),I("div",W," 没有更多结果了 ")):w("",!0),k("div",{ref_key:"loadMoreTrigger",ref:ue,class:"h-20"},null,512)])):(x(),I("div",D,[ce.value.length>0?(x(),I("div",F,[n[9]||(n[9]=k("div",{class:"text-center mb-8"},[k("h2",{class:"text-2xl sm:text-3xl font-bold text-white mb-3 bg-gradient-to-r from-pink-500 to-purple-600 bg-clip-text text-transparent"},"热门标签"),k("p",{class:"text-gray-400"},"点击标签快速搜索相关漫画")],-1)),k("div",G,[(x(!0),I(P,null,C(ce.value,function(e){return x(),I("div",{key:e.title,class:"group bg-gradient-to-br from-gray-800/40 to-gray-900/40 backdrop-blur-sm rounded-2xl p-5 border border-white/10 hover:border-pink-500/30 transition-all duration-300"},[k("h3",N,[n[7]||(n[7]=k("span",{class:"w-1.5 h-6 bg-gradient-to-b from-pink-500 to-purple-600 rounded-full mr-3 group-hover:h-7 transition-all"},null,-1)),A(" "+T(e.title),1)]),k("div",q,[(x(!0),I(P,null,C(e.content,function(e){return x(),I("button",{key:e,onClick:function(t){return function(e){console.log("Searching by tag:",e),re.value=e,ne.value=[],ae.value=1,le.value=!0,sessionStorage.removeItem(ye),sessionStorage.removeItem(me),ee.addSearchHistory(e),he(!0)}(e)},class:"group/tag px-3 py-1.5 bg-gray-800/50 hover:bg-gradient-to-r hover:from-pink-500/30 hover:to-purple-600/30 border border-white/10 hover:border-pink-500/40 text-gray-300 hover:text-white rounded-lg text-sm transition-all duration-200 cursor-pointer hover:shadow-lg hover:shadow-pink-500/20 hover:scale-105 active:scale-95"},[k("span",B,[A(T(e)+" ",1),n[8]||(n[8]=k("span",{class:"absolute inset-0 rounded-lg bg-gradient-to-r from-pink-500 to-purple-600 opacity-0 group-hover/tag:opacity-20 blur transition-opacity"},null,-1))])],8,U)}),128))])])}),128))])])):se.value?(x(),I("div",H,[S(E)])):(x(),I("div",J,t(n[10]||(n[10]=[k("svg",{class:"w-24 h-24 text-gray-600 mx-auto mb-4",fill:"currentColor",viewBox:"0 0 20 20"},[k("path",{"fill-rule":"evenodd",d:"M8 4a4 4 0 100 8 4 4 0 000-8zM2 8a6 6 0 1110.89 3.476l4.817 4.817a1 1 0 01-1.414 1.414l-4.816-4.816A6 6 0 012 8z","clip-rule":"evenodd"})],-1),k("p",{class:"text-gray-400"},"请输入搜索关键词",-1)]))))])):(x(),I("div",_,[k("div",V,[n[4]||(n[4]=k("svg",{class:"w-24 h-24 text-gray-600 mx-auto mb-4",fill:"currentColor",viewBox:"0 0 20 20"},[k("path",{"fill-rule":"evenodd",d:"M10 9a3 3 0 100-6 3 3 0 000 6zm-7 9a7 7 0 1114 0H3z","clip-rule":"evenodd"})],-1)),n[5]||(n[5]=k("h2",{class:"text-xl font-bold text-white mb-2"},"需要登录才能使用搜索",-1)),n[6]||(n[6]=k("p",{class:"text-gray-400 mb-6"},"登录后即可搜索海量漫画资源",-1)),k("div",z,[k("button",{onClick:n[1]||(n[1]=function(e){return O(Z).push("/login")}),class:"w-full px-6 py-3 bg-gradient-to-r from-pink-500 to-purple-600 text-white rounded-xl font-medium hover:from-pink-600 hover:to-purple-700 transition-all transform hover:scale-105 cursor-pointer"}," 立即登录 "),k("button",{onClick:n[2]||(n[2]=function(e){return O(Z).push("/register")}),class:"w-full px-6 py-3 bg-gray-800/50 backdrop-blur-sm border border-gray-700 text-gray-300 rounded-xl font-medium hover:bg-gray-700/50 transition-all cursor-pointer"}," 注册新账号 ")])])]))]),S(L,{modelValue:ie.value,"onUpdate:modelValue":n[3]||(n[3]=function(e){return ie.value=e}),onSearch:pe},null,8,["modelValue"])]}),_:1},8,["title"])}}}))}}})}();
