import{i as e,o as t,l as a,r as s,ae as r,c as l,w as d,A as o,a as i,b as n,d as c,e as u,P as x,U as p,ai as y,x as g,F as m,h as v}from"./index-CDLqFsTy.js";const b={class:"container mx-auto px-4 py-6 pb-20 md:pb-6"},f={class:"bg-gray-800/50 backdrop-blur-sm rounded-lg border border-gray-700/50 p-4 mb-6"},h={class:"grid grid-cols-1 md:grid-cols-4 gap-4"},k={class:"flex items-end"},w={class:"grid grid-cols-1 md:grid-cols-4 gap-4 mb-6"},_={class:"bg-gray-800/50 backdrop-blur-sm rounded-lg border border-gray-700/50 p-4"},D={class:"text-2xl font-bold text-white"},C={class:"bg-gray-800/50 backdrop-blur-sm rounded-lg border border-gray-700/50 p-4"},j={class:"text-2xl font-bold text-white"},M={class:"bg-gray-800/50 backdrop-blur-sm rounded-lg border border-gray-700/50 p-4"},I={class:"text-2xl font-bold text-white"},S={class:"bg-gray-800/50 backdrop-blur-sm rounded-lg border border-gray-700/50 p-4"},N={class:"text-2xl font-bold text-white"},U={class:"mb-6"},V={class:"bg-gray-800/50 backdrop-blur-sm rounded-lg border border-gray-700/50 p-4"},q={class:"space-y-3"},z={class:"flex-1"},A={class:"text-sm font-medium text-white"},F={class:"text-xs text-gray-400"},L={class:"text-sm font-semibold text-pink-400"},O={key:0,class:"text-center text-gray-400 py-8"},P={class:"bg-gray-800/50 backdrop-blur-sm rounded-lg border border-gray-700/50"},T={class:"hidden md:block overflow-x-auto"},B={class:"w-full"},$={class:"divide-y divide-gray-700"},E={class:"px-4 py-3 text-sm text-gray-300"},G={class:"px-4 py-3 text-sm text-gray-300"},H={class:"px-4 py-3 text-sm text-gray-300"},J={class:"px-4 py-3 text-sm font-medium text-pink-400"},K={class:"px-4 py-3 text-sm"},Q={key:0,class:"text-green-400"},R={key:1,class:"text-blue-400"},W={key:2,class:"text-gray-400"},X={class:"px-4 py-3 text-sm text-gray-400"},Y={class:"px-4 py-3 text-sm"},Z=["onClick"],ee={key:0},te={class:"md:hidden"},ae={key:0,class:"divide-y divide-gray-700"},se={class:"flex items-center justify-between mb-3"},re={class:"flex-1"},le={class:"text-sm text-gray-300 font-mono break-all pr-2"},de={class:"flex-shrink-0 text-right"},oe={class:"text-xl font-bold text-pink-400"},ie={class:"grid grid-cols-2 gap-3 text-sm mb-2"},ne={class:"text-gray-300"},ce={class:"text-gray-300"},ue={key:0,class:"text-green-400"},xe={key:1,class:"text-blue-400"},pe={key:2,class:"text-gray-400"},ye={class:"text-xs text-gray-400"},ge={key:1,class:"px-4 py-8 text-center text-gray-400"},me={key:0,class:"px-4 py-3 border-t border-gray-700 flex items-center justify-between"},ve={class:"text-sm text-gray-400"},be={class:"flex space-x-2"},fe=["disabled"],he=["disabled"],ke={key:0,class:"bg-gray-800/50 backdrop-blur-sm rounded-lg border border-gray-700/50 mt-6"},we={class:"overflow-x-auto"},_e={class:"w-full"},De={class:"divide-y divide-gray-700"},Ce={class:"px-4 py-2 text-sm text-gray-300"},je={class:"px-4 py-2 text-sm text-gray-300"},Me={class:"px-4 py-2 text-sm font-medium text-pink-400"},Ie={class:"bg-gray-700/50 border-t border-gray-700"},Se={class:"px-4 py-2 text-sm font-semibold text-gray-300"},Ne={class:"px-4 py-2 text-sm font-bold text-pink-400"},Ue={key:0,class:"fixed inset-0 z-50 flex items-center justify-center p-4"},Ve={class:"relative bg-gray-800 rounded-lg max-w-2xl w-full max-h-[80vh] overflow-y-auto border border-gray-700"},qe={class:"sticky top-0 bg-gray-800 border-b border-gray-700 px-6 py-4 flex items-center justify-between"},ze={key:0,class:"p-6 space-y-4"},Ae={class:"grid grid-cols-2 gap-4"},Fe={class:"font-medium text-white"},Le={class:"font-medium text-white"},Oe={class:"font-medium text-white"},Pe={class:"font-medium text-pink-400"},Te={class:"font-medium text-white"},Be={class:"font-medium text-white"},$e={__name:"AdminPaymentView",setup($e){const Ee=a(),Ge=e();t(()=>{Ge.user?.is_admin?et(1):Ee.push("/comic")});const He=s([]),Je=s({total_revenue:0,total_orders:0,average_order_value:0,unique_users:0}),Ke=s([]),Qe=s([]),Re=s([]),We=s({current_page:1,last_page:1,from:0,to:0,total:0}),Xe=s({startDate:new Date(Date.now()-2592e6).toISOString().split("T")[0],endDate:(new Date).toISOString().split("T")[0],paymentMethod:""}),Ye=s(!1),Ze=s(null),et=async(e=1)=>{try{const t={start_date:Xe.value.startDate,end_date:Xe.value.endDate,page:e,per_page:20};Xe.value.paymentMethod&&(t.payment_method=Xe.value.paymentMethod);const a=await r.get("/api/admin/payment-analysis",{params:t});if(a.data.success){const e=a.data.data;He.value=e.orders.data||[],Je.value=e.summary||{},Ke.value=e.daily_revenue||[],Qe.value=e.product_breakdown||[],Re.value=e.payment_method_breakdown||[],We.value={current_page:e.orders.current_page||1,last_page:e.orders.last_page||1,from:e.orders.from||0,to:e.orders.to||0,total:e.orders.total||0}}}catch(t){}},tt=e=>{e>=1&&e<=We.value.last_page&&et(e)},at=e=>(Number(e||0)/100).toFixed(2),st=e=>new Date(e).toLocaleString("zh-CN",{year:"numeric",month:"2-digit",day:"2-digit",hour:"2-digit",minute:"2-digit"});return(e,t)=>(i(),l(o,{title:"支付分析","show-back":!0},{default:d(()=>[n("div",b,[n("div",f,[t[12]||(t[12]=n("h3",{class:"text-lg font-semibold mb-4 text-white"},"筛选条件",-1)),n("div",h,[n("div",null,[t[8]||(t[8]=n("label",{class:"block text-sm font-medium text-gray-400 mb-1"},"开始日期",-1)),x(n("input",{"onUpdate:modelValue":t[0]||(t[0]=e=>Xe.value.startDate=e),type:"date",class:"w-full px-3 py-2 bg-gray-700 border border-gray-600 text-white rounded-md focus:outline-none focus:ring-2 focus:ring-pink-500 focus:border-pink-500"},null,512),[[p,Xe.value.startDate]])]),n("div",null,[t[9]||(t[9]=n("label",{class:"block text-sm font-medium text-gray-400 mb-1"},"结束日期",-1)),x(n("input",{"onUpdate:modelValue":t[1]||(t[1]=e=>Xe.value.endDate=e),type:"date",class:"w-full px-3 py-2 bg-gray-700 border border-gray-600 text-white rounded-md focus:outline-none focus:ring-2 focus:ring-pink-500 focus:border-pink-500"},null,512),[[p,Xe.value.endDate]])]),n("div",null,[t[11]||(t[11]=n("label",{class:"block text-sm font-medium text-gray-400 mb-1"},"支付方式",-1)),x(n("select",{"onUpdate:modelValue":t[2]||(t[2]=e=>Xe.value.paymentMethod=e),class:"w-full px-3 py-2 bg-gray-700 border border-gray-600 text-white rounded-md focus:outline-none focus:ring-2 focus:ring-pink-500 focus:border-pink-500"},[...t[10]||(t[10]=[n("option",{value:""},"全部",-1),n("option",{value:"wechat"},"微信",-1),n("option",{value:"alipay"},"支付宝",-1)])],512),[[y,Xe.value.paymentMethod]])]),n("div",k,[n("button",{onClick:t[3]||(t[3]=e=>et(1)),class:"w-full px-4 py-2 bg-gradient-to-r from-pink-500 to-purple-600 text-white rounded-md hover:from-pink-600 hover:to-purple-700 transition-all"}," 查询 ")])])]),n("div",w,[n("div",_,[t[13]||(t[13]=n("div",{class:"text-sm text-gray-400"},"总收入",-1)),n("div",D,"¥"+g(at(Je.value.total_revenue)),1)]),n("div",C,[t[14]||(t[14]=n("div",{class:"text-sm text-gray-400"},"总订单数",-1)),n("div",j,g(Je.value.total_orders),1)]),n("div",M,[t[15]||(t[15]=n("div",{class:"text-sm text-gray-400"},"平均订单金额",-1)),n("div",I,"¥"+g(at(Je.value.average_order_value)),1)]),n("div",S,[t[16]||(t[16]=n("div",{class:"text-sm text-gray-400"},"付费用户数",-1)),n("div",N,g(Je.value.unique_users),1)])]),n("div",U,[n("div",V,[t[17]||(t[17]=n("h3",{class:"text-lg font-semibold mb-4 text-white"},"产品销售分布",-1)),n("div",q,[(i(!0),c(m,null,v(Qe.value,e=>(i(),c("div",{key:e.product_key,class:"flex items-center justify-between"},[n("div",z,[n("div",A,g(e.product_name),1),n("div",F,g(e.orders)+" 笔订单",1)]),n("div",L,"¥"+g(at(e.revenue)),1)]))),128)),0===Qe.value.length?(i(),c("div",O," 暂无数据 ")):u("",!0)])])]),n("div",P,[t[25]||(t[25]=n("div",{class:"px-4 py-3 border-b border-gray-700"},[n("h3",{class:"text-lg font-semibold text-white"},"订单列表")],-1)),n("div",T,[n("table",B,[t[19]||(t[19]=n("thead",{class:"bg-gray-700/50 border-b border-gray-700"},[n("tr",null,[n("th",{class:"px-4 py-3 text-left text-xs font-medium text-gray-400 uppercase tracking-wider"},"订单号"),n("th",{class:"px-4 py-3 text-left text-xs font-medium text-gray-400 uppercase tracking-wider"},"用户ID"),n("th",{class:"px-4 py-3 text-left text-xs font-medium text-gray-400 uppercase tracking-wider"},"产品"),n("th",{class:"px-4 py-3 text-left text-xs font-medium text-gray-400 uppercase tracking-wider"},"金额"),n("th",{class:"px-4 py-3 text-left text-xs font-medium text-gray-400 uppercase tracking-wider"},"支付方式"),n("th",{class:"px-4 py-3 text-left text-xs font-medium text-gray-400 uppercase tracking-wider"},"时间"),n("th",{class:"px-4 py-3 text-left text-xs font-medium text-gray-400 uppercase tracking-wider"},"操作")])],-1)),n("tbody",$,[(i(!0),c(m,null,v(He.value,e=>(i(),c("tr",{key:e.id,class:"hover:bg-gray-700/30"},[n("td",E,g(e.mch_order_no),1),n("td",G,g(e.user_id),1),n("td",H,g(e.product_name),1),n("td",J,"¥"+g(at(e.receive_amount)),1),n("td",K,["wechat"===e.payment_method?(i(),c("span",Q,"微信")):"alipay"===e.payment_method?(i(),c("span",R,"支付宝")):(i(),c("span",W,g(e.payment_method),1))]),n("td",X,g(st(e.created_at)),1),n("td",Y,[n("button",{onClick:t=>(async e=>{try{const t=await r.get(`/api/admin/payment-analysis/${e}`);t.data.success&&(Ze.value=t.data.data,Ye.value=!0)}catch(t){}})(e.id),class:"text-pink-400 hover:text-pink-300"}," 查看 ",8,Z)])]))),128)),0===He.value.length?(i(),c("tr",ee,[...t[18]||(t[18]=[n("td",{colspan:"7",class:"px-4 py-8 text-center text-gray-400"},"暂无订单数据",-1)])])):u("",!0)])])]),n("div",te,[He.value.length>0?(i(),c("div",ae,[(i(!0),c(m,null,v(He.value,e=>(i(),c("div",{key:e.id,class:"p-4"},[n("div",se,[n("div",re,[t[20]||(t[20]=n("div",{class:"text-xs text-gray-500 mb-0.5"},"订单号",-1)),n("div",le,g(e.mch_order_no),1)]),n("div",de,[n("div",oe,"¥"+g(at(e.receive_amount)),1)])]),n("div",ie,[n("div",null,[t[21]||(t[21]=n("div",{class:"text-xs text-gray-500 mb-0.5"},"产品",-1)),n("div",ne,g(e.product_name),1)]),n("div",null,[t[22]||(t[22]=n("div",{class:"text-xs text-gray-500 mb-0.5"},"用户ID",-1)),n("div",ce,g(e.user_id),1)]),n("div",null,[t[23]||(t[23]=n("div",{class:"text-xs text-gray-500 mb-0.5"},"支付方式",-1)),n("div",null,["wechat"===e.payment_method?(i(),c("span",ue,"微信")):"alipay"===e.payment_method?(i(),c("span",xe,"支付宝")):(i(),c("span",pe,g(e.payment_method),1))])]),n("div",null,[t[24]||(t[24]=n("div",{class:"text-xs text-gray-500 mb-0.5"},"时间",-1)),n("div",ye,g(st(e.created_at)),1)])])]))),128))])):(i(),c("div",ge," 暂无订单数据 "))]),We.value.total>0?(i(),c("div",me,[n("div",ve," 显示 "+g(We.value.from)+" - "+g(We.value.to)+" 共 "+g(We.value.total)+" 条 ",1),n("div",be,[n("button",{onClick:t[4]||(t[4]=e=>tt(We.value.current_page-1)),disabled:1===We.value.current_page,class:"px-3 py-1 bg-gray-700 border border-gray-600 text-gray-300 rounded-md disabled:opacity-50 disabled:cursor-not-allowed hover:bg-gray-600"}," 上一页 ",8,fe),n("button",{onClick:t[5]||(t[5]=e=>tt(We.value.current_page+1)),disabled:We.value.current_page===We.value.last_page,class:"px-3 py-1 bg-gray-700 border border-gray-600 text-gray-300 rounded-md disabled:opacity-50 disabled:cursor-not-allowed hover:bg-gray-600"}," 下一页 ",8,he)])])):u("",!0)]),Ke.value&&Ke.value.length>0?(i(),c("div",ke,[t[28]||(t[28]=n("div",{class:"px-4 py-3 border-b border-gray-700"},[n("h3",{class:"text-lg font-semibold text-white"},"每日收入明细")],-1)),n("div",we,[n("table",_e,[t[27]||(t[27]=n("thead",{class:"bg-gray-700/50 border-b border-gray-700"},[n("tr",null,[n("th",{class:"px-4 py-2 text-left text-xs font-medium text-gray-400 uppercase tracking-wider"},"日期"),n("th",{class:"px-4 py-2 text-left text-xs font-medium text-gray-400 uppercase tracking-wider"},"订单数"),n("th",{class:"px-4 py-2 text-left text-xs font-medium text-gray-400 uppercase tracking-wider"},"收入金额")])],-1)),n("tbody",De,[(i(!0),c(m,null,v(Ke.value,(e,t)=>(i(),c("tr",{key:t,class:"hover:bg-gray-700/30"},[n("td",Ce,g(e.date),1),n("td",je,g(e.orders),1),n("td",Me,"¥"+g(at(e.revenue)),1)]))),128))]),n("tfoot",Ie,[n("tr",null,[t[26]||(t[26]=n("td",{class:"px-4 py-2 text-sm font-semibold text-gray-300"},"合计",-1)),n("td",Se,g(Ke.value.reduce((e,t)=>e+(Number(t.orders)||0),0)),1),n("td",Ne,"¥"+g(at(Ke.value.reduce((e,t)=>e+(Number(t.revenue)||0),0))),1)])])])])])):u("",!0)]),Ye.value?(i(),c("div",Ue,[n("div",{class:"absolute inset-0 bg-black bg-opacity-50",onClick:t[6]||(t[6]=e=>Ye.value=!1)}),n("div",Ve,[n("div",qe,[t[30]||(t[30]=n("h3",{class:"text-lg font-semibold text-white"},"订单详情",-1)),n("button",{onClick:t[7]||(t[7]=e=>Ye.value=!1),class:"text-gray-400 hover:text-white"},[...t[29]||(t[29]=[n("svg",{class:"w-6 h-6",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24"},[n("path",{"stroke-linecap":"round","stroke-linejoin":"round","stroke-width":"2",d:"M6 18L18 6M6 6l12 12"})],-1)])])]),Ze.value?(i(),c("div",ze,[n("div",Ae,[n("div",null,[t[31]||(t[31]=n("div",{class:"text-sm text-gray-400"},"订单号",-1)),n("div",Fe,g(Ze.value.mch_order_no),1)]),n("div",null,[t[32]||(t[32]=n("div",{class:"text-sm text-gray-400"},"用户ID",-1)),n("div",Le,g(Ze.value.user_id),1)]),n("div",null,[t[33]||(t[33]=n("div",{class:"text-sm text-gray-400"},"产品",-1)),n("div",Oe,g(Ze.value.product_name),1)]),n("div",null,[t[34]||(t[34]=n("div",{class:"text-sm text-gray-400"},"金额",-1)),n("div",Pe,"¥"+g(at(Ze.value.receive_amount)),1)]),n("div",null,[t[35]||(t[35]=n("div",{class:"text-sm text-gray-400"},"支付方式",-1)),n("div",Te,g(Ze.value.payment_method),1)]),n("div",null,[t[36]||(t[36]=n("div",{class:"text-sm text-gray-400"},"创建时间",-1)),n("div",Be,g(st(Ze.value.created_at)),1)])])])):u("",!0)])])):u("",!0)]),_:1}))}};export{$e as default};
