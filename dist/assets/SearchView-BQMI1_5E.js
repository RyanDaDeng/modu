import{u as e,i as a,r as l,j as t,o,k as s,l as r,m as n,c as i,w as u,A as v,n as c,p as d,q as g,a as p,e as m,b as h,f as y,s as x,_ as b,d as f,F as w,h as k,t as I,v as S,L as C,x as L}from"./index-DK8larDe.js";import{_ as M}from"./ComicCard-Be-zjJnS.js";const j={class:"container mx-auto px-4 py-6"},z={key:0,class:"text-center py-12"},V={class:"max-w-md mx-auto"},A={class:"space-y-3"},B={key:1},O={key:0,class:"space-y-6 max-w-5xl mx-auto"},P={class:"grid gap-6 md:grid-cols-2"},T={class:"text-lg font-bold text-white mb-4 flex items-center"},_={class:"flex flex-wrap gap-2"},q=["onClick"],E={class:"relative"},H={key:1,class:"flex justify-center py-12"},$={key:2,class:"text-center py-12"},D={key:2},J={key:0,class:"flex justify-center py-12"},N={key:1,class:"text-center py-12"},Q={key:2,class:"grid grid-cols-3 sm:grid-cols-4 md:grid-cols-5 lg:grid-cols-6 xl:grid-cols-7 gap-3"},U={key:3,class:"flex justify-center py-8"},F={key:4,class:"text-center py-8 text-gray-400"},Y={name:"SearchView"},G=Object.assign(Y,{setup(Y){const G=g(),K=s(),R=e(),W=a(),X=l(""),Z=l([]),ee=l(!1),ae=l(1),le=l(!0),te=l(null),oe=l(!1),se=l([]),re=l(!1);let ne=null;const ie=()=>{oe.value=!0},ue=e=>{X.value=e,Z.value=[],ae.value=1,le.value=!0,sessionStorage.removeItem(de),sessionStorage.removeItem(ge),me(!0)},ve=()=>{X.value="",Z.value=[],le.value=!0,ae.value=1,sessionStorage.removeItem(de),sessionStorage.removeItem(ge),K.push("/search"),ce()},ce=async()=>{if(W.isLoggedIn&&!(se.value.length>0)){re.value=!0;try{const e=await c();e&&e.blocks&&(se.value=e.blocks)}catch(e){}finally{re.value=!1}}},de="searchPageState",ge="searchPageScroll",pe=()=>{const e={searchQuery:X.value,comics:Z.value,currentPage:ae.value,hasMore:le.value,timestamp:Date.now()};sessionStorage.setItem(de,JSON.stringify(e))},me=async(e=!1)=>{if(W.isLoggedIn&&X.value&&(!ee.value||e)&&(e&&(Z.value=[],ae.value=1,le.value=!0,R.addSearchHistory(X.value),sessionStorage.removeItem(de),sessionStorage.removeItem(ge)),le.value)){ee.value=!0;try{const e=await d(X.value,ae.value),a=Array.isArray(e)?e:e?.content||[];if(a&&0!==a.length){const e=a.map(e=>({...e,page:ae.value}));Z.value.push(...e),ae.value++,a.length<80&&(le.value=!1)}else le.value=!1;pe()}catch(a){le.value=!1}finally{ee.value=!1}}},he=()=>{sessionStorage.setItem(ge,window.scrollY.toString())};return t(()=>G.query.wd,e=>{const a=e||"";if(a!==X.value)if(X.value=a,X.value&&W.isLoggedIn){(()=>{const e=sessionStorage.getItem(de);if(e)try{const a=JSON.parse(e);if(a.searchQuery===X.value&&Date.now()-a.timestamp<18e5)return Z.value=a.comics||[],ae.value=a.currentPage||1,le.value=void 0===a.hasMore||a.hasMore,setTimeout(()=>{const e=sessionStorage.getItem(ge);e&&window.scrollTo(0,parseInt(e))},100),!0}catch(a){}return!1})()||me(!0)}else!X.value&&W.isLoggedIn&&ce()},{immediate:!0}),o(()=>{ne&&ne.disconnect(),ne=new IntersectionObserver(e=>{e[0].isIntersecting&&!ee.value&&le.value&&X.value&&W.isLoggedIn&&me()},{rootMargin:"100px"}),te.value&&ne.observe(te.value),X.value||ce(),window.addEventListener("beforeunload",he),K.beforeEach((e,a,l)=>{"search"===a.name&&Z.value.length>0&&(he(),pe()),l()})}),r(()=>{Z.value.length>0&&(he(),pe())}),n(()=>{ne&&ne.disconnect(),window.removeEventListener("beforeunload",he)}),(e,a)=>(p(),i(v,{title:X.value?`搜索结果: ${X.value}`:"搜索"},{action:u(()=>[h("button",{onClick:ie,class:"lg:hidden p-2 text-gray-400 hover:text-pink-400 transition-colors",title:"搜索"},[...a[4]||(a[4]=[h("svg",{class:"w-5 h-5",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24"},[h("path",{"stroke-linecap":"round","stroke-linejoin":"round","stroke-width":"2",d:"M21 21l-6-6m2-5a7 7 0 11-14 0 7 7 0 0114 0z"})],-1)])])]),default:u(()=>[x(W).isLoggedIn?(p(),i(b,{key:0,modelValue:X.value,"onUpdate:modelValue":a[0]||(a[0]=e=>X.value=e),"show-bar":!0,"show-current-query":!0,onClick:ie,onClear:ve},null,8,["modelValue"])):m("",!0),h("div",j,[x(W).isLoggedIn?X.value?(p(),f("div",D,[ee.value&&!Z.value.length?(p(),f("div",J,[y(C)])):Z.value.length||ee.value?(p(),f("div",Q,[(p(!0),f(w,null,k(Z.value,e=>(p(),i(M,{key:`${e.id}-${e.page}`,comic:e},null,8,["comic"]))),128))])):(p(),f("div",N,[...a[12]||(a[12]=[h("svg",{class:"w-24 h-24 text-gray-600 mx-auto mb-4",fill:"currentColor",viewBox:"0 0 20 20"},[h("path",{"fill-rule":"evenodd",d:"M18 10a8 8 0 11-16 0 8 8 0 0116 0zm-7 4a1 1 0 11-2 0 1 1 0 012 0zm-1-9a1 1 0 00-1 1v4a1 1 0 102 0V6a1 1 0 00-1-1z","clip-rule":"evenodd"})],-1),h("p",{class:"text-gray-400"},"没有找到相关结果",-1)])])),ee.value&&Z.value.length?(p(),f("div",U,[y(C)])):m("",!0),!le.value&&Z.value.length?(p(),f("div",F," 没有更多结果了 ")):m("",!0),h("div",{ref_key:"loadMoreTrigger",ref:te,class:"h-20"},null,512)])):(p(),f("div",B,[se.value.length>0?(p(),f("div",O,[a[10]||(a[10]=h("div",{class:"text-center mb-8"},[h("h2",{class:"text-2xl sm:text-3xl font-bold text-white mb-3 bg-gradient-to-r from-pink-500 to-purple-600 bg-clip-text text-transparent"},"热门标签"),h("p",{class:"text-gray-400"},"点击标签快速搜索相关漫画")],-1)),h("div",P,[(p(!0),f(w,null,k(se.value,e=>(p(),f("div",{key:e.title,class:"group bg-gradient-to-br from-gray-800/40 to-gray-900/40 backdrop-blur-sm rounded-2xl p-5 border border-white/10 hover:border-pink-500/30 transition-all duration-300"},[h("h3",T,[a[8]||(a[8]=h("span",{class:"w-1.5 h-6 bg-gradient-to-b from-pink-500 to-purple-600 rounded-full mr-3 group-hover:h-7 transition-all"},null,-1)),I(" "+S(e.title),1)]),h("div",_,[(p(!0),f(w,null,k(e.content,e=>(p(),f("button",{key:e,onClick:a=>(e=>{X.value=e,ee.value=!0,window.scrollTo({top:0,behavior:"smooth"}),Z.value=[],ae.value=1,le.value=!0,sessionStorage.removeItem(de),sessionStorage.removeItem(ge),R.addSearchHistory(e),me(!0)})(e),class:"group/tag px-3 py-1.5 bg-gray-800/50 hover:bg-gradient-to-r hover:from-pink-500/30 hover:to-purple-600/30 border border-white/10 hover:border-pink-500/40 text-gray-300 hover:text-white rounded-lg text-sm transition-all duration-200 cursor-pointer hover:shadow-lg hover:shadow-pink-500/20 hover:scale-105 active:scale-95"},[h("span",E,[I(S(e)+" ",1),a[9]||(a[9]=h("span",{class:"absolute inset-0 rounded-lg bg-gradient-to-r from-pink-500 to-purple-600 opacity-0 group-hover/tag:opacity-20 blur transition-opacity"},null,-1))])],8,q))),128))])]))),128))])])):re.value?(p(),f("div",H,[y(C)])):(p(),f("div",$,[...a[11]||(a[11]=[h("svg",{class:"w-24 h-24 text-gray-600 mx-auto mb-4",fill:"currentColor",viewBox:"0 0 20 20"},[h("path",{"fill-rule":"evenodd",d:"M8 4a4 4 0 100 8 4 4 0 000-8zM2 8a6 6 0 1110.89 3.476l4.817 4.817a1 1 0 01-1.414 1.414l-4.816-4.816A6 6 0 012 8z","clip-rule":"evenodd"})],-1),h("p",{class:"text-gray-400"},"请输入搜索关键词",-1)])]))])):(p(),f("div",z,[h("div",V,[a[5]||(a[5]=h("svg",{class:"w-24 h-24 text-gray-600 mx-auto mb-4",fill:"currentColor",viewBox:"0 0 20 20"},[h("path",{"fill-rule":"evenodd",d:"M10 9a3 3 0 100-6 3 3 0 000 6zm-7 9a7 7 0 1114 0H3z","clip-rule":"evenodd"})],-1)),a[6]||(a[6]=h("h2",{class:"text-xl font-bold text-white mb-2"},"需要登录才能使用搜索",-1)),a[7]||(a[7]=h("p",{class:"text-gray-400 mb-6"},"登录后即可搜索海量漫画资源",-1)),h("div",A,[h("button",{onClick:a[1]||(a[1]=e=>x(K).push("/login")),class:"w-full px-6 py-3 bg-gradient-to-r from-pink-500 to-purple-600 text-white rounded-xl font-medium hover:from-pink-600 hover:to-purple-700 transition-all transform hover:scale-105 cursor-pointer"}," 立即登录 "),h("button",{onClick:a[2]||(a[2]=e=>x(K).push("/register")),class:"w-full px-6 py-3 bg-gray-800/50 backdrop-blur-sm border border-gray-700 text-gray-300 rounded-xl font-medium hover:bg-gray-700/50 transition-all cursor-pointer"}," 注册新账号 ")])])]))]),y(L,{modelValue:oe.value,"onUpdate:modelValue":a[3]||(a[3]=e=>oe.value=e),onSearch:ue},null,8,["modelValue"])]),_:1},8,["title"]))}});export{G as default};
