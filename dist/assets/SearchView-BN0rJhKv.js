import{u as e,i as t,r as a,j as l,k as s,o,l as r,m as n,n as i,c as u,w as c,A as v,p as d,q as g,s as p,a as m,e as h,b as x,f as y,t as b,_ as f,d as w,F as k,h as I,v as S,x as C,L as M,y as j}from"./index-Dk5K0Uig.js";import{_ as L}from"./ComicCard-CFNCy21G.js";const z={class:"container mx-auto px-4 py-6"},V={key:0,class:"text-center py-12"},B={class:"max-w-md mx-auto"},$={class:"space-y-3"},A={key:1},D={key:0,class:"space-y-6 max-w-5xl mx-auto"},O={class:"grid gap-6 md:grid-cols-2"},P={class:"text-lg font-bold text-white mb-4 flex items-center"},T={class:"flex flex-wrap gap-2"},_=["onClick"],q={class:"relative"},E={key:1,class:"flex justify-center py-12"},H={key:2,class:"text-center py-12"},J={key:2},N={key:0,class:"mb-6"},Q={class:"bg-gradient-to-r from-blue-600/20 to-purple-600/20 backdrop-blur-sm rounded-xl shadow-2xl border border-blue-500/30 overflow-hidden"},U={class:"flex items-center justify-between"},F={class:"flex items-center space-x-3"},Y={class:"text-left"},G={class:"text-base text-white font-medium"},K={key:1,class:"flex justify-center py-12"},R={key:2,class:"text-center py-12"},W={key:3,class:"grid grid-cols-3 sm:grid-cols-4 md:grid-cols-5 lg:grid-cols-6 xl:grid-cols-7 gap-3"},X={key:4,class:"flex justify-center py-8"},Z={key:5,class:"text-center py-8 text-gray-400"},ee={name:"SearchView"},te=Object.assign(ee,{setup(ee){const te=p(),ae=r(),le=e(),se=t(),oe=a(""),re=a([]),ne=a(!1),ie=a(1),ue=a(!0),ce=a(null),ve=a(!1),de=a([]),ge=a(!1);let pe=null;const me=l(()=>{const e=oe.value.trim();return e.length>0&&/^\d+$/.test(e)}),he=()=>{const e=oe.value.trim();e&&/^\d+$/.test(e)&&ae.push(`/chapter/${e}`)},xe=()=>{ve.value=!0},ye=e=>{oe.value=e,re.value=[],ie.value=1,ue.value=!0,sessionStorage.removeItem(we),sessionStorage.removeItem(ke),Se(!0)},be=()=>{oe.value="",re.value=[],ue.value=!0,ie.value=1,sessionStorage.removeItem(we),sessionStorage.removeItem(ke),ae.push("/search"),fe()},fe=async()=>{if(se.isLoggedIn&&!(de.value.length>0)){ge.value=!0;try{const e=await d();e&&e.blocks&&(de.value=e.blocks)}catch(e){}finally{ge.value=!1}}},we="searchPageState",ke="searchPageScroll",Ie=()=>{const e={searchQuery:oe.value,comics:re.value,currentPage:ie.value,hasMore:ue.value,timestamp:Date.now()};sessionStorage.setItem(we,JSON.stringify(e))},Se=async(e=!1)=>{if(se.isLoggedIn&&oe.value&&(!ne.value||e)&&(e&&(re.value=[],ie.value=1,ue.value=!0,le.addSearchHistory(oe.value),sessionStorage.removeItem(we),sessionStorage.removeItem(ke)),ue.value)){ne.value=!0;try{const e=await g(oe.value,ie.value),t=Array.isArray(e)?e:e?.content||[];if(t&&0!==t.length){const e=t.map(e=>({...e,page:ie.value}));re.value.push(...e),ie.value++,t.length<80&&(ue.value=!1)}else ue.value=!1;Ie()}catch(t){ue.value=!1}finally{ne.value=!1}}},Ce=()=>{sessionStorage.setItem(ke,window.scrollY.toString())};return s(()=>te.query.wd,e=>{const t=e||"";if(t!==oe.value)if(oe.value=t,oe.value&&se.isLoggedIn){(()=>{const e=sessionStorage.getItem(we);if(e)try{const t=JSON.parse(e);if(t.searchQuery===oe.value&&Date.now()-t.timestamp<18e5)return re.value=t.comics||[],ie.value=t.currentPage||1,ue.value=void 0===t.hasMore||t.hasMore,setTimeout(()=>{const e=sessionStorage.getItem(ke);e&&window.scrollTo(0,parseInt(e))},100),!0}catch(t){}return!1})()||Se(!0)}else!oe.value&&se.isLoggedIn&&fe()},{immediate:!0}),o(()=>{pe&&pe.disconnect(),pe=new IntersectionObserver(e=>{e[0].isIntersecting&&!ne.value&&ue.value&&oe.value&&se.isLoggedIn&&Se()},{rootMargin:"100px"}),ce.value&&pe.observe(ce.value),oe.value||fe(),window.addEventListener("beforeunload",Ce),ae.beforeEach((e,t,a)=>{"search"===t.name&&re.value.length>0&&(Ce(),Ie()),a()})}),n(()=>{re.value.length>0&&(Ce(),Ie())}),i(()=>{pe&&pe.disconnect(),window.removeEventListener("beforeunload",Ce)}),(e,t)=>(m(),u(v,{title:oe.value?`搜索结果: ${oe.value}`:"搜索"},{action:c(()=>[x("button",{onClick:xe,class:"lg:hidden p-2 text-gray-400 hover:text-pink-400 transition-colors",title:"搜索"},[...t[4]||(t[4]=[x("svg",{class:"w-5 h-5",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24"},[x("path",{"stroke-linecap":"round","stroke-linejoin":"round","stroke-width":"2",d:"M21 21l-6-6m2-5a7 7 0 11-14 0 7 7 0 0114 0z"})],-1)])])]),default:c(()=>[b(se).isLoggedIn?(m(),u(f,{key:0,modelValue:oe.value,"onUpdate:modelValue":t[0]||(t[0]=e=>oe.value=e),"show-bar":!0,"show-current-query":!0,onClick:xe,onClear:be},null,8,["modelValue"])):h("",!0),x("div",z,[b(se).isLoggedIn?oe.value?(m(),w("div",J,[me.value?(m(),w("div",N,[x("div",Q,[x("button",{onClick:he,class:"w-full p-4 hover:bg-white/5 transition-colors cursor-pointer"},[x("div",U,[x("div",F,[t[13]||(t[13]=x("div",{class:"p-2 bg-blue-500/20 rounded-lg"},[x("svg",{class:"w-6 h-6 text-blue-400",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24"},[x("path",{"stroke-linecap":"round","stroke-linejoin":"round","stroke-width":"2",d:"M7 20l4-16m2 16l4-16M6 9h14M4 15h14"})])],-1)),x("div",Y,[x("p",G,"直接跳转到 ID: "+C(oe.value),1),t[12]||(t[12]=x("p",{class:"text-sm text-gray-400"},"点击尝试直接访问此漫画ID",-1))])]),t[14]||(t[14]=x("svg",{class:"w-5 h-5 text-gray-400",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24"},[x("path",{"stroke-linecap":"round","stroke-linejoin":"round","stroke-width":"2",d:"M9 5l7 7-7 7"})],-1))])])])])):h("",!0),ne.value&&!re.value.length?(m(),w("div",K,[y(M)])):re.value.length||ne.value?(m(),w("div",W,[(m(!0),w(k,null,I(re.value,e=>(m(),u(L,{key:`${e.id}-${e.page}`,comic:e},null,8,["comic"]))),128))])):(m(),w("div",R,[...t[15]||(t[15]=[x("svg",{class:"w-24 h-24 text-gray-600 mx-auto mb-4",fill:"currentColor",viewBox:"0 0 20 20"},[x("path",{"fill-rule":"evenodd",d:"M18 10a8 8 0 11-16 0 8 8 0 0116 0zm-7 4a1 1 0 11-2 0 1 1 0 012 0zm-1-9a1 1 0 00-1 1v4a1 1 0 102 0V6a1 1 0 00-1-1z","clip-rule":"evenodd"})],-1),x("p",{class:"text-gray-400"},"没有找到相关结果",-1)])])),ne.value&&re.value.length?(m(),w("div",X,[y(M)])):h("",!0),!ue.value&&re.value.length?(m(),w("div",Z," 没有更多结果了 ")):h("",!0),x("div",{ref_key:"loadMoreTrigger",ref:ce,class:"h-20"},null,512)])):(m(),w("div",A,[de.value.length>0?(m(),w("div",D,[t[10]||(t[10]=x("div",{class:"text-center mb-8"},[x("h2",{class:"text-2xl sm:text-3xl font-bold text-white mb-3 bg-gradient-to-r from-pink-500 to-purple-600 bg-clip-text text-transparent"},"热门标签"),x("p",{class:"text-gray-400"},"点击标签快速搜索相关漫画")],-1)),x("div",O,[(m(!0),w(k,null,I(de.value,e=>(m(),w("div",{key:e.title,class:"group bg-gradient-to-br from-gray-800/40 to-gray-900/40 backdrop-blur-sm rounded-2xl p-5 border border-white/10 hover:border-pink-500/30 transition-all duration-300"},[x("h3",P,[t[8]||(t[8]=x("span",{class:"w-1.5 h-6 bg-gradient-to-b from-pink-500 to-purple-600 rounded-full mr-3 group-hover:h-7 transition-all"},null,-1)),S(" "+C(e.title),1)]),x("div",T,[(m(!0),w(k,null,I(e.content,e=>(m(),w("button",{key:e,onClick:t=>(e=>{oe.value=e,ne.value=!0,window.scrollTo({top:0,behavior:"smooth"}),re.value=[],ie.value=1,ue.value=!0,sessionStorage.removeItem(we),sessionStorage.removeItem(ke),le.addSearchHistory(e),Se(!0)})(e),class:"group/tag px-3 py-1.5 bg-gray-800/50 hover:bg-gradient-to-r hover:from-pink-500/30 hover:to-purple-600/30 border border-white/10 hover:border-pink-500/40 text-gray-300 hover:text-white rounded-lg text-sm transition-all duration-200 cursor-pointer hover:shadow-lg hover:shadow-pink-500/20 hover:scale-105 active:scale-95"},[x("span",q,[S(C(e)+" ",1),t[9]||(t[9]=x("span",{class:"absolute inset-0 rounded-lg bg-gradient-to-r from-pink-500 to-purple-600 opacity-0 group-hover/tag:opacity-20 blur transition-opacity"},null,-1))])],8,_))),128))])]))),128))])])):ge.value?(m(),w("div",E,[y(M)])):(m(),w("div",H,[...t[11]||(t[11]=[x("svg",{class:"w-24 h-24 text-gray-600 mx-auto mb-4",fill:"currentColor",viewBox:"0 0 20 20"},[x("path",{"fill-rule":"evenodd",d:"M8 4a4 4 0 100 8 4 4 0 000-8zM2 8a6 6 0 1110.89 3.476l4.817 4.817a1 1 0 01-1.414 1.414l-4.816-4.816A6 6 0 012 8z","clip-rule":"evenodd"})],-1),x("p",{class:"text-gray-400"},"请输入搜索关键词",-1)])]))])):(m(),w("div",V,[x("div",B,[t[5]||(t[5]=x("svg",{class:"w-24 h-24 text-gray-600 mx-auto mb-4",fill:"currentColor",viewBox:"0 0 20 20"},[x("path",{"fill-rule":"evenodd",d:"M10 9a3 3 0 100-6 3 3 0 000 6zm-7 9a7 7 0 1114 0H3z","clip-rule":"evenodd"})],-1)),t[6]||(t[6]=x("h2",{class:"text-xl font-bold text-white mb-2"},"需要登录才能使用搜索",-1)),t[7]||(t[7]=x("p",{class:"text-gray-400 mb-6"},"登录后即可搜索海量漫画资源",-1)),x("div",$,[x("button",{onClick:t[1]||(t[1]=e=>b(ae).push("/login")),class:"w-full px-6 py-3 bg-gradient-to-r from-pink-500 to-purple-600 text-white rounded-xl font-medium hover:from-pink-600 hover:to-purple-700 transition-all transform hover:scale-105 cursor-pointer"}," 立即登录 "),x("button",{onClick:t[2]||(t[2]=e=>b(ae).push("/register")),class:"w-full px-6 py-3 bg-gray-800/50 backdrop-blur-sm border border-gray-700 text-gray-300 rounded-xl font-medium hover:bg-gray-700/50 transition-all cursor-pointer"}," 注册新账号 ")])])]))]),y(j,{modelValue:ve.value,"onUpdate:modelValue":t[3]||(t[3]=e=>ve.value=e),onSearch:ye},null,8,["modelValue"])]),_:1},8,["title"]))}});export{te as default};
