import{a0 as e,B as t,i as r,C as s,r as a,j as o,k as l,o as i,s as n,c,w as d,l as u,a as p,b as x,f as m,d as g,e as v,x as y,t as b,O as f,L as h,F as w,h as k,U as _,v as j,Q as C,a5 as V,V as L,W as B,$ as I}from"./index-bTbxLbx9.js";import{g as M,c as z}from"./vip-bV9AnOTN.js";import{G as D}from"./GeneralLayout-D3jsw9AT.js";const U=e.create({baseURL:"https://api.modu18.vip",headers:{"Content-Type":"application/json",Accept:"application/json","X-Requested-With":"XMLHttpRequest"},withCredentials:!1});U.interceptors.request.use(e=>{const t=localStorage.getItem("auth_token");return t&&(e.headers.Authorization=`Bearer ${t}`),e},e=>Promise.reject(e)),U.interceptors.response.use(e=>e.data,e=>(401===e.response?.status&&(localStorage.removeItem("auth_token"),window.location.href="/login"),Promise.reject(e.response?.data||e)));const $={class:"container mx-auto px-4 py-6"},q={class:"text-center mb-8"},P={class:"text-gray-400 text-sm sm:text-base"},W={key:0,class:"max-w-2xl mx-auto mb-8"},A={class:"grid grid-cols-1 sm:grid-cols-2 gap-4"},R={class:"bg-gradient-to-r from-gray-900/60 to-gray-800/60 backdrop-blur-sm rounded-xl p-4 border border-white/10"},S={class:"flex items-center justify-between"},G={key:0,class:"text-green-400 text-xs"},H={key:1,class:"text-gray-400 text-xs"},T={class:"bg-gradient-to-r from-gray-900/60 to-gray-800/60 backdrop-blur-sm rounded-xl p-4 border border-white/10"},X={class:"flex items-center justify-between"},F={key:0,class:"text-green-400 text-xs"},K={key:1,class:"text-gray-400 text-xs"},N={class:"max-w-md mx-auto mb-6 sm:max-w-3xl"},O={class:"flex bg-gray-900/60 backdrop-blur-sm rounded-lg p-1 border border-white/10"},Q={key:1,class:"flex justify-center py-20"},E={key:2,class:"max-w-md mx-auto space-y-4 sm:max-w-3xl sm:space-y-0 sm:grid sm:grid-cols-3 sm:gap-4 sm:items-stretch"},J={key:0,class:"absolute -top-3 left-1/2 transform -translate-x-1/2"},Y={class:"flex flex-col flex-grow text-center"},Z={class:"text-xl font-bold text-white mb-2"},ee={class:"text-gray-400 text-sm mb-4"},te={class:"mb-4"},re={class:"flex items-baseline justify-center gap-1"},se={class:"text-pink-500 text-3xl font-bold"},ae={class:"h-10 mt-2"},oe={class:"text-gray-500 text-sm line-through"},le={key:0,class:"text-green-400 text-xs"},ie={class:"flex-grow flex items-center justify-center border-t border-white/10 py-4"},ne={class:"space-y-2"},ce=["onClick"],de=["onClick"],ue={class:"mt-8 max-w-md mx-auto sm:max-w-2xl"},pe={class:"bg-gray-900/60 backdrop-blur-sm rounded-xl p-6 border border-white/10"},xe={class:"space-y-4"},me=["disabled"],ge={key:0},ve={key:1,class:"flex items-center justify-center"},ye={key:0,class:"fixed inset-0 z-50 flex items-center justify-center bg-black/70"},be={class:"bg-gray-900/90 backdrop-blur-xl rounded-xl p-6 border border-white/10 text-center max-w-sm mx-4"},fe={class:"text-white mt-4 text-lg font-medium"},he=t({__name:"VipView",setup(e){const t=u(),he=n(),we=r(),ke=s(),_e=a("comic"),je=a([]),Ce=a(!1),Ve=a(!1),Le=a(!1),Be=a(null),Ie=a(null),Me=a(!1),ze=a("正在创建订单..."),De=a(""),Ue=a(!1),$e=o(()=>je.value.filter(e=>{let t=e.type;return t||(t=e.key&&(e.key.endsWith("-video")||e.key.startsWith("video-"))?"video":"comic"),"comic"===_e.value?"comic"===t:"video"===t})),qe=o(()=>{if(!we.user?.vip_expired_at)return!1;return new Date(we.user.vip_expired_at)>new Date}),Pe=o(()=>{if(!we.user?.video_expired_at)return!1;return new Date(we.user.video_expired_at)>new Date}),We=e=>{if(!e)return"";return new Date(e).toLocaleDateString("zh-CN",{year:"numeric",month:"2-digit",day:"2-digit"})},Ae=(e,t)=>{we.isLoggedIn?(Be.value=e,Ie.value=t,Le.value=!0):Ve.value=!0},Re=async()=>{Le.value=!1,Me.value=!0,ze.value="正在创建订单...";try{const e=await z(Be.value.key,Ie.value);e.success&&e.payment_url?(ze.value="正在转向支付页面...",setTimeout(()=>{window.location.href=e.payment_url},500)):(Me.value=!1,alert("订单创建失败，请稍后重试"))}catch(e){Me.value=!1,alert("订单创建失败，请稍后重试")}},Se=()=>{Ve.value=!1,t.push({path:"/login",query:{redirect:"/vip"}})},Ge=async()=>{const e=De.value.trim();if(e)if(we.isLoggedIn){Ue.value=!0;try{const t=await(async e=>await U.post("/api/redemption/redeem",{code:e}))(e);t.success?(ke.success(t.message||`成功兑换 ${t.value} 天 VIP`),De.value="",t.vip_expire&&(we.user.vip_expired_at=t.vip_expire),await we.fetchUser()):ke.error(t.message||"兑换失败")}catch(t){ke.error(t.message||"兑换失败，请稍后再试")}finally{Ue.value=!1}}else Ve.value=!0;else ke.error("请输入兑换码")};return l(_e,e=>{}),i(()=>{(async()=>{Ce.value=!0;try{const e=await M();e.success&&(je.value=e.data)}catch(e){}finally{Ce.value=!1}})(),"video"===he.query.tab&&(_e.value="video")}),(e,t)=>(p(),c(D,{title:"通行证充值"},{default:d(()=>[x("div",$,[x("div",q,[t[6]||(t[6]=x("h2",{class:"text-2xl sm:text-3xl font-bold text-pink-500 mb-3",style:{"text-shadow":"2px 2px 0 rgba(31, 41, 55, 0.8)"}}," 充值通行证 ",-1)),x("p",P,y("comic"===_e.value?"解锁全站所有漫画":"畅享全站海量视频内容"),1)]),b(we).isLoggedIn?(p(),g("div",W,[x("div",A,[x("div",R,[x("div",S,[x("div",null,[t[7]||(t[7]=x("h3",{class:"text-white font-semibold text-sm mb-1"},"漫画通行证",-1)),qe.value?(p(),g("p",G," 有效期至 "+y(We(b(we).user?.vip_expired_at)),1)):(p(),g("p",H,"未开通"))]),x("div",{class:f([qe.value?"bg-green-500/20 border-green-500/50 text-green-400":"bg-gray-700/50 border-gray-600 text-gray-400","px-3 py-1 border rounded-lg text-xs"])},y(qe.value?"已开通":"未开通"),3)])]),x("div",T,[x("div",X,[x("div",null,[t[8]||(t[8]=x("h3",{class:"text-white font-semibold text-sm mb-1"},"视频通行证",-1)),Pe.value?(p(),g("p",F," 有效期至 "+y(We(b(we).user?.video_expired_at)),1)):(p(),g("p",K,"未开通"))]),x("div",{class:f([Pe.value?"bg-green-500/20 border-green-500/50 text-green-400":"bg-gray-700/50 border-gray-600 text-gray-400","px-3 py-1 border rounded-lg text-xs"])},y(Pe.value?"已开通":"未开通"),3)])])])])):v("",!0),x("div",N,[x("div",O,[x("button",{onClick:t[0]||(t[0]=e=>_e.value="comic"),class:f(["flex-1 py-2 px-4 rounded-lg font-medium transition-all","comic"===_e.value?"bg-gradient-to-r from-pink-600 to-purple-600 text-white":"text-gray-400 hover:text-white"])}," 漫画通行证 ",2),x("button",{onClick:t[1]||(t[1]=e=>_e.value="video"),class:f(["flex-1 py-2 px-4 rounded-lg font-medium transition-all","video"===_e.value?"bg-gradient-to-r from-pink-600 to-purple-600 text-white":"text-gray-400 hover:text-white"])}," 视频通行证 ",2)])]),Ce.value?(p(),g("div",Q,[m(h)])):(p(),g("div",E,[(p(!0),g(w,null,k($e.value,e=>(p(),g("div",{key:e.key,class:f(["relative bg-gray-900/60 backdrop-blur-sm rounded-xl p-4 sm:p-6 border transition-all flex flex-col",e.popular?"border-pink-500/50 shadow-lg shadow-pink-500/20":"border-white/10 hover:border-pink-500/30"])},[e.popular?(p(),g("div",J,[...t[9]||(t[9]=[x("span",{class:"px-3 py-1 bg-pink-600/90 backdrop-blur-sm border border-pink-400/60 text-white text-xs font-bold rounded-full shadow-lg"}," 最受欢迎 ",-1)])])):v("",!0),x("div",Y,[x("h3",Z,y("comic"===_e.value?"漫画":"视频")+y(e.name),1),x("p",ee,y(e.duration)+y(e.duration_unit),1),x("div",te,[x("div",re,[t[10]||(t[10]=x("span",{class:"text-pink-500 text-sm"},"¥",-1)),x("span",se,y(e.price),1)]),x("div",ae,[e.original_price?(p(),g(w,{key:0},[x("div",oe,"¥"+y(e.original_price),1),e.save_amount?(p(),g("div",le," 节省 ¥"+y(e.save_amount),1)):v("",!0)],64)):v("",!0)])]),x("div",ie,[(p(!0),g(w,null,k(e.features,e=>(p(),g("div",{key:e,class:"flex items-center justify-center gap-2 text-gray-300 text-sm"},[t[11]||(t[11]=x("svg",{class:"w-4 h-4 text-green-400 flex-shrink-0",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24"},[x("path",{"stroke-linecap":"round","stroke-linejoin":"round","stroke-width":"2",d:"M5 13l4 4L19 7"})],-1)),x("span",null,y(e),1)]))),128))]),x("div",ne,[x("button",{onClick:_(t=>Ae(e,"alipay"),["stop"]),class:"w-full py-2 px-4 rounded-lg font-medium transition-all cursor-pointer bg-gray-800/50 backdrop-blur-sm text-white hover:bg-gray-700/50 border border-white/10 hover:border-white/20 flex items-center justify-center gap-2"},[...t[12]||(t[12]=[x("span",{class:"text-blue-400"},"支付宝",-1),j(" 支付 ",-1)])],8,ce),x("button",{onClick:_(t=>Ae(e,"wechat"),["stop"]),class:"w-full py-2 px-4 rounded-lg font-medium transition-all cursor-pointer bg-gray-800/50 backdrop-blur-sm text-white hover:bg-gray-700/50 border border-white/10 hover:border-white/20 flex items-center justify-center gap-2"},[...t[13]||(t[13]=[x("span",{class:"text-green-400"},"微信",-1),j(" 支付 ",-1)])],8,de)])])],2))),128))])),x("div",ue,[x("div",pe,[t[15]||(t[15]=x("h3",{class:"text-lg font-bold text-white mb-4 text-center"},"使用兑换码",-1)),x("div",xe,[C(x("input",{"onUpdate:modelValue":t[2]||(t[2]=e=>De.value=e),type:"text",placeholder:"请输入兑换码",class:"w-full px-4 py-3 bg-gray-800/50 border border-gray-700 rounded-lg text-white placeholder-gray-500 focus:outline-none focus:border-pink-500/50 transition-colors",onKeyup:V(Ge,["enter"])},null,544),[[L,De.value]]),x("button",{onClick:Ge,disabled:!De.value.trim()||Ue.value,class:"w-full py-3 bg-gradient-to-r from-pink-600 to-purple-600 hover:from-pink-700 hover:to-purple-700 disabled:from-gray-600 disabled:to-gray-700 text-white font-bold rounded-lg transition-all disabled:cursor-not-allowed"},[Ue.value?(p(),g("span",ve,[...t[14]||(t[14]=[x("svg",{class:"animate-spin h-5 w-5 mr-2",fill:"none",viewBox:"0 0 24 24"},[x("circle",{class:"opacity-25",cx:"12",cy:"12",r:"10",stroke:"currentColor","stroke-width":"4"}),x("path",{class:"opacity-75",fill:"currentColor",d:"M4 12a8 8 0 018-8V0C5.373 0 0 5.373 0 12h4zm2 5.291A7.962 7.962 0 014 12H0c0 3.042 1.135 5.824 3 7.938l3-2.647z"})],-1),j(" 兑换中... ",-1)])])):(p(),g("span",ge,"兑换"))],8,me)])])]),t[16]||(t[16]=x("div",{class:"mt-12 max-w-md mx-auto sm:max-w-2xl"},[x("h3",{class:"text-lg font-semibold text-white mb-4 text-center"},"常见问题"),x("div",{class:"bg-gray-900/60 backdrop-blur-sm border border-white/10 rounded-lg divide-y divide-white/10"},[x("details",{class:"group"},[x("summary",{class:"flex justify-between items-center p-4 cursor-pointer hover:bg-gray-800/50 transition-colors"},[x("span",{class:"text-gray-300 text-sm"},"通行证到期后会怎样？"),x("svg",{class:"w-5 h-5 text-gray-400 transition-transform group-open:rotate-180",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24"},[x("path",{"stroke-linecap":"round","stroke-linejoin":"round","stroke-width":"2",d:"M19 9l-7 7-7-7"})])]),x("div",{class:"px-4 pt-2 pb-4 text-gray-400 text-sm"}," 到期后将恢复为普通用户，您的收藏记录会保留。 ")]),x("details",{class:"group"},[x("summary",{class:"flex justify-between items-center p-4 cursor-pointer hover:bg-gray-800/50 transition-colors"},[x("span",{class:"text-gray-300 text-sm"},"支持哪些支付方式？"),x("svg",{class:"w-5 h-5 text-gray-400 transition-transform group-open:rotate-180",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24"},[x("path",{"stroke-linecap":"round","stroke-linejoin":"round","stroke-width":"2",d:"M19 9l-7 7-7-7"})])]),x("div",{class:"px-4 pt-2 pb-4 text-gray-400 text-sm"}," 目前支持支付宝和微信支付。 ")]),x("details",{class:"group"},[x("summary",{class:"flex justify-between items-center p-4 cursor-pointer hover:bg-gray-800/50 transition-colors"},[x("span",{class:"text-gray-300 text-sm"},"在哪里查看支付状态？"),x("svg",{class:"w-5 h-5 text-gray-400 transition-transform group-open:rotate-180",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24"},[x("path",{"stroke-linecap":"round","stroke-linejoin":"round","stroke-width":"2",d:"M19 9l-7 7-7-7"})])]),x("div",{class:"px-4 pt-2 pb-4 text-gray-400 text-sm"},' 您可以在"个人中心" → "充值记录"页面查看所有支付订单的状态。 ')]),x("details",{class:"group"},[x("summary",{class:"flex justify-between items-center p-4 cursor-pointer hover:bg-gray-800/50 transition-colors"},[x("span",{class:"text-gray-300 text-sm"},"支付后多久到账？"),x("svg",{class:"w-5 h-5 text-gray-400 transition-transform group-open:rotate-180",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24"},[x("path",{"stroke-linecap":"round","stroke-linejoin":"round","stroke-width":"2",d:"M19 9l-7 7-7-7"})])]),x("div",{class:"px-4 pt-2 pb-4 text-gray-400 text-sm"},' 支付成功后，VIP权益会在十几秒到几分钟内自动到账。如果长时间未到账，请前往"个人中心" → "联系我们"反馈问题。 ')])])],-1))]),m(B,{modelValue:Ve.value,"onUpdate:modelValue":t[3]||(t[3]=e=>Ve.value=e),icon:"lock",title:"请先登录",message:"购买通行证需要先登录账号","confirm-text":"立即登录","cancel-text":"取消",onConfirm:Se,onCancel:t[4]||(t[4]=e=>Ve.value=!1)},null,8,["modelValue"]),m(I,{modelValue:Le.value,"onUpdate:modelValue":t[5]||(t[5]=e=>Le.value=e),type:"info",title:"确认购买",message:`确认使用${"alipay"===Ie.value?"支付宝":"微信"}购买${Be.value?.name}（¥${Be.value?.price}）？`,"confirm-text":"确认支付","cancel-text":"取消",onConfirm:Re},null,8,["modelValue","message"]),Me.value?(p(),g("div",ye,[x("div",be,[m(h,{size:"large"}),x("p",fe,y(ze.value),1),t[17]||(t[17]=x("p",{class:"text-gray-400 mt-2 text-sm"},"请稍候，请勿关闭页面...",-1))])])):v("",!0)]),_:1}))}},[["__scopeId","data-v-4fe015c1"]]);export{he as default};
